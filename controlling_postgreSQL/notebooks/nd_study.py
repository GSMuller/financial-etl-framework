{
 "cells": [
  {
   "cell_type": "code",
   "execution_count": 26,
   "id": "879cf88e",
   "metadata": {},
   "outputs": [],
   "source": [
    "## Bibliotecas\n",
    "import pandas as pd\n",
    "import bokeh.plotting as bp\n",
    "import sys\n",
    "sys.path.append(r'C:\\Users\\giovanni.5683\\GITHUB\\controlling_postgreSQL')  # Adiciona o diretório onde está conn.py\n",
    "from conn import get_connection\n",
    "engine = get_connection()\n",
    "cursor = engine.cursor()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 84,
   "id": "9ac25d2a",
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Conexão bem-sucedida e dados lidos com sucesso!\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "C:\\Users\\giovanni.5683\\AppData\\Local\\Temp\\ipykernel_22696\\3025527447.py:3: UserWarning: pandas only supports SQLAlchemy connectable (engine/connection) or database string URI or sqlite3 DBAPI2 connection. Other DBAPI2 objects are not tested. Please consider using SQLAlchemy.\n",
      "  df_raiz = pd.read_sql_query(Raiz, engine)\n"
     ]
    },
    {
     "data": {
      "application/vnd.microsoft.datawrangler.viewer.v0+json": {
       "columns": [
        {
         "name": "index",
         "rawType": "int64",
         "type": "integer"
        },
        {
         "name": "id",
         "rawType": "int64",
         "type": "integer"
        },
        {
         "name": "numero_nd",
         "rawType": "object",
         "type": "string"
        },
        {
         "name": "data_emissao",
         "rawType": "object",
         "type": "unknown"
        },
        {
         "name": "chassi",
         "rawType": "object",
         "type": "string"
        },
        {
         "name": "valor",
         "rawType": "float64",
         "type": "float"
        },
        {
         "name": "descricao",
         "rawType": "object",
         "type": "string"
        },
        {
         "name": "filial_id",
         "rawType": "int64",
         "type": "integer"
        },
        {
         "name": "user_id",
         "rawType": "int64",
         "type": "integer"
        },
        {
         "name": "created_at",
         "rawType": "datetime64[ns]",
         "type": "datetime"
        }
       ],
       "ref": "dc1f707f-901b-4970-8ade-390ab34c322e",
       "rows": [
        [
         "0",
         "1949",
         "2-2025-060",
         "2025-02-19",
         "LC0C74C41S5009008;LC0C74C41S5009025;LC0C74C41S5009042;LC0C74C41S5009073;LC0C74C41S5009090;LC0C74C41S5009106;LC0C74C41S5009123;LC0C74C41S5009185;LC0C74C41S5009199;LC0C74C41S5009235;LC0C74C45S5000263;LC0C74C45S5000909;LC0C74C45S5001218;LC0C74C45S5001560;LC0C74C45S5001980;LC0C74C45S5003552;LC0C74C45S5004250;LC0C74C45S5004278;LC0C74C45S5004345;LC0C74C45S5004670;LC0C74C45S5005530;LC0C74C45S5005950;LC0C74C45S5006094;LC0C74C45S5007147;LC0C74C45S5007181;LC0C74C45S5008931;LC0C74C45S5009349;LC0C74C45S5009402;LC0C74C46S5000255;LC0C74C46S5000319;LC0C74C46S5001163;LC0C74C46S5002796;LC0C74C46S5004063;LC0C74C46S5005598;LC0C74C46S5005620;LC0C74C46S5006542;LC0C74C46S5006895;LC0C74C46S5007092;LC0C74C46S5007139;LC0C74C46S5007240;LC0C74C43S5006496;LC0C74C43S5006983;LC0C74C43S5007552;LC0C74C43S5007597;LC0C74C43S5007616;LC0C74C43S5007695;LC0C74C43S5008314;LC0C74C43S5008376;LC0C74C43S5008720;LC0C74C43S5008734;LC0C74C43S5008748;LC0C74C43S5008801;LC0C74C43S5009317;LC0C74C44S5000660;LC0C74C44S5001064;LC0C74C44S5001100;LC0C74C44S5001534;LC0C74C44S5005390;LC0C74C44S5005437;LC0C74C44S5005454;LC0C74C44S5005499;LC0C74C44S5006393;LC0C74C44S5006426;LC0C74C44S5006474;LC0C74C44S5006507;LC0C74C44S5006927;LC0C74C44S5007060;LC0C74C44S5008306;LC0C74C44S5008502;LC0C74C44S5008743;LC0C74C41S5009266;LC0C74C41S5009283;LC0C74C41S5009297;LC0C74C42S5000821;LC0C74C42S5001788;LC0C74C42S5003038;LC0C74C42S5003606;LC0C74C42S5003721;LC0C74C42S5003816;LC0C74C42S5004528;LGXCD4C48S0074795;LGXCD4C42S0074792;LGXCD4C44S0075099;LGXCD4C43S0074610;LGXCD4C46S0074651;LGXCD4C45S0075113;LGXCD4C42S0074680;LGXCD4C42S0073903;LGXCD4C41S0073052;LPE19W2A1SF030624;LC0C76C4XS0025796;LGXCD4C40S0074659;LC0C76C42S0024187;LC0C74C49S5021469;LC0C74C49S5021536;LC0C74C4XS5002719;LC0C74C4XS5021366;LC0C74C4XS5021433;LC0C74C4XS5021481;LC0C74C4XS5021500;LC0C74C4XS5021531;LC0C74C41S5000793;LC0C74C41S5002236;LC0C74C41S5002317;LC0C74C41S5002947;LC0C74C41S5003256;LC0C74C47S5004010;LC0C74C48S5009619;LC0C74C43S5008426;LC0C74C43S5008457;LC0C74C43S5008460;LC0C74C43S5009009;LC0C74C43S5009012;LC0C74C46S5019968;LC0C74C46S5021350;LC0C74C46S5021400;LC0C74C47S5019428;LC0C74C47S5021390;LC0C74C48S5018286;LC0C74C48S5018370;LC0C74C48S5021172;LC0C74C48S5021463;LC0C74C49S5020810;LC0C74C44S5000402;LC0C74C44S5000738;LC0C74C44S5000741;LC0C74C44S5000769;LC0C74C44S5001436;LC0C74C44S5001694;LC0C74C44S5001954;LC0C74C44S5002103;LC0C74C44S5002215;LC0C74C44S5002554;LGXCE4CCXS0051619;LGXCE4CCXS0051622;LGXCE4CCXS0051796;LGXCE4CCXS0051801;LGXCE4CCXS0052771;LGXCE4CCXS0053046;LGXCE4CCXS0053063;LGXCE4CCXS0053080;LGXCE4CCXS0053094;LGXCE4CCXS0053127;LGXCE4CCXS0053144;LGXCE4CCXS0053208;LGXCE4CCXS0053211;LGXCE4CCXS0053290;LGXCE4CCXS0053452;LGXCE4CC6S0051343;LGXCE4CC6S0057191;LGXCE4CC6S0057403;LGXCE4CC6S0057451;LGXCE4CC6S0057482;LGXCE4CC5S0044819;LGXCE4CC0S0034151;LGXCE4CC0S0034554;LGXCE4CC0S0034604;LGXCE4CC0S0034702;LGXCE4CC0S0034733;LGXCE4CC0S0035011;LGXCE4CC0S0035090;LGXCE4CC0S0035560;LGXCE4CC0S0035574;LGXCE4CC0S0035784;LGXCE4CC0S0035798;LGXCE4CC0S0036305;LGXCE4CC0S0042024;LGXCE4CC0S0043612;LGXCE4CC0S0044114;LGXCE4CC0S0044422;LGXCE4CC0S0044498;LGXCE4CC0S0044517;LGXCE4CC0S0044808;LC0CE4CB0S0013391;LC0CE4CB0S0016453;LC0CE4CB0S0017800;LC0CE4CB0S0017828;LC0CE4CB0S0017845;LC0CE4CB1S0016557;LGXC74C44S0018621;LGXC74C44S0020398;LGXC74C44S0021907;LGXC74C45S0016778;LGXC74C45S0018627;LGXC74C45S0018658;LGXC74C45S0019535;LGXC74C45S0020345;LGXC74C45S0020507;LGXC74C46S0012643;LGXC74C46S0016630;LGXC74C46S0016823;LGXC74C46S0016949;LGXC74C46S0018622;LGXC74C46S0018667;LGXC74C46S0018670;LGXC74C43S0016889;LGXC74C43S0016892;LGXC74C43S0016942;LGXC74C43S0018626;LGXC74C43S0018724;LGXC74C43S0019629;LGXC74C43S0019680;LGXC74C43S0020344;LGXC74C43S0020456;LGXC74C43S0020487;LGXC74C43S0020604;LGXC74C44S0016691;LGXC74C40S0019572;LGXC74C40S0019605;LGXC74C40S0019619;LGXC74C40S0019684;LGXC74C42S0018553;LGXC74C42S0018682;LGXC74C42S0020366;LGXC74C42S0020481;LGXC74C43S0016763;LGXC74C43S0016780;LGXC74C43S0016827;LGXC74C43S0016861;LGXCE4CC6S0051990;LGXCE4CC6S0052024;LGXCE4CC6S0052041;LGXCE4CC6S0052072;LGXCE4CC6S0052153;LGXCE4CC6S0052167;LGXCE4CC6S0052265;LGXCE4CC6S0052279;LGXCE4CC6S0052394;LGXCE4CC6S0052458;LC0C76C47S0012715;LC0C76C47S0012763;LC0C76C47S0012777;LC0C76C47S0012858;LC0C76C47S0012892;LC0C76C47S0012911;LC0C76C47S0012925;LC0C76C47S0012939;LC0C76C47S0013010;LC0C76C48S0011881;LC0C76C48S0012691;LC0C76C48S0012741;LC0C76C48S0012769;LC0C76C48S0012772;LC0C76C48S0012786;LC0C76C48S0012805;LC0C76C48S0012836;LC0C76C48S0012853;LGXCE4CC3S0038291;LGXCE4CC3S0038422;LGXCE4CC3S0038453;LGXCE4CC3S0038467;LGXCE4CC3S0038520;LGXCE4CC3S0038534;LGXCE4CC3S0038548;LGXCE4CC3S0038551;LC0C74C47S5006405;LC0C74C49S5012917;LC0C74C49S5012920;LC0C74C49S5013923;LC0C74C49S5014098;LC0C74C49S5014733;LC0C74C4XS5009931;LC0C74C4XS5011887;LC0C74C4XS5012666;LC0C74C49S5009449;LC0C74C49S5009452;LC0C74C49S5009466;LC0C74C49S5009483;LC0C74C49S5009497;LC0C74C49S5009516;LC0C74C49S5009533;LC0C74C49S5010116;LC0C74C49S5010780;LC0C74C49S5010875;LC0C74C49S5011184;LC0C74C49S5011623;LC0C74C49S5011671;LC0C74C49S5011718;LC0C74C49S5011735;LC0C74C49S5011766;LC0C74C49S5011802;LC0C74C49S5015901;LC0C74C49S5015915;LC0C74C49S5015980;LC0C74C40S5001000;LC0C74C40S5001224;LC0C74C40S5002373;LC0C74C40S5002650;LC0C74C40S5003197;LC0C74C40S5003488;LC0C74C40S5003507;LC0C74C40S5004060;LC0C74C40S5004138;LC0C74C40S5004141;LC0C74C40S5004303;LC0C74C40S5004396;LC0C74C40S5004690;LC0C74C40S5005600;LC0C74C40S5006021;LC0C74C40S5006097;LC0C74C40S5006553;LC0C74C40S5006567;LC0C74C40S5006603;LC0C74C40S5006651;LC0C74C40S5006682;LC0C74C40S5006889;LC0C74C40S5007105;LC0C74C40S5007136;LC0C74C40S5007203;LC0C74C40S5007220;LC0C74C40S5008013;LC0C74C40S5008030;LC0C74C40S5008058;LC0C74C40S5008061;LC0C74C40S5008075;LC0C74C40S5008089;LC0C74C40S5008108;LC0C74C40S5008111;LC0C74C40S5008142;LC0C74C40S5008223;LC0C74C40S5008965;LC0C74C40S5009694;LC0C74C40S5011252;LC0C74C41S5000325;LC0C74C41S5000857;LC0C74C41S5000891;LC0C74C41S5001247;LC0C74C41S5001491;LC0C74C41S5001880;LC0C74C41S5001944;LC0C74C41S5002429;LC0C74C41S5002785;LC0C74C41S5002835;LC0C74C41S5003192;LC0C74C41S5003242;LC0C74C41S5004049;LC0C74C41S5004102;LC0C74C41S5004245;LC0C74C41S5004312;LC0C74C41S5004651;LC0C74C41S5005170;LC0C74C41S5005203;LC0C74C41S5005573;LC0C74C41S5006013;LC0C74C49S5012898",
         "241500.0",
         "PDIDezembro/24",
         "2",
         "4",
         "2026-01-06 16:20:31.077827"
        ],
        [
         "1",
         "1953",
         "2-2025-064",
         "2025-03-21",
         "LC0CE4CB7S4003854",
         "8168.0",
         "Resultado Bônus Equalização Yuan Pro",
         "2",
         "4",
         "2026-01-06 16:20:31.077827"
        ],
        [
         "2",
         "2108",
         "8-2025-029",
         "2025-03-11",
         "LGXC74C46S0042824;LC0CE4CB6S0002606;LGXC74C41S0027258;LC0C74C49S5002744;LGXC74C42S0033442;LC0CE4CB2S0002229",
         "62800.0",
         "Resultado Bônus Política Comercial Dezembro/24",
         "8",
         "4",
         "2026-01-06 16:20:31.843074"
        ],
        [
         "3",
         "2102",
         "3-2025-043",
         "2025-08-13",
         "LGXC74C49S0046365;LGXCF6CD5S2002396;LC0CE4CB8S0007922;LGXC74C44T0001884;LC0CE4CC2S0034333;LC0CE4CB0S4004411;LGXCE4CC5S0022187;LC0CE4CC1S0036350;LGXCF6CD0S2002483;LGXCE4CC2S0043630;LGXCE4CC8S0051991;LGXCE4CC8S0049013;LGXC74C40S0027204;LGXCE4CC4S0039532;LGXCE4CC3S0046553;LGXCE4CC5S0052239;LGXCE4CC1S0052299;LGXCE4CC6S0031173;LC0CE4CC1S0037160;LGXCE4CC2S0046799;LC0CE4CC7S0034411;LGXCF6CD4S2001790;LC0CE4CB4S0007383;LC0C74C49T5001451;LGXC74C47T0002592;LC0CE4CB8S0007936;LC0CE4CC0T0003499;LC0CE4CC2T0001088;LC0CE4CC2T0001074;LC0CE4CC0T0003518;LGXC74C45S0049585;LC0CE4CC2S0010727;LGXC74C42T0002693;LC0CE4CC2T0001222;LGXCE4CC0T0021028",
         "3400.0",
         "172-89 Bônus Performance Junho.25",
         "3",
         "4",
         "2026-01-06 16:20:31.843074"
        ],
        [
         "4",
         "2126",
         "8-2025-047",
         "2025-07-09",
         "LC0C74C46S5019503;LC0C74C4XS5013008;LC0C74C4XS5012358;LC0C74C4XS5011209;LC0C74C42S5001385;LC0C74C46S5005651;LC0C74C46S5009585;LGXCE4CC7S0030520;LGXCE4CC2S0026763;LC0C74C46S5019498;LC0C76C42S0024884;LC0C74C4XS5014515;LC0C76C46S0025360;LC0C76C48S0012772;LC0C74C4XS5011047;LC0C76C46S0025407;LC0C74C40S5003216;LC0C74C46S5005634;LC0C74C46S5005911;LC0C74C4XS5005765;LC0C74C4XS5006771",
         "35000.0",
         "148-42 Bônus 48 Horas Eletrizantes Mar.25",
         "8",
         "4",
         "2026-01-06 16:20:31.843074"
        ],
        [
         "5",
         "2103",
         "3-2025-044",
         "2025-08-14",
         "LC0C76C42S0024755;LC0C76C45S0024636;LC0CE4CB5S0013385;LC0CE4CC0S0038235;LC0CE4CC1S0037126;LC0CE4CC1S0037160;LC0CE4CC5S0037128;LC0CE4CC7S0034411;LC0CE4CC9S0037228;LGXC74C45S0049599;LGXC74C45S0049604;LGXCE4CC0S0048891;LGXCE4CC2S0044745;LGXCE4CC2S0046799;LGXCE4CC2S0049038;LGXCE4CC3S0044589;LGXCE4CC3S0046553;LGXCE4CC3S0046794;LGXCE4CC3S0052661;LGXCE4CC4S0032676;LGXCE4CC4S0034671;LGXCE4CC4S0034735;LGXCE4CC4S0034881;LGXCE4CC4S0039532;LGXCE4CC5S0048501;LGXCE4CC5S0051690;LGXCE4CC9S0052731",
         "225800.0",
         "177-89 Política Comercial Maio/25",
         "3",
         "4",
         "2026-01-06 16:20:31.843074"
        ],
        [
         "6",
         "2128",
         "8-2025-049",
         "2025-08-08",
         "LGXCE4CC6S0048281;LGXCE4CC7S0038648;LGXCE4CC8S0047911;LGXCE4CC8S0048508",
         "12000.0",
         "170-42 Bônus Operação Dolphin Mini 5 LAbril.25",
         "8",
         "4",
         "2026-01-06 16:20:31.843074"
        ],
        [
         "7",
         "2107",
         "8-2025-028",
         "2025-07-03",
         "LC0C74C4XS5022078;LC0C74C48S5020930;LGXCE4CC3S0048514;LC0C74C46S5022546;LC0C76C4XS0011543;LGXCE4CC3S0037884;LC0C74C42S5020065;LC0C74C47S5014052;LC0C74C40S5022512;LC0C74C49S5001593;LGXCD4C45S0073636;LGXCE4CC7S0036575;LC0C74C46S5022532;LC0C74C46S5022580;LC0C74C48S5020944;LC0C76C47S0011595;LGXC74C40S0028014;LGXC74C43S0018416;LC0CE4CCXS0011351;LC0C74C43S5022276;LC0C74C44S5020102;LC0C74C47S5018652;LC0C76C4XS0011591;LC0C76C46S0010101;LC0C76C49S0022811;LGXCF6CD7S2003730;LC0C76C47S0024198;LC0C74C49S5021889;LGXC74C41S0027213;LGXCE4CC3S0048710;LC0C74C4XS5021559;LC0C74C40S5006990;LGXCE4CC5S0057506;LC0C74C45S5018388;LC0C76C46S0010065;LC0C74C46S5022577;LGXCE4CC2S0049153;LC0C74C45S5000263;LC0C74C45S5019119;LC0C74C45S5018603;LC0C74C43S5006496;LC0C76C4XS0011574;LGXC74C41S0034338;LGXCE4CC8S0023544;LGXCE4CC6S0049026;LC0C74C42S5005405;LC0C74C41S5009266;LGXC74C4XS0030000;LGXCE4CC8S0023009;LGXCE4CC8S0023088;LGXCE4CC9S0028283;LGXCE4CC3S0051610;LGXCE4CC1S0030903;LGXC74C41S0027258;LC0CE4CB6S0002606;LGXC74C46S0042824;LC0C74C44S5001100;LC0C74C45S5004670;LC0C74C45S5006094;LC0C74C42S5003816;LGXCE4CC4S0048490;LGXCE4CC4S0055309;LGXCE4CC4S0048327;LC0C74C41S5009199;LC0C74C42S5003038;LGXCE4CC4S0055343;LC0C74C45S5009402;LGXCE4CC5S0055304;LGXCE4CC6S0048877;LC0C76C49S0022372;LGXCE4CC4S0056752;LGXCD4C48S0074795;LC0C76C47S0029496;LC0C74C41S5000793;LGXC74C48S0028827;LC0C74C41S5003256;LC0C74C46S5006542;LC0C74C46S5021400",
         "121550.0",
         "Resultado Campanhade Alavancagemde Emplacamento Dezembro/24",
         "8",
         "4",
         "2026-01-06 16:20:31.843074"
        ],
        [
         "8",
         "2109",
         "8-2025-030",
         "2025-03-21",
         "LC0C74C40S5004060;LC0C74C40S5004138;LC0C74C40S5004141;LC0C74C43S5009012;LC0C74C44S5002103;LGXC74C45S0006008;LC0C74C40S5003507;LC0C76C4XS0025796;LC0C74C45S5005530;LGXCE4CC7S0047169;LC0C74C49S5012920;LC0CE4CB5S0016397;LC0C76C48S0012853;LGXCF6CD2S2000539;LC0C74C44S5000769;LGXCE4CC6S0047910;LC0CE4CB4S0016343;LC0C74C4XS5021481;LGXCE4CC6S0036504;LGXCE4CC0S0047806;LGXCE4CC3S0055477;LC0C76C4XS0022591;LGXCE4CC4S0055634;LGXCD4C45S0074768;LGXCE4CC7S0047107;LC0C74C49S5021536;LGXCE4CCXS0045531;LGXC74C48S0030495;LGXCE4CC6S0048782;LGXCE4CC6S0052024;LC0CE4CB6S0015761;LC0C74C40S5008030;LGXCE4CC9S0040918;LGXCE4CCXS0045304;LC0C76C41S0026254;LC0C74C49S5011671;LC0C76C47S0012715;LGXCE4CC7S0033997",
         "3800.0",
         "Resultado Campanhade Alavancagemde Emplacamento Janeiro/25",
         "8",
         "4",
         "2026-01-06 16:20:31.843074"
        ],
        [
         "9",
         "2101",
         "3-2025-042",
         "2025-08-11",
         "LGXCD4C44T0035879;LC0CE4CB8S0007936;LC0CE4CB8S0007922;LGXC74C44T0001884;LGXC74C42T0001852;LGXC74C40T0002501;LC0C74C46T5004856;LGXC74C48T0026481;LGXC74C47T0026732;LGXC74C47T0002592;LC0CE4CB0S4003470;LC0C74C49T5001451;LC0C74C49T5001000;LC0C74C47T5000475;LC0C74C45T5003651;LC0C74C45T5003570;LC0C74C41T5000603;LC0C74C41T5000259;LGXC74C41T0029125;LC0CE4CBXS4003489;LC0CE4CB6S0004825;LC0CE4CC0T0003518;LC0CE4CC0T0003499;LGXCD4C42T0053409;LGXC74C48T0050442;LC0CE4CC2T0001088;LC0CE4CC2T0001074;LGXCD4C47T0055169;LGXCD4C41T0061047;LGXCD4C41T0057547;LC0CE4CB7S4001408;LC0CE4CB3S0013367;LC0CE4CB8S4003622;LC0CE4CB4S4003231;LC0CE4CC2T0003987;LC0CE4CC2T0003973",
         "77618.0",
         "174-89 Bônus Performance Junho.25",
         "3",
         "4",
         "2026-01-06 16:20:31.843074"
        ],
        [
         "10",
         "1956",
         "2-2025-067",
         "2025-03-27",
         "LC0C76C4XS0012952;LC0C76C43S0017670;LC0C76C46S0023771;LC0C76C49S0023764;LC0C76C40S0024902;LC0C76C40S0024978;LC0C76C43S0018351;LC0C76C40S0015939;LC0C76C40S0024981;LC0C76C40S0025001;LC0C76C43S0018415;LC0C76C40S0016010;LC0C74C46S5021462;LC0C74C46S5021476;LC0C74C46S5021493;LC0C74C46S5021509;LC0C74C46S5021428;LC0C74C46S5021431;LC0C74C46S5021445;LC0C74C46S5021459;LC0C74C46S5021512;LC0C74C46S5021526;LC0C74C46S5021543;LC0C74C47S5012284;LC0C74C46S5005715;LC0C74C47S5021373;LC0C74C47S5021387;LC0C74C47S5021406;LC0C74C47S5021437;LC0C74C49S5020841;LC0C74C49S5020855;LC0C74C49S5021293;LC0C74C49S5021374;LC0C76C46S0019414;LC0C74C49S5021388;LC0C74C42S5001502;LC0C74C45S5003499;LC0C74C40S5009145;LC0C74C49S5021522;LC0C76C42S0024738;LC0C76C42S0024755;LC0C76C46S0018358;LC0C74C4XS5012313;LC0C74C4XS5014661;LC0C74C45S5004037;LC0C74C45S5004040;LC0C76C46S0018473;LC0C76C42S0024836;LC0C76C42S0024884;LC0C74C45S5004054;LC0C76C40S0025368;LC0C74C45S5004295;LC0C74C4XS5015356;LC0C74C4XS5015924;LC0C76C42S0024917;LC0C76C46S0019140;LC0C76C40S0025337;LC0C74C45S5006693;LC0C74C45S5006886;LC0C74C45S5007200;LC0C74C4XS5017365;LC0C74C4XS5017401;LC0C74C4XS5018158;LC0C74C4XS5018225;LC0C74C4XS5018239;LC0C76C43S0015188;LC0C76C43S0023288",
         "29812.0",
         "Bônus Performance Fevereiro/25",
         "2",
         "4",
         "2026-01-06 16:20:31.077827"
        ],
        [
         "11",
         "2110",
         "8-2025-031",
         "2025-03-21",
         "LC0C76C48S0012853;LC0C74C49S5021536;LC0C76C4XS0022591;LGXCD4C45S0074768;LC0C76C41S0026254;LGXC74C48S0030495;LC0C74C49S5011671;LC0C76C47S0012715;LC0C74C40S5008030;LC0C74C41S5002947;LGXCF6CD2S2000539;LC0CE4CB6S0002637",
         "66342.0",
         "Bônus Politicacomercial Janeiro/25",
         "8",
         "4",
         "2026-01-06 16:20:31.843074"
        ],
        [
         "12",
         "1962",
         "2-2025-073",
         "2025-03-21",
         "LGXCE4CC4S0042480;LC0CE4CB2S0002151;LGXCE4CCXS0054214;LC0CE4CC2S0006287;LC0CE4CC2S0011098;LC0CE4CC3S0005519;LC0CE4CC5S0012679;LGXCE4CC0S0042959;LGXCE4CC0S0054450;LGXCE4CC2S0042932;LGXCE4CC4S0054936;LGXCE4CC6S0023767;LGXCE4CC6S0028984;LGXCE4CC7S0042358;LGXCE4CCXS0053824;LGXCE4CCXS0054116;LC0CE4CC8S0012420;LGXCE4CC7S0043543",
         "23760.0",
         "098-3 Reembolso Carregadores Setembro.24",
         "2",
         "4",
         "2026-01-06 16:20:31.077827"
        ],
        [
         "13",
         "2113",
         "8-2025-034",
         "2025-04-09",
         "LC0C74C45S5004037;LC0C74C45S5004040;LC0C74C46S5021462;LC0C74C46S5021476;LC0C74C46S5021493;LC0C74C46S5021509;LC0C74C4XS5012313;LC0C74C4XS5014661;LC0C76C40S0015939;LC0C76C40S0024902;LC0C76C40S0024978;LC0C76C42S0024836;LC0C76C43S0018351;LC0CE4CB4S0009733;LC0CE4CB5S0017971;LC0CE4CB9S0002776;LGXCE4CC6S0032503;LGXCE4CC6S0032520;LGXCE4CC6S0032713;LGXCE4CC6S0032789;LGXCE4CC6S0032792;LGXCF6CD0S2002130;LGXCF6CD1S2003769;LGXCF6CD1S2003982;LGXCF6CD2S2000718;LGXCF6CD7S2000259;LPE19W2A2SF030051",
         "447926.0",
         "Bônus Política Comercial Fevereiro/25",
         "8",
         "4",
         "2026-01-06 16:20:31.843074"
        ],
        [
         "14",
         "2147",
         "4-2025-010",
         "2025-07-09",
         "LC0C74C49S5018474;LC0C74C48S5011287;LC0C74C41S5002219;LC0C74C42S5001791;LC0CE4CC3S0009604;LC0C76C49S0023103;LC0C74C46S5007111",
         "20000.0",
         "148-162 Bônus 48 Horas Eletrizantes Mar.25",
         "4",
         "4",
         "2026-01-06 16:20:31.843074"
        ],
        [
         "15",
         "2015",
         "9-2025-005",
         "2025-03-21",
         "LC0C74C41S5003242;LGXC74C43S0018626;LC0C74C49S5009497;LC0C74C49S5011718;LC0C74C49S5011735;LC0C76C48S0012836;LGXCE4CC6S0052167;LGXCD4C45S0075113;LC0CE4CB4S0013376;LC0CE4CB9S0013440;LC0CE4CB6S0002637;LGXC74C43S0033286;LGXC74C49S0026388;LGXCF6CD4S2003961;LGXCE4CC6S0057191;LC0C74C49S5010875;LC0C74C49S5011623;LC0C76C43S0029723;LC0C74C49S5015980;LGXCE4CC0S0024588;LGXCE4CC1S0049029;LGXCE4CC4S0037991;LC0C76C43S0029317;LC0C74C49S5011766;LGXCE4CCXS0052771;LGXCE4CC6S0057482;LC0CE4CB9S0014698;LGXCE4CC1S0030898;LGXCE4CCXS0053080;LGXCE4CCXS0045190;LC0CE4CB1S4001159;LC0C76C43S0018351;LC0C74C41S5005203;LC0C74C41S5000891;LGXCE4CCXS0045352;LGXCE4CCXS0044816;LC0C74C46S5020795;LC0C74C40S5006021;LC0CE4CB0S0017988;LC0CE4CC7S0012389;LC0C74C46S5020053;LC0C76C40S0025029;LC0C76C41S0014394;LC0C74C46S5020831;LGXC74C48S0046406;LC0CE4CB5S0018456;LGXC74C48S0010554;LGXC74C43S0016827;LGXCE4CC6S0028340;LGXCE4CC4S0056928;LC0C74C40S5008142;LC0CE4CB6S0019616;LC0CE4CB5S0018425;LC0C74C46S5020165;LC0C74C46S5020800;LGXC74C41S0012453;LGXC74C44S0048637;LC0C74C46S5021414;LC0C74C40S5008111;LGXCE4CC6S0023719;LC0C76C40S0016010;LC0C74C47S5021373;LGXC74C43S0016780;LGXCE4CC6S0028483",
         "58320.0",
         "Bônus Campanhade Alavancagemdeemplacamentos Fevereiro/25",
         "9",
         "4",
         "2026-01-06 16:20:31.388098"
        ],
        [
         "16",
         "2022",
         "9-2025-012",
         "2025-07-09",
         "LC0C74C45S5007987;LC0C74C45S5008122;LC0C74C4XS5019911;LC0C74C40S5010702;LC0C74C45S5008055;LC0C74C49S5002209;LC0C74C45S5003387;LC0C74C40S5010134;LC0C74C44S5011089;LC0C74C45S5011005;LC0C74C46S5001485;LC0C74C46S5019467;LGXCE4CC9S0023682;LGXCE4CC1S0028648;LC0C76C44S0024353;LC0C76C46S0018473;LC0C74C40S5010361;LC0C74C40S5010151;LC0C74C40S5010165;LC0C74C45S5007245;LC0C74C46S5002829;LC0C74C49S5002243;LC0C76C42S0025002;LC0C76C44S0023378;LC0C76C48S0022248;LC0C74C46S5003219;LC0C74C49S5000816;LC0C74C45S5010758;LC0C74C4XS5011016",
         "60000.0",
         "148-74 Bônus 48 Horas Eletrizantes Mar.25",
         "9",
         "4",
         "2026-01-06 16:20:31.388098"
        ],
        [
         "17",
         "2150",
         "4-2025-013",
         "2025-08-08",
         "LGXCF6CD1S2001875;LC0CE4CBXS4003590",
         "50152.0",
         "173-162 Parcial Bônus Política Comercial Junho.25",
         "4",
         "4",
         "2026-01-06 16:20:32.093248"
        ],
        [
         "18",
         "2117",
         "8-2025-038",
         "2025-03-21",
         "LC0C74C41S5007758;LGXC74C41S0005826;LC0C74C40S5000364;LGXC74C41S0040723;LGXC74C44S0025861;LC0C76C47S0010902;LC0C74C41S5014516;LGXC74C44S0026637;LGXCF6CD2S2003540;LGXCE4CC4S0043175;LGXCE4CC4S0043323;LGXCE4CC8S0043275;LGXCE4CC9S0043205;LGXCF6CD0S2002290;LGXCE4CC4S0056895;LGXCE4CC5S0043220;LGXCE4CC5S0056808;LGXCE4CC6S0043288;LGXCE4CC8S0038092;LGXCE4CC8S0038156;LGXCE4CC9S0037534;LGXCE4CC9S0043219;LGXCE4CC4S0056024;LGXCE4CC9S0037646;LGXCE4CC2S0049122",
         "41137.0",
         "099-42 Reembolso Carregadores Outubro.24",
         "8",
         "4",
         "2026-01-06 16:20:31.843074"
        ],
        [
         "19",
         "2120",
         "8-2025-041",
         "2025-07-07",
         "LGXCF6CD5S2000714;LGXCF6CD3S2004700;LC0CE4CB5S0000832;LC0CE4CC9S0034751;LGXCE4CC6S0048409;LGXCE4CC6S0048328;LGXCE4CC6S0048281;LGXCE4CC6S0047924;LGXCE4CC6S0047891;LC0CE4CB8S4003197",
         "7824.0",
         "142-42 Bônus Performance Abril.2025",
         "8",
         "4",
         "2026-01-06 16:20:31.843074"
        ],
        [
         "20",
         "1974",
         "2-2025-085",
         "2025-08-08",
         "LGXCE4CC7S0048208;LGXCE4CC7S0048323;LGXCE4CC7S0048399",
         "9000.0",
         "170-3 Bônus Operação Dolphin Mini 5 LAbril.25",
         "2",
         "4",
         "2026-01-06 16:20:31.077827"
        ],
        [
         "21",
         "1980",
         "1-2025-025",
         "2025-02-19",
         "LGXCD4C41S0073049;LGXCD4C40S0074161",
         "1400.0",
         "PDIDezembro/24",
         "1",
         "4",
         "2026-01-06 16:20:31.077827"
        ],
        [
         "22",
         "1981",
         "1-2025-026",
         "2025-02-19",
         "LGXCD4C41S0073049;LGXCD4C40S0074161",
         "11992.0",
         "Atacado Dezembro/24",
         "1",
         "4",
         "2026-01-06 16:20:31.077827"
        ],
        [
         "23",
         "2129",
         "8-2025-050",
         "2025-08-08",
         "LC0CE4CB4S4004220;LC0CE4CB3S4001342;LC0CE4CB5S4003531;LC0CE4CB3S4001938;LC0CE4CB5S4003089;LC0CE4CB0S4003503;LC0CE4CB5S4004727;LGXCF6CD5S2000714;LC0CE4CB7S4001148;LC0CE4CB0S4003520",
         "184760.0",
         "173-42 Parcial Bônus Política Comercial Junho.25",
         "8",
         "4",
         "2026-01-06 16:20:31.843074"
        ],
        [
         "24",
         "1983",
         "1-2025-028",
         "2025-03-11",
         "LGXC74C40S0005980;LGXCF6CD2S2003988;LGXC74C44S0002063;LGXC74C41S0043363;LC0CE4CB6S0002718;LGXC74C46S0000671;LPE19W2A3SF029250",
         "70000.0",
         "Resultado Bônus Política Comercial Dezembro/24",
         "1",
         "4",
         "2026-01-06 16:20:31.077827"
        ],
        [
         "25",
         "2127",
         "8-2025-048",
         "2025-07-11",
         "LGXCF6CD4S2004396;LGXCF6CDXS2000773;LGXCF6CD6S2004223;LGXCF6CD5S2004343;LGXCF6CD9S2000599;LGXCF6CD6S2002388;LGXCF6CD4S2001692;LGXCF6CD7S2005039",
         "39998.0",
         "159-42 Bônus Atacado Seal Maio.25",
         "8",
         "4",
         "2026-01-06 16:20:31.843074"
        ],
        [
         "26",
         "1952",
         "2-2025-063",
         "2025-03-11",
         "LC0C74C46S5009229;LC0C74C48S5018904;LC0C74C40S5007010;LGXCF6CD8S2003798;LC0C76C43S0010220;LGXC74C43S0034308;LC0C74C42S5007185;LGXC74C47S0026387;LC0C74C46S5008291;LGXCF6CD1S2002668;LGXC74C47S0026440;LGXC74C47S0017043;LC0C76C46S0029716;LGXC74C42S0033263;LPE19W2A0SF030775;LC0C76C43S0010234;LC0C76C45S0024927;LC0CE4CB6S0002041;LGXC74C40S0027316;LC0C76C41S0012788;LC0C76C41S0012872;LC0C76C49S0022775;LGXC74C49S0040601;LC0C76C49S0018239;LC0C76C45S0010011;LC0CE4CB5S0002662;LGXCE4CC6S0025874;LGXCE4CC9S0028302;LC0C74C43S5007664;LGXC74C41S0034338;LGXC74C42S0004703;LGXC74C43S0010476;LC0C76C47S0029353;LGXC74C45S0042748;LC0C76C47S0010754;LGXC74C43S0030064;LGXC74C4XS0030000;LGXC74C40S0009110;LGXC74C47S0028219;LGXC74C49S0006030;LC0C76C43S0010265;LGXC74C49S0007016;LC0C74C43S5001198;LGXCF6CD9S2000392;LGXC74C46S0030222;LC0C76C45S0021610;LGXC74C45S0028199;LC0CE4CB7S0013453;LGXC74C47S0006799;LC0C76C4XS0012935;LC0C76C41S0012919;LC0C76C49S0017625;LC0C76C49S0022372;LC0C76C46S0029392;LGXC74C41S0030242;LC0C74C43S5007812;LC0C74C44S5008113;LGXC74C42S0010551;LGXC74C45S0030230;LGXC74C45S0030261;LGXC74C49S0030392;LC0CE4CB7S0013419;LC0C76C47S0029496;LC0C76C41S0012998;LGXC74C49S0008277;LGXC74C48S0028827;LGXC74C42S0007715;LC0CE4CB4S0016360;LGXC74C4XS0046908;LGXC74C48S0009422;LGXC74C49S0009140;LGXC74C49S0007128;LGXC74C42S0043422;LC0C76C43S0029673;LC0C76C4XS0018377;LC0C76C45S0029481;LGXC74C45S0006008;LC0CE4CB8S0013414;LGXC74C44S0048587;LGXC74C44S0047035;LC0CE4CB5S0016397;LC0CE4CB8S0013395;LGXC74C48S0010540;LGXCF6CD0S2001897;LC0C74C45S5002398;LC0C74C45S5012848",
         "955160.0",
         "Resultado Bônus Política Comercial Dezembro/24",
         "2",
         "4",
         "2026-01-06 16:20:31.077827"
        ],
        [
         "27",
         "2121",
         "8-2025-042",
         "2025-07-07",
         "LC0CE4CB2S4003423;LC0C74C42S5001385;LC0C74C4XS5005765;LC0C74C40S5003216;LGXCE4CC2S0028349;LGXCE4CC7S0037922;LC0C74C46S5005634;LC0C74C46S5005651;LC0C74C46S5005911;LC0C76C46S0010826;LGXCE4CC6S0041783;LC0C74C46S5009585;LC0C74C4XS5006771;LC0CE4CB1S0008720;LGXCE4CC5S0038650;LC0C76C46S0025360;LC0C74C4XS5012358;LGXCE4CC2S0028478;LGXC74C43S0028153;LGXCE4CC7S0038066;LC0C74C46S5006010;LGXCE4CC6S0041802;LGXC74C43S0020456;LGXCE4CC7S0037659;LC0C74C46S5006525;LC0C74C46S5006007;LC0C74C46S5007075;LGXC74C49S0018467;LC0C74C46S5006069;LGXCE4CC7S0038455;LC0C76C42S0024352;LC0C74C46S5006038;LC0CE4CC1S0012257;LGXCE4CC7S0036446;LC0C76C46S0025388;LGXCF6CD3S2004700;LC0C76C49S0022307;LGXC74C43S0019680;LC0CE4CB0S0009731;LC0CE4CB5S0000832;LC0CE4CC9S0034751;LGXCE4CC6S0048328;LGXCE4CC7S0037936;LGXCE4CC2S0023880;LGXCE4CC6S0031657;LC0CE4CC1S0011710;LC0C74C47S5004752;LC0C74C46S5006881;LGXCE4CC6S0047924;LC0C76C43S0013098;LC0C76C48S0024940;LC0C74C46S5001177;LGXC74C48S0041691;LGXCE4CC4S0023900",
         "10200.0",
         "141-42 Campanhade Alavancagemde Emplacamento Abril.25",
         "8",
         "4",
         "2026-01-06 16:20:31.843074"
        ],
        [
         "28",
         "2026",
         "9-2025-016",
         "2025-08-13",
         "LGXC74C45S0020345;LC0CE4CC7S0036868;LGXCE4CC6S0044568;LC0CE4CB3S4001342;LGXCE4CC3S0044494;LGXC74C44T0000623;LC0CE4CC8S0038323;LC0C76C44S0023333;LC0CE4CB6S4001500;LGXCF6CD4S2001692;LGXCE4CC2S0045202;LGXCF6CD1S2001875;LGXC74C40S0045735;LGXCE4CC3S0043474;LC0CE4CB4S0007447;LC0CE4CC1S0037305;LC0CE4CB4S0007495;LGXC74C42S0018553;LC0CE4CC6S0004462;LC0CE4CC9S0011440;LC0CE4CB9S4003578;LGXC74C46S0046419;LC0CE4CC6S0004459;LC0CE4CC3S0036169;LC0CE4CC8S0038368;LGXCF6CD4S2001806;LGXCE4CC0S0048972;LGXCF6CD4S2004320;LGXC74C43T0003254;LC0C76C47S0013699;LGXCE4CC8T0022136;LC0CE4CCXS0037139;LGXCF6CD5S2000714;LC0CE4CB9S4003886;LC0CE4CB9S4003032;LC0CE4CB9S0007444;LGXC74C44T0000041;LC0CE4CC1S0038535;LC0CE4CC1S0038616;LC0CE4CB9S4003936;LC0CE4CC1S0038373;LGXC74C48T0028375;LGXCE4CC2T0021919;LC0CE4CC2S0038284;LC0C74C41T5002982;LC0C74C42T5004739;LGXCE4CC7T2007356",
         "14300.0",
         "172-74 Alavancagemde Emplacamento Junho/25",
         "9",
         "4",
         "2026-01-06 16:20:31.388098"
        ],
        [
         "29",
         "1994",
         "1-2025-039",
         "2025-03-21",
         "LGXCE4CC4S0044438;LC0CE4CC9S0005606;LGXCE4CC2S0054210;LGXCE4CC3S0052966;LGXCE4CC4S0044732;LGXCE4CC7S0042540;LGXCE4CC9S0022905",
         "9240.0",
         "098-43 Reembolso Carregadores Setembro.24",
         "1",
         "4",
         "2026-01-06 16:20:31.077827"
        ],
        [
         "30",
         "1992",
         "1-2025-037",
         "2025-05-31",
         "LC0CE4CB1S0008734;LGXCF6CD8S2001985",
         "6300.0",
         "110-43 Bônus Performance",
         "1",
         "4",
         "2026-01-06 16:20:31.077827"
        ],
        [
         "31",
         "1993",
         "1-2025-038",
         "2025-05-31",
         "LGXCF6CD2S2001531;LGXCF6CD5S2003497;LGXCF6CDXS2000272",
         "3000.0",
         "107-43 Reembolso Bônusvendedor Seal Mar.25",
         "1",
         "4",
         "2026-01-06 16:20:31.077827"
        ],
        [
         "32",
         "2148",
         "4-2025-011",
         "2025-07-11",
         "LGXCF6CD5S2000986;LGXCF6CD4S2001577;LGXCF6CD3S2002686",
         "14999.0",
         "159-162 Bônus Atacado Seal Maio.25",
         "4",
         "4",
         "2026-01-06 16:20:31.843074"
        ],
        [
         "33",
         "2118",
         "8-2025-039",
         "2025-04-06",
         "LGXCE4CC0S0034554;LGXCE4CC0S0035560;LC0C74C4XS5018239;LC0C74C4XS5012313;LC0CE4CB5S0017971;LGXCE4CC6S0032520;LC0C74C4XS5016295;LGXCE4CC0S0035090;LGXCE4CC3S0038551;LC0CE4CC2S0006175;LGXCE4CC0S0035798;LGXCE4CCXS0033119;LGXCE4CCXS0033623;LPE19W2A4SF029080;LC0CE4CB4S0009747;LGXCE4CC6S0034140;LGXCE4CCXS0033542;LGXCE4CCXS0033900;LGXCE4CC7S0028363;LGXCE4CC0S0036286;LGXC74C43S0018724;LC0C76C48S0012772;LC0C74C46S5019498;LGXCE4CCXS0033511;LGXCE4CC0S0036319;LC0C74C46S5019503;LC0CE4CB5S0008705;LGXCE4CC7S0030520;LGXC74C49S0017089;LC0C76C42S0024884;LC0C74C4XS5014515;LC0C74C40S5002809;LGXCE4CC0S0035882;LC0C74C4XS5013008;LGXCE4CC5S0038566;LGXCE4CC5S0038678;LC0C76C46S0025407;LC0C74C4XS5011047;LC0C74C4XS5011209;LGXCE4CC5S0038633;LGXCE4CC2S0026763",
         "8000.0",
         "114-42 Alavancagemde Emplacamento Março.25",
         "8",
         "4",
         "2026-01-06 16:20:31.843074"
        ],
        [
         "34",
         "2122",
         "8-2025-043",
         "2025-07-07",
         "LC0CE4CB4S4003777;LC0CE4CB4S0007481;LC0CE4CB4S0007478;LC0CE4CB7S4003319;LC0CE4CC8S0034353;LC0CE4CC8S0033784;LC0CE4CC7S0033789;LC0CE4CC4S0034365;LC0CE4CC1S0037093;LC0CE4CC0S0037375;LGXC74C43T0003240;LGXC74C43T0001746;LGXC74C43T0001150;LGXC74C43T0000712;LGXC74C42T0001897;LC0CE4CC9S0037181;LC0CE4CC9S0037178;LC0CE4CC9S0037164;LC0CE4CC9S0037147;LC0CE4CC9S0037097;LC0CE4CC1S0036137;LC0CE4CC0S0036887;LC0CE4CC0S0036470;LC0CE4CC0S0036436;LC0CE4CC0S0036162;LC0CE4CB5S4004789;LC0CE4CB5S4004727;LC0CE4CB5S4003531;LC0CE4CB5S4003089;LC0CE4CB4S4004220;LC0CE4CB4S4004119;LC0CE4CB3S4001938;LC0CE4CB3S4001471;LC0CE4CB3S4001406;LC0CE4CB3S4001342;LC0CE4CB3S4001325;LC0CE4CC7S0038636;LC0CE4CC7S0038586;LC0CE4CC7S0038555;LC0CE4CC7S0038524;LC0CE4CC2S0038303;LC0CE4CC2S0038298;LC0CE4CC2S0038284;LC0CE4CB5S0007912;LC0CE4CB5S0007523;LGXCD4C47T0035889;LGXCD4C46T0036743;LGXCD4C43T0036411",
         "62401.0",
         "145-42 Bônus Performance Maio.25",
         "8",
         "4",
         "2026-01-06 16:20:31.843074"
        ],
        [
         "35",
         "2123",
         "8-2025-044",
         "2025-08-07",
         "LC0C76C42S0024352;LC0C76C43S0013098;LC0C76C44S0023381;LC0C76C46S0025388;LC0C76C47S0024427;LC0C76C47S0024461;LC0C76C47S0025402;LC0C76C48S0024940;LC0C76C49S0022307;LC0CE4CB0S0009731;LC0CE4CBXS0017769;LC0CE4CC9S0004777;LGXC74C43S0040710;LGXCF6CD3S2004700;LGXCF6CDXS2002622",
         "123680.0",
         "143-42 Bônus Política Comercial Abril.25",
         "8",
         "4",
         "2026-01-06 16:20:31.843074"
        ],
        [
         "36",
         "2124",
         "8-2025-045",
         "2025-08-07",
         "LC0CE4CB4S4003777;LC0CE4CB7S4003319;LC0CE4CB8S4003197;LC0CE4CB3S4001406;LC0CE4CB3S4001325;LC0CE4CB4S4004119;LC0CE4CB3S4001471;LGXCF6CD3S2004082;LC0CE4CB5S4004789",
         "167934.0",
         "146-42 Parcial Bônus Política Comercial Maio.25",
         "8",
         "4",
         "2026-01-06 16:20:31.843074"
        ],
        [
         "37",
         "2125",
         "8-2025-046",
         "2025-07-09",
         "LGXCE4CC6S0048281;LC0CE4CC0S0012671;LGXCE4CC8S0047911;LGXCE4CC6S0048409;LGXCE4CC8S0048508;LC0C76C44S0023381;LGXC74C43S0040710;LC0CE4CC7S0012666;LC0CE4CC9S0012409;LGXCE4CC6S0047891;LC0C76C49S0021013;LGXCE4CC2S0023670;LGXCE4CC9S0047366;LC0CE4CB4S4003777;LC0CF4CD2S0002391;LGXC74C40S0049588;LC0CE4CB4S0007478;LGXCE4CC2S0023894;LGXCF6CD4S2004138;LGXCE4CC8S0048511;LC0CE4CC6S0010715;LGXCE4CC4S0052748;LGXCE4CC4S0049025;LGXCE4CCXS0052396;LC0CE4CB7S4003319;LC0CE4CC9S0010630;LGXCE4CCXS0048851;LC0C76C4XS0012983;LC0C76C47S0025433;LC0CE4CC8S0034353;LGXCF6CD3S2004518;LC0C76C46S0019350;LC0CE4CB6S4003957;LC0CE4CB4S0007481;LC0CE4CC7S0033789;LGXC74C49S0042753;LC0C76C46S0025374;LGXCE4CC6S0052587;LGXCE4CC9S0052647;LC0CE4CC7S0038524;LGXCE4CC5S0044836;LGXCE4CC5S0046599;LC0CE4CB4S4003052;LC0CE4CC8S0033784;LGXCE4CC5S0044108;LGXCE4CC5S0042360;LC0CE4CB8S4003197;LC0CE4CC1S0037093;LC0C76C4XS0012806;LGXCE4CC0S0049006",
         "24000.0",
         "144-42 Campanhade Alavancagemde Emplacamento Maio.25",
         "8",
         "4",
         "2026-01-06 16:20:31.843074"
        ],
        [
         "38",
         "2131",
         "8-2025-052",
         "2025-08-13",
         "LGXC74C44T0000606;LGXC74C48T0026478;LC0CE4CC9S0037164;LGXC74C47T0024897;LGXC74C40T0026801;LC0CE4CC7S0038555;LGXC74C41T0026516;LC0CE4CB3S4001938;LGXC74C43T0000712;LC0C76C47S0022290;LGXC74C47T0002382;LC0C76C48S0025327;LC0CE4CC0S0036887;LC0CE4CC0S0036162;LC0C74C43T5003342;LC0C76C47S0025450;LGXC74C40S0046433;LC0CE4CC0S0036436;LC0CE4CC1S0036137;LGXC74C41S0045727;LC0CE4CB5S0001155;LGXCD4C48T0036677;LGXCD4C44T0036529;LC0CE4CC7S0038636;LC0C76C4XS0022199;LGXCE4CC5S0046649;LC0C76C4XS0012885;LC0CE4CB5S4004789;LC0CE4CC4S0034365;LGXC74C43S0040688;LGXCF6CD3S2004082;LC0C76C4XS0013017;LGXC74C42S0046918;LGXCE4CC1S0041321;LGXC74C43T0001746;LC0CE4CC0S0036470;LC0CE4CB0S4003503;LGXC74C46T0027709;LC0CE4CC2S0033702;LGXCE4CC9S0032835;LGXC74C42T0001897;LGXCE4CC5T0022109;LC0CE4CB8S0007953;LGXC74C4XT0027714;LGXC74C47T0029078;LC0CE4CC1T0002961;LGXCE4CC9T0022016;LC0CE4CC0T0003468;LC0CE4CB0S4003520;LC0CE4CB7S4001148;LC0CE4CC0T0003437;LGXC74C4XT0028507",
         "5100.0",
         "172-42 Alavancagemde Emplacamento Junho/25",
         "8",
         "4",
         "2026-01-06 16:20:31.843074"
        ],
        [
         "39",
         "2130",
         "8-2025-051",
         "2025-08-11",
         "LGXC74C43T0000712;LGXC74C42T0001897;LGXC74C43T0003240;LGXC74C43T0001746;LGXC74C43T0001150;LC0C74C43T5003342;LGXC74C48T0026478;LGXC74C47T0024897;LGXC74C47T0002589;LC0CE4CB0S4003520;LC0C74C40T5002942;LC0C74C40T5002147;LC0C74C40T5002097;LGXC74C41T0026516;LGXC74C40T0026801;LC0CE4CBXS4003735;LC0CE4CBXS4003640;LC0CE4CB0S4003503;LC0C74C47T5003215;LC0C74C45T5003066;LC0C74C44T5004368;LC0C74C47T5003828;LC0C74C47T5001643;LC0CE4CC0T0003468;LC0CE4CC0T0003440;LC0C74C43T5021694;LC0C74C42T5021055;LGXCD4C41T0053448;LGXC74C4XT0050507;LC0CE4CC1T0002975;LC0CE4CC1T0002961;LC0C74C4XT5021613;LGXCD4C40T0054378;LGXCD4C41T0061033;LGXCD4C41T0057113;LGXCD4C40T0061220;LC0CE4CB7S4001148;LC0CE4CB2S0016518;LC0CE4CB9S4002236;LC0CE4CB8S4002955;LC0CE4CB4S4003875;LC0CE4CB4S4003228;LC0CE4CC2T0003942;LC0CE4CC2T0003939;LC0CE4CC2T0003908;LC0CE4CC2T0003892;LC0CE4CC2T0003875",
         "69419.0",
         "174-42 Bônus Performance Junho.25",
         "8",
         "4",
         "2026-01-06 16:20:31.843074"
        ],
        [
         "40",
         "2012",
         "9-2025-002",
         "2025-07-03",
         "LC0C76C41S0012807;LC0C74C42S5007221;LGXCF6CD0S2002564;LGXCF6CD4S2005919;LC0C74C47S5002340;LC0C74C47S5007019;LC0C74C48S5019132;LC0C74C48S5018420;LC0C74C46S5020957;LC0C74C40S5021831;LC0C76C4XS0011560;LGXCF6CD0S2001513;LGXCF6CD2S2000685;LGXC74C44S0028131;LGXC74C45S0000693;LC0C74C48S5020975;LGXC74C41S0007074;LC0CE4CB7S4003854;LGXC74C49S0027203;LC0C74C48S5021785;LC0C74C48S5021821;LGXC74C44S0010678;LC0C74C40S5019173;LC0C74C43S5022228;LC0C74C45S5022117;LC0C74C46S5021977;LC0C74C47S5018599;LC0C74C48S5009071;LC0C76C4XS0011610;LC0C76C4XS0011641;LC0C76C4XS0024177;LC0C76C4XS0024552;LC0C76C41S0010068;LC0C76C44S0010193;LC0C76C4XS0024163;LGXCE4CC3S0038016;LGXCE4CC4S0041815;LGXCF6CD8S2003798;LC0C74C46S5022594;LGXC74C43S0034308;LGXCF6CD1S2002668;LC0C74C45S5007147;LC0CE4CB3S4004533;LC0C76C45S0024927;LC0C74C41S5009235;LC0C76C49S0018239;LC0C76C47S0009958;LGXCE4CC3S0048772;LC0C74C41S5022261;LC0C74C43S5008720;LGXC74C40S0009110;LGXC74C43S0030064;LC0C76C47S0010754;LGXCE4CC8S0024595;LC0CE4CC7S0013557;LC0C74C43S5007597;LC0C74C41S5009123;LGXC74C47S0028219;LGXCD4C46S0074651;LGXC74C49S0006030;LGXCE4CC7S0023048;LC0C76C43S0010265;LC0C76C4XS0011607;LC0C76C4XS0025250;LGXCE4CC2S0048830;LC0C74C44S5022268;LC0C76C4XS0010957;LC0C74C44S5008502;LGXC74C45S0028199;LC0C74C45S5004278;LC0C74C45S5020495;LC0C74C44S5022271;LC0C74C41S5009042;LC0C76C46S0010096;LC0C76C46S0029392;LC0C74C45S5008931;LC0C74C46S5007240;LGXC74C41S0030242;LGXC74C42S0010551;LGXC74C45S0030230;LGXC74C45S0030261;LGXC74C49S0030392;LC0C74C45S5020478;LGXC74C49S0008277;LC0C74C44S5000660;LC0C74C45S5004250;LC0C74C44S5006507;LC0C74C44S5001694;LC0C74C43S5008457;LC0C74C43S5008426;LC0C74C43S5007616;LC0C74C4XS5011887;LC0C74C45S5018620",
         "174460.0",
         "Resultado Campanhade Alavancagemde Emplacamento Dezembro/24",
         "9",
         "4",
         "2026-01-06 16:20:31.388098"
        ],
        [
         "41",
         "2013",
         "9-2025-003",
         "2025-07-03",
         "LGXC74C49S0009140;LC0C74C48S5021463;LC0C76C43S0029673;LC0CE4CC2S0012123;LC0C76C4XS0018377;LGXCE4CC4S0055441;LC0C74C45S5020481;LC0C74C40S5006651;LGXCE4CC2S0033759;LGXCE4CC4S0055648;LC0C74C40S5006603;LC0C76C46S0029635;LC0C74C4XS5021531;LGXC74C46S0009113;LC0C74C4XS5021500;LGXCE4CC2S0048956;LC0C76C42S0024187;LC0C74C4XS5009931;LGXC74C49S0009171;LGXCE4CC7S0047270;LGXCE4CC6S0047812;LGXCD4C44S0074664;LGXCD4C43S0074610;LGXC74C42S0009268;LGXCE4CC6S0047745;LC0CE4CB7S0013372;LC0CE4CB5S0016318;LC0C74C49S5012898;LGXC74C48S0046888;LGXC74C48S0046910;LC0C74C40S5002373;LC0C74C48S5009619;LC0C76C4XS0022851;LC0C74C49S5021469;LGXC74C4XS0027257;LC0C76C48S0012741;LGXCF6CD5S2004939",
         "6700.0",
         "Resultado Campanhade Alavancagemde Emplacamento Janeiro/25",
         "9",
         "4",
         "2026-01-06 16:20:31.388098"
        ],
        [
         "42",
         "2021",
         "9-2025-011",
         "2025-07-09",
         "LGXC74C46S0018670;LC0C74C49S5021293;LGXC74C4XS0046911;LGXC74C46S0016823;LGXCF6CD3S2004745;LC0CE4CC0S0006000;LC0CE4CC3S0012423;LGXCE4CC0S0038510;LC0CE4CC5S0004453;LGXC74C42S0020481;LC0C76C49S0018998;LC0CE4CC7S0004499;LC0CE4CC8S0011431;LGXC74C45S0016778;LGXC74C45S0018658;LGXC74C42S0023199;LGXCE4CC9S0048811;LC0CE4CB9S4001782;LGXCF6CDXS2000773;LGXCE4CC4S0048523;LGXCF6CD4S2004396;LC0CE4CB6S4001707;LC0CE4CB0S4004439;LC0CE4CB4S0007450;LC0CE4CC8S0036068;LGXCE4CC2S0052215;LGXCE4CC0S0047403;LGXC74C45S0020507;LGXC74C46S0012643;LGXCF6CD5S2004391;LGXCE4CC5S0048773;LGXCE4CC6S0052332;LGXCE4CC9S0047352;LPE19W2AXSF030699;LGXCE4CC5S0048899;LC0CE4CC3S0037175;LC0CE4CC8S0036099;LGXC74C42S0040729;LC0C76C46S0025357;LGXCE4CC6S0051911;LGXCE4CC9S0025240;LGXCE4CC8S0025245;LC0CE4CC8S0036023;LC0C76C45S0023535;LC0CE4CB0S4004344;LC0CE4CC4S0012513;LC0CE4CB4S0000465;LC0CE4CB3S4001406;LC0CE4CB4S4004119;LC0CE4CB6S0002038;LC0CE4CB3S0000506;LGXCE4CC8S0052431;LC0C76C41S0028733;LGXC74C40S0019684;LGXC74C42S0040701;LC0CE4CB3S4001471",
         "78600.0",
         "144-74 Campanhade Alavancagemde Emplacamento Maio.25",
         "9",
         "4",
         "2026-01-06 16:20:31.388098"
        ],
        [
         "43",
         "2014",
         "9-2025-004",
         "2025-03-21",
         "LGXC74C49S0009171;LGXCD4C43S0074610;LGXC74C42S0009268;LC0C74C49S5012898;LGXC74C48S0046910;LC0C74C40S5002373;LC0C76C4XS0022851;LC0C74C48S5009619;LC0C74C49S5021469;LC0C76C48S0012741;LGXC74C4XS0027257;LC0C74C41S5003242;LC0C74C49S5009497;LC0C74C49S5011735;LGXC74C43S0018626;LGXCD4C45S0075113",
         "77452.0",
         "Bônus Politicacomercial Janeiro/25",
         "9",
         "4",
         "2026-01-06 16:20:31.388098"
        ],
        [
         "44",
         "2016",
         "9-2025-006",
         "2025-05-31",
         "LGXCF6CD3S2000372;LGXCF6CD7S2000598",
         "2000.0",
         "107-74 Reembolso Bônusvendedor Seal Mar.25",
         "9",
         "4",
         "2026-01-06 16:20:31.388098"
        ],
        [
         "45",
         "1950",
         "2-2025-061",
         "2025-02-19",
         "LC0C74C41S5009008;LC0C74C41S5009025;LC0C74C41S5009042;LC0C74C41S5009073;LC0C74C41S5009090;LC0C74C41S5009106;LC0C74C41S5009123;LC0C74C41S5009185;LC0C74C41S5009199;LC0C74C41S5009235;LC0C74C45S5000263;LC0C74C45S5000909;LC0C74C45S5001218;LC0C74C45S5001560;LC0C74C45S5001980;LC0C74C45S5003552;LC0C74C45S5004250;LC0C74C45S5004278;LC0C74C45S5004345;LC0C74C45S5004670;LC0C74C45S5005530;LC0C74C45S5005950;LC0C74C45S5006094;LC0C74C45S5007147;LC0C74C45S5007181;LC0C74C45S5008931;LC0C74C45S5009349;LC0C74C45S5009402;LC0C74C46S5000255;LC0C74C46S5000319;LC0C74C46S5001163;LC0C74C46S5002796;LC0C74C46S5004063;LC0C74C46S5005598;LC0C74C46S5005620;LC0C74C46S5006542;LC0C74C46S5006895;LC0C74C46S5007092;LC0C74C46S5007139;LC0C74C46S5007240;LC0C74C43S5006496;LC0C74C43S5006983;LC0C74C43S5007552;LC0C74C43S5007597;LC0C74C43S5007616;LC0C74C43S5007695;LC0C74C43S5008314;LC0C74C43S5008376;LC0C74C43S5008720;LC0C74C43S5008734;LC0C74C43S5008748;LC0C74C43S5008801;LC0C74C43S5009317;LC0C74C44S5000660;LC0C74C44S5001064;LC0C74C44S5001100;LC0C74C44S5001534;LC0C74C44S5005390;LC0C74C44S5005437;LC0C74C44S5005454;LC0C74C44S5005499;LC0C74C44S5006393;LC0C74C44S5006426;LC0C74C44S5006474;LC0C74C44S5006507;LC0C74C44S5006927;LC0C74C44S5007060;LC0C74C44S5008306;LC0C74C44S5008502;LC0C74C44S5008743;LC0C74C41S5009266;LC0C74C41S5009283;LC0C74C41S5009297;LC0C74C42S5000821;LC0C74C42S5001788;LC0C74C42S5003038;LC0C74C42S5003606;LC0C74C42S5003721;LC0C74C42S5003816;LC0C74C42S5004528;LGXCD4C48S0074795;LGXCD4C42S0074792;LGXCD4C44S0075099;LGXCD4C43S0074610;LGXCD4C46S0074651;LGXCD4C45S0075113;LGXCD4C42S0074680;LGXCD4C42S0073903;LGXCD4C41S0073052;LC0C76C4XS0025796;LC0C76C42S0024187;LC0C74C49S5021469;LC0C74C49S5021536;LC0C74C4XS5002719;LC0C74C4XS5021366;LC0C74C41S5009008;LC0C74C41S5009025;LC0C74C41S5009042;LC0C74C41S5009073;LC0C74C41S5009090;LC0C74C41S5009106;LC0C74C41S5009123;LC0C74C41S5009185;LC0C74C41S5009199;LC0C74C41S5009235;LC0C74C45S5000263;LC0C74C45S5000909;LC0C74C45S5001218;LC0C74C45S5001560;LC0C74C45S5001980;LC0C74C45S5003552;LC0C74C45S5004250;LC0C74C45S5004278;LC0C74C45S5004345;LC0C74C45S5004670;LC0C74C45S5005530;LC0C74C45S5005950;LC0C74C45S5006094;LC0C74C45S5007147;LC0C74C45S5007181;LC0C74C45S5008931;LC0C74C45S5009349;LC0C74C45S5009402;LC0C74C46S5000255;LC0C74C46S5000319;LC0C74C46S5001163;LC0C74C46S5002796;LC0C74C46S5004063;LC0C74C46S5005598;LC0C74C46S5005620;LC0C74C46S5006542;LC0C74C46S5006895;LC0C74C46S5007092;LC0C74C46S5007139;LC0C74C46S5007240;LC0C74C43S5006496;LC0C74C43S5006983;LC0C74C43S5007552;LC0C74C43S5007597;LC0C74C43S5007616;LC0C74C43S5007695;LC0C74C43S5008314;LC0C74C43S5008376;LC0C74C43S5008720;LC0C74C43S5008734;LC0C74C43S5008748;LC0C74C43S5008801;LC0C74C43S5009317;LC0C74C44S5000660;LC0C74C44S5001064;LC0C74C44S5001100;LC0C74C44S5001534;LC0C74C44S5005390;LC0C74C44S5005437;LC0C74C44S5005454;LC0C74C44S5005499;LC0C74C44S5006393;LC0C74C44S5006426;LC0C74C44S5006474;LC0C74C44S5006507;LC0C74C44S5006927;LC0C74C44S5007060;LC0C74C44S5008306;LC0C74C44S5008502;LC0C74C44S5008743;LC0C74C41S5009266;LC0C74C41S5009283;LC0C74C41S5009297;LC0C74C42S5000821;LC0C74C42S5001788;LC0C74C42S5003038;LC0C74C42S5003606;LC0C74C42S5003721;LC0C74C42S5003816;LC0C74C42S5004528;LGXCD4C48S0074795;LGXCD4C42S0074792;LGXCD4C44S0075099;LGXCD4C43S0074610;LGXCD4C46S0074651;LGXCD4C45S0075113;LGXCD4C42S0074680;LGXCD4C42S0073903;LGXCD4C41S0073052;LC0C76C4XS0025796;LC0C76C42S0024187;LC0C74C49S5021469;LC0C74C49S5021536;LC0C74C4XS5002719;LC0C74C4XS5021366;LC0C74C4XS5021433;LC0C74C4XS5021481;LC0C74C4XS5021500;LC0C74C4XS5021531;LC0C74C41S5000793;LC0C74C41S5002236;LC0C74C41S5002317;LC0C74C41S5002947;LC0C74C41S5003256;LC0C74C47S5004010;LC0C74C48S5009619;LC0C74C43S5008426;LC0C74C43S5008457;LC0C74C43S5008460;LC0C74C43S5009009;LC0C74C43S5009012;LC0C74C46S5019968;LC0C74C46S5021350;LC0C74C46S5021400;LC0C74C47S5019428;LC0C74C47S5021390;LC0C74C48S5018286;LC0C74C48S5018370;LC0C74C48S5021172;LC0C74C48S5021463;LC0C74C49S5020810;LC0C74C44S5000402;LC0C74C44S5000738;LC0C74C44S5000741;LC0C74C44S5000769;LC0C74C44S5001436;LC0C74C44S5001694;LC0C74C44S5001954;LC0C74C44S5002103;LC0C74C44S5002215;LC0C74C44S5002554;LC0CE4CB0S0013391;LC0CE4CB0S0016453;LC0CE4CB0S0017800;LC0CE4CB0S0017828;LC0CE4CB0S0017845;LC0CE4CB1S0016557;LGXC74C44S0018621;LGXC74C44S0020398;LGXC74C44S0021907;LGXC74C45S0016778;LGXC74C45S0018627;LGXC74C45S0018658;LGXC74C45S0019535;LGXC74C45S0020345;LGXC74C45S0020507;LGXC74C46S0012643;LGXC74C46S0016630;LGXC74C46S0016823;LGXC74C46S0016949;LGXC74C46S0018622;LGXC74C46S0018667;LGXC74C46S0018670;LGXC74C43S0016889;LGXC74C43S0016892;LGXC74C43S0016942;LGXC74C43S0018626;LGXC74C43S0018724;LGXC74C43S0019629;LGXC74C43S0019680;LGXC74C43S0020344;LGXC74C43S0020456;LGXC74C43S0020487;LGXC74C43S0020604;LGXC74C44S0016691;LGXC74C40S0019572;LGXC74C40S0019605;LGXC74C40S0019619;LGXC74C40S0019684;LGXC74C42S0018553;LGXC74C42S0018682;LGXC74C42S0020366;LGXC74C42S0020481;LGXC74C43S0016763;LGXC74C43S0016780;LGXC74C43S0016827;LGXC74C43S0016861;LC0C76C47S0012715;LC0C76C47S0012763;LC0C76C47S0012777;LC0C76C47S0012858;LC0C76C47S0012892;LC0C76C47S0012911;LC0C76C47S0012925;LC0C76C47S0012939;LC0C76C47S0013010;LC0C76C48S0011881;LC0C76C48S0012691;LC0C76C48S0012741;LC0C76C48S0012769;LC0C76C48S0012772;LC0C76C48S0012786;LC0C76C48S0012805;LC0C76C48S0012836;LC0C76C48S0012853;LC0C74C47S5006405;LC0C74C49S5012917;LC0C74C49S5012920;LC0C74C49S5013923;LC0C74C49S5014098;LC0C74C49S5014733;LC0C74C4XS5009931;LC0C74C4XS5011887;LC0C74C4XS5012666;LC0C74C49S5009449;LC0C74C49S5009452;LC0C74C49S5009466;LC0C74C49S5009483;LC0C74C49S5009497;LC0C74C49S5009516;LC0C74C49S5009533;LC0C74C49S5010116;LC0C74C49S5010780;LC0C74C49S5010875;LC0C74C49S5011184;LC0C74C49S5011623;LC0C74C49S5011671;LC0C74C49S5011718;LC0C74C49S5011735;LC0C74C49S5011766;LC0C74C49S5011802;LC0C74C49S5015901;LC0C74C49S5015915;LC0C74C49S5015980;LC0C74C40S5001000;LC0C74C40S5001224;LC0C74C40S5002373;LC0C74C40S5002650;LC0C74C40S5003197;LC0C74C40S5003488;LC0C74C40S5003507;LC0C74C40S5004060;LC0C74C40S5004138;LC0C74C40S5004141;LC0C74C40S5004303;LC0C74C40S5004396;LC0C74C40S5004690;LC0C74C40S5005600;LC0C74C40S5006021;LC0C74C40S5006097;LC0C74C40S5006553;LC0C74C40S5006567;LC0C74C40S5006603;LC0C74C40S5006651;LC0C74C40S5006682;LC0C74C40S5006889;LC0C74C40S5007105;LC0C74C40S5007136;LC0C74C40S5007203;LC0C74C40S5007220;LC0C74C40S5008013;LC0C74C40S5008030;LC0C74C40S5008058;LC0C74C40S5008061;LC0C74C40S5008075;LC0C74C40S5008089;LC0C74C40S5008108;LC0C74C40S5008111;LC0C74C40S5008142;LC0C74C40S5008223;LC0C74C40S5008965;LC0C74C40S5009694;LC0C74C40S5011252;LC0C74C41S5000325;LC0C74C41S5000857;LC0C74C41S5000891;LC0C74C41S5001247;LC0C74C41S5001491;LC0C74C41S5001880;LC0C74C41S5001944;LC0C74C41S5002429;LC0C74C41S5002785;LC0C74C41S5002835;LC0C74C41S5003192;LC0C74C41S5003242;LC0C74C41S5004049;LC0C74C41S5004102;LC0C74C41S5004245;LC0C74C41S5004312;LC0C74C41S5004651;LC0C74C41S5005170;LC0C74C41S5005203;LC0C74C41S5005573;LC0C74C41S5006013;LC0C74C49S5012898",
         "1090260.0",
         "Atacado Dezembro/24",
         "2",
         "4",
         "2026-01-06 16:20:31.077827"
        ],
        [
         "46",
         "2025",
         "9-2025-015",
         "2025-08-11",
         "LGXC74C48T0000754;LGXC74C40T0000750;LC0CE4CBXS4001449;LC0CE4CBXS4001127;LC0CE4CBXS4000821;LC0CE4CB9S4003273;LC0CE4CB9S4003208;LGXC74C4XT0052130;LGXC74C43T0052096",
         "13398.0",
         "174-74 Bônus Performance Junho.25",
         "9",
         "4",
         "2026-01-06 16:20:31.388098"
        ],
        [
         "47",
         "1951",
         "2-2025-062",
         "2025-07-03",
         "LC0C74C42S5007154;LC0C74C42S5021135;LGXCE4CC4S0055407;LGXCE4CC4S0055682;LC0C74C46S5008212;LC0C74C46S5022112;LC0C74C49S5000282;LC0C74C42S5021605;LGXCE4CC3S0048755;LC0C74C43S5022214;LC0C74C42S5017182;LGXC74C48S0033414;LGXCD4C44S0073658;LGXCD4C44S0073661;LC0C74C40S5008707;LC0C76C43S0029642;LC0C76C43S0009018;LGXC74C44S0026556;LGXCE4CC3S0038226;LGXCE4CC4S0057075;LC0C74C48S5008406;LGXCF6CD1S2000449;LC0CE4CC0S0004666;LC0CE4CC3S0012678;LC0CE4CB0S0005033;LGXCE4CC5S0047445;LGXCE4CC5S0047459;LC0C74C47S5006999;LC0C76C45S0010154;LC0C74C48S5017722;LC0CE4CC1S0009570;LGXCE4CC4S0056878;LGXCE4CC6S0048989;LC0C74C48S5022029;LGXC74C41S0033240;LC0C74C49S5020306;LC0C76C4XS0011588;LC0C76C47S0010124;LC0C76C47S0011516;LC0C76C48S0010147;LC0C76C46S0009918;LC0C74C40S5022266;LC0C74C42S5007252;LC0C74C42S5022284;LC0C74C43S5022200;LC0C74C44S5022254;LC0C74C46S5009151;LC0C74C47S5009143;LC0C74C46S5020084;LC0C76C41S0010135;LC0CE4CB0S4002206;LC0C74C46S5009229;LC0CE4CC2S0005656;LC0C74C40S5007010;LC0C76C43S0010220;LGXCE4CC2S0053767;LGXCE4CC2S0038847;LC0C74C43S5008376;LC0C74C41S5022129;LC0CE4CC4S0004508;LGXC74C47S0026440;LC0C76C46S0010020;LC0C76C4XS0025300;LC0C74C41S5009297;LC0C74C43S5008801;LGXC74C47S0026387;LGXC74C40S0027316;LC0C76C43S0010234;LC0C74C4XS5021030;LC0CE4CB6S0002041;LPE19W2A0SF030775;LC0C74C45S5001218;LGXCF6CD2S2003988;LGXCE4CC3S0049274;LC0C76C41S0012788;LC0CE4CB1S4002294;LC0C74C46S5005620;LC0C74C45S5022277;LGXCE4CCXS0027093;LGXCE4CC5S0028586;LGXCE4CC6S0017659;LGXCE4CC9S0028333;LGXCE4CC4S0028305;LGXCE4CC3S0057701;LC0C76C4XS0009906;LC0C76C45S0010011;LGXCD4C40S0074659;LC0CE4CB7S0001240;LGXC74C42S0004703;LGXC74C43S0010476;LC0C74C45S5001560;LC0C74C46S5007139;LC0C74C46S5006895;LGXCE4CCXS0028342;LC0CE4CB5S0002662;LC0C74C42S5004528;LC0C74C41S5009025;LC0C74C41S5009185;LC0C74C44S5006927;LGXCD4C42S0074680;LGXCD4C44S0075099;LC0C74C45S5018598;LC0C74C45S5022280;LC0C74C41S5009283;LC0C74C42S5000821;LC0C74C43S5006983;LGXCE4CC7S0033966;LGXCE4CC6S0055490;LGXC74C49S0007016;LC0C74C49S5021696;LC0C74C44S5001064;LGXCD4C41S0073911;LGXCE4CC6S0021145;LGXCE4CCXS0045030;LC0C74C43S5008734;LC0C74C45S5001980;LC0C74C46S5000319;LC0C74C43S5009317;LC0C74C44S5005499;LC0C74C45S5007181;LC0CE4CB7S0013453;LGXC74C47S0006799;LPE19W2A1SF030610;LC0C74C44S5005390;LC0C76C44S0009187;LC0C76C41S0025606;LGXC74C41S0025820;LC0C74C44S5005437;LPE19W2A4SF030018;LPE19W2A1SF030624;LC0C74C44S5006474;LGXCD4C42S0074792;LC0CE4CB3S0019489;LC0CE4CB1S4001355;LC0C74C44S5001954;LC0C74C43S5022262;LC0C74C41S5002317;LC0C74C46S5005598;LGXCE4CC0S0047708;LC0CE4CB4S0016360;LC0C74C49S5014098;LC0C74C49S5013923;LC0C74C47S5021390;LC0C74C47S5019428;LC0C74C47S5004010;LC0C74C46S5021350;LGXCD4C42S0073903;LGXC74C4XS0046908;LGXC74C48S0009422",
         "241860.0",
         "Resultado Campanhade Alavancagemde Emplacamentos Dezembro/24",
         "2",
         "4",
         "2026-01-06 16:20:31.077827"
        ],
        [
         "48",
         "1954",
         "2-2025-065",
         "2025-03-21",
         "LGXC74C49S0007128;LC0C74C49S5012917;LGXCE4CC5S0057313;LGXCE4CC4S0057433;LC0C74C4XS5012666;LGXCE4CCXS0044895;LGXCE4CC2S0040081;LC0C74C43S5007552;LGXC74C46S0000671;LC0CE4CB6S0002718;LGXCE4CC6S0055344;LGXCE4CC6S0055392;LGXC74C44S0047035;LC0C74C44S5002215;LC0C74C40S5004396;LGXC74C48S0010540;LC0C74C47S5006405;LC0C74C40S5003197;LC0CE4CC6S0004414;LC0C76C47S0012763;LC0C76C47S0012892;LC0C76C41S0009163;LC0C74C48S5021172;LGXCE4CC7S0035023;LC0C74C41S5001880;LC0C74C42S5001788;LC0C74C48S5018286;LC0C76C46S0024290;LC0C76C48S0011881;LC0CE4CB1S4003056;LGXCE4CC6S0057403;LGXC74C40S0019572;LC0CE4CC0S0004635;LC0C76C48S0012769;LGXCD4C41S0073052;LC0C74C41S5002835;LC0C76C40S0027105;LC0C76C41S0026271;LC0C74C49S5009449;LGXC74C42S0019587;LGXCE4CC2S0053414;LC0C76C48S0012691;LC0CE4CBXS0013379;LC0C74C41S5002785;LGXCE4CC7S0023017;LC0CE4CB5S0016500;LC0C74C48S5018370;LGXCE4CC8S0035015;LC0C74C49S5020810;LGXCE4CCXS0028616;LC0CE4CB6S0002671;LC0C76C4XS0022364;LC0C74C49S5009452;LC0C76C48S0012805;LC0C74C4XS5002719;LGXC74C40S0019605;LGXC74C47S0026390;LGXCE4CC7S0028475;LGXCE4CC3S0038291;LGXCE4CC4S0040910;LC0CE4CC9S0012068;LGXCE4CC1S0027077;LC0CE4CC9S0012670;LC0C76C45S0029674",
         "11200.0",
         "Resultado Campanhade Alavancagemde Emplacamento Janeiro/25",
         "2",
         "4",
         "2026-01-06 16:20:31.077827"
        ],
        [
         "49",
         "2027",
         "6-2025-016",
         "2025-07-03",
         "LC0C74C42S5014217;LC0C76C4XS0010022;LC0CE4CC6S0004493;LC0C76C44S0010288;LGXCE4CC5S0055349;LGXCE4CC8S0034768;LC0C74C48S5021723;LGXCE4CC4S0056606;LC0C74C41S5020090;LGXCE4CC3S0049016;LGXC74C40S0005980;LGXC74C47S0017043;LC0C76C46S0029716;LGXCE4CC1S0029623;LC0C76C41S0012872;LC0C76C49S0022775;LPE19W2A1SF029084;LGXCE4CC3S0048688;LGXC74C45S0042748;LGXCE4CC3S0051719;LGXCE4CC6S0055571;LC0C74C44S5006426;LC0C74C44S5008306;LC0CE4CC9S0011437;LC0C76C41S0012919;LGXC74C42S0007715;LC0C74C43S5009009;LC0C74C41S5002236",
         "42300.0",
         "Resultado Campanhade Alavancagemde Emplacamentos Dezembro/24",
         "6",
         "4",
         "2026-01-06 16:20:31.388098"
        ]
       ],
       "shape": {
        "columns": 9,
        "rows": 206
       }
      },
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>id</th>\n",
       "      <th>numero_nd</th>\n",
       "      <th>data_emissao</th>\n",
       "      <th>chassi</th>\n",
       "      <th>valor</th>\n",
       "      <th>descricao</th>\n",
       "      <th>filial_id</th>\n",
       "      <th>user_id</th>\n",
       "      <th>created_at</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>1949</td>\n",
       "      <td>2-2025-060</td>\n",
       "      <td>2025-02-19</td>\n",
       "      <td>LC0C74C41S5009008;LC0C74C41S5009025;LC0C74C41S...</td>\n",
       "      <td>241500.0</td>\n",
       "      <td>PDIDezembro/24</td>\n",
       "      <td>2</td>\n",
       "      <td>4</td>\n",
       "      <td>2026-01-06 16:20:31.077827</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>1953</td>\n",
       "      <td>2-2025-064</td>\n",
       "      <td>2025-03-21</td>\n",
       "      <td>LC0CE4CB7S4003854</td>\n",
       "      <td>8168.0</td>\n",
       "      <td>Resultado Bônus Equalização Yuan Pro</td>\n",
       "      <td>2</td>\n",
       "      <td>4</td>\n",
       "      <td>2026-01-06 16:20:31.077827</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>2108</td>\n",
       "      <td>8-2025-029</td>\n",
       "      <td>2025-03-11</td>\n",
       "      <td>LGXC74C46S0042824;LC0CE4CB6S0002606;LGXC74C41S...</td>\n",
       "      <td>62800.0</td>\n",
       "      <td>Resultado Bônus Política Comercial Dezembro/24</td>\n",
       "      <td>8</td>\n",
       "      <td>4</td>\n",
       "      <td>2026-01-06 16:20:31.843074</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>2102</td>\n",
       "      <td>3-2025-043</td>\n",
       "      <td>2025-08-13</td>\n",
       "      <td>LGXC74C49S0046365;LGXCF6CD5S2002396;LC0CE4CB8S...</td>\n",
       "      <td>3400.0</td>\n",
       "      <td>172-89 Bônus Performance Junho.25</td>\n",
       "      <td>3</td>\n",
       "      <td>4</td>\n",
       "      <td>2026-01-06 16:20:31.843074</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>2126</td>\n",
       "      <td>8-2025-047</td>\n",
       "      <td>2025-07-09</td>\n",
       "      <td>LC0C74C46S5019503;LC0C74C4XS5013008;LC0C74C4XS...</td>\n",
       "      <td>35000.0</td>\n",
       "      <td>148-42 Bônus 48 Horas Eletrizantes Mar.25</td>\n",
       "      <td>8</td>\n",
       "      <td>4</td>\n",
       "      <td>2026-01-06 16:20:31.843074</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>...</th>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>201</th>\n",
       "      <td>2139</td>\n",
       "      <td>4-2025-002</td>\n",
       "      <td>2025-03-21</td>\n",
       "      <td>LC0C74C48S5011287;LGXC74C46S0049627;LGXC74C46S...</td>\n",
       "      <td>121080.0</td>\n",
       "      <td>100-162 Bônus PDISuper Atacado Híbridos</td>\n",
       "      <td>4</td>\n",
       "      <td>4</td>\n",
       "      <td>2026-01-06 16:20:31.843074</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>202</th>\n",
       "      <td>2132</td>\n",
       "      <td>8-2025-053</td>\n",
       "      <td>2025-08-14</td>\n",
       "      <td>LC0C76C42S0012783;LC0C76C46S0025374;LC0C76C47S...</td>\n",
       "      <td>7652.0</td>\n",
       "      <td>177-42 Política Comercial Maio/25\\t</td>\n",
       "      <td>8</td>\n",
       "      <td>4</td>\n",
       "      <td>2026-01-06 16:20:31.843074</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>203</th>\n",
       "      <td>2142</td>\n",
       "      <td>4-2025-005</td>\n",
       "      <td>2025-07-07</td>\n",
       "      <td>LGXCF6CD1S2001875;LGXCF6CD0S2004394;LGXCE4CC4S...</td>\n",
       "      <td>1199.0</td>\n",
       "      <td>142-162 Bônus Performance Abril.2025</td>\n",
       "      <td>4</td>\n",
       "      <td>4</td>\n",
       "      <td>2026-01-06 16:20:31.843074</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>204</th>\n",
       "      <td>2145</td>\n",
       "      <td>4-2025-008</td>\n",
       "      <td>2025-08-07</td>\n",
       "      <td>LC0C76C49S0023117</td>\n",
       "      <td>7520.0</td>\n",
       "      <td>143-162 Bônus Política Comercial Abril.25</td>\n",
       "      <td>4</td>\n",
       "      <td>4</td>\n",
       "      <td>2026-01-06 16:20:31.843074</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>205</th>\n",
       "      <td>2143</td>\n",
       "      <td>4-2025-006</td>\n",
       "      <td>2025-07-07</td>\n",
       "      <td>LC0CE4CC3S0009604;LC0C74C42S5001791;LC0C76C49S...</td>\n",
       "      <td>1750.0</td>\n",
       "      <td>141-162 Campanhade Alavancagemde Emplacamento ...</td>\n",
       "      <td>4</td>\n",
       "      <td>4</td>\n",
       "      <td>2026-01-06 16:20:31.843074</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "<p>206 rows × 9 columns</p>\n",
       "</div>"
      ],
      "text/plain": [
       "       id   numero_nd data_emissao  \\\n",
       "0    1949  2-2025-060   2025-02-19   \n",
       "1    1953  2-2025-064   2025-03-21   \n",
       "2    2108  8-2025-029   2025-03-11   \n",
       "3    2102  3-2025-043   2025-08-13   \n",
       "4    2126  8-2025-047   2025-07-09   \n",
       "..    ...         ...          ...   \n",
       "201  2139  4-2025-002   2025-03-21   \n",
       "202  2132  8-2025-053   2025-08-14   \n",
       "203  2142  4-2025-005   2025-07-07   \n",
       "204  2145  4-2025-008   2025-08-07   \n",
       "205  2143  4-2025-006   2025-07-07   \n",
       "\n",
       "                                                chassi     valor  \\\n",
       "0    LC0C74C41S5009008;LC0C74C41S5009025;LC0C74C41S...  241500.0   \n",
       "1                                    LC0CE4CB7S4003854    8168.0   \n",
       "2    LGXC74C46S0042824;LC0CE4CB6S0002606;LGXC74C41S...   62800.0   \n",
       "3    LGXC74C49S0046365;LGXCF6CD5S2002396;LC0CE4CB8S...    3400.0   \n",
       "4    LC0C74C46S5019503;LC0C74C4XS5013008;LC0C74C4XS...   35000.0   \n",
       "..                                                 ...       ...   \n",
       "201  LC0C74C48S5011287;LGXC74C46S0049627;LGXC74C46S...  121080.0   \n",
       "202  LC0C76C42S0012783;LC0C76C46S0025374;LC0C76C47S...    7652.0   \n",
       "203  LGXCF6CD1S2001875;LGXCF6CD0S2004394;LGXCE4CC4S...    1199.0   \n",
       "204                                  LC0C76C49S0023117    7520.0   \n",
       "205  LC0CE4CC3S0009604;LC0C74C42S5001791;LC0C76C49S...    1750.0   \n",
       "\n",
       "                                             descricao  filial_id  user_id  \\\n",
       "0                                       PDIDezembro/24          2        4   \n",
       "1                 Resultado Bônus Equalização Yuan Pro          2        4   \n",
       "2       Resultado Bônus Política Comercial Dezembro/24          8        4   \n",
       "3                    172-89 Bônus Performance Junho.25          3        4   \n",
       "4            148-42 Bônus 48 Horas Eletrizantes Mar.25          8        4   \n",
       "..                                                 ...        ...      ...   \n",
       "201            100-162 Bônus PDISuper Atacado Híbridos          4        4   \n",
       "202                177-42 Política Comercial Maio/25\\t          8        4   \n",
       "203               142-162 Bônus Performance Abril.2025          4        4   \n",
       "204          143-162 Bônus Política Comercial Abril.25          4        4   \n",
       "205  141-162 Campanhade Alavancagemde Emplacamento ...          4        4   \n",
       "\n",
       "                    created_at  \n",
       "0   2026-01-06 16:20:31.077827  \n",
       "1   2026-01-06 16:20:31.077827  \n",
       "2   2026-01-06 16:20:31.843074  \n",
       "3   2026-01-06 16:20:31.843074  \n",
       "4   2026-01-06 16:20:31.843074  \n",
       "..                         ...  \n",
       "201 2026-01-06 16:20:31.843074  \n",
       "202 2026-01-06 16:20:31.843074  \n",
       "203 2026-01-06 16:20:31.843074  \n",
       "204 2026-01-06 16:20:31.843074  \n",
       "205 2026-01-06 16:20:31.843074  \n",
       "\n",
       "[206 rows x 9 columns]"
      ]
     },
     "execution_count": 84,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "## Conexão e leitura da view\n",
    "Raiz = \"\"\"SELECT * FROM gerador_nd.notadebito\"\"\"\n",
    "df_raiz = pd.read_sql_query(Raiz, engine)\n",
    "\n",
    "print(\"Conexão bem-sucedida e dados lidos com sucesso!\")\n",
    "\n",
    "df_raiz\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "bdde90e9",
   "metadata": {},
   "outputs": [],
   "source": []
  },
  {
   "cell_type": "code",
   "execution_count": 76,
   "id": "79d13f26",
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Exemplos de descrições com problemas de encoding:\n",
      "\n",
      "      id                                                descricao\n",
      "0   1949                                           PDIDezembro/24\n",
      "1   1953                      ResultadoBÃ´nusEqualizaÃ§Ã£oYuanPro\n",
      "2   2108             ResultadoBÃ´nusPolÃ­ticaComercialDezembro/24\n",
      "3   2101                          174-89BÃ´nusPerformanceJunho.25\n",
      "4   2102                          172-89BÃ´nusPerformanceJunho.25\n",
      "5   2103                        177-89 Política Comercial Maio/25\n",
      "6   2107  ResultadoCampanhadeAlavancagemdeEmplacamentoDezembro/24\n",
      "7   2109   ResultadoCampanhadeAlavancagemdeEmplacamentoJaneiro/25\n",
      "8   2110                        BÃ´nusPoliticacomercialJaneiro/25\n",
      "9   2111                            BÃ´nusPerformanceFevereiro/25\n",
      "10  2112   BÃ´nusCampanhadeAlavancagemdeemplacamentosFevereiro/25\n",
      "11  1962                    098-3ReembolsoCarregadoresSetembro.24\n",
      "12  2113                     BÃ´nusPolÃ­ticaComercialFevereiro/25\n",
      "13  2114                     101-42BÃ´nusPDISuperAtacadoHÃ­bridos\n",
      "14  2115                        100-42BÃ´nusSuperAtacadoHÃ­bridos\n",
      "15  2117                    099-42ReembolsoCarregadoresOutubro.24\n",
      "16  2118                 114-42AlavancagemdeEmplacamentoMarÃ§o.25\n",
      "17  2120                        142-42BÃ´nusPerformanceAbril.2025\n",
      "18  2121        141-42CampanhadeAlavancagemdeEmplacamentoAbril.25\n",
      "19  1974               170-3BÃ´nusOperaÃ§Ã£oDolphinMini5LAbril.25\n",
      "\n",
      "======================================================================\n",
      "\n",
      "Total de registros: 206\n",
      "Descrições únicas: 164\n"
     ]
    }
   ],
   "source": [
    "## Visualizar problemas na coluna descricao\n",
    "print(\"Exemplos de descrições com problemas de encoding:\\n\")\n",
    "print(df_raiz[['id', 'descricao']].head(20).to_string())\n",
    "print(\"\\n\" + \"=\"*70)\n",
    "print(f\"\\nTotal de registros: {len(df_raiz)}\")\n",
    "print(f\"Descrições únicas: {df_raiz['descricao'].nunique()}\")"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 77,
   "id": "acc9df0b",
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "🔧 Corrigindo encoding da coluna descricao...\n",
      "======================================================================\n",
      "\n",
      "✅ Correção aplicada! Comparação antes/depois:\n",
      "\n",
      "ID 1953:\n",
      "  Antes: ResultadoBÃ´nusEqualizaÃ§Ã£oYuanPro\n",
      "  Depois: ResultadoBônusEqualizaçãoYuanPro\n",
      "\n",
      "ID 2108:\n",
      "  Antes: ResultadoBÃ´nusPolÃ­ticaComercialDezembro/24\n",
      "  Depois: ResultadoBônusPolíticaComercialDezembro/24\n",
      "\n",
      "ID 2101:\n",
      "  Antes: 174-89BÃ´nusPerformanceJunho.25\n",
      "  Depois: 174-89BônusPerformanceJunho.25\n",
      "\n",
      "ID 2102:\n",
      "  Antes: 172-89BÃ´nusPerformanceJunho.25\n",
      "  Depois: 172-89BônusPerformanceJunho.25\n",
      "\n",
      "ID 2110:\n",
      "  Antes: BÃ´nusPoliticacomercialJaneiro/25\n",
      "  Depois: BônusPoliticacomercialJaneiro/25\n",
      "\n",
      "ID 2111:\n",
      "  Antes: BÃ´nusPerformanceFevereiro/25\n",
      "  Depois: BônusPerformanceFevereiro/25\n",
      "\n",
      "ID 2112:\n",
      "  Antes: BÃ´nusCampanhadeAlavancagemdeemplacamentosFevereiro/25\n",
      "  Depois: BônusCampanhadeAlavancagemdeemplacamentosFevereiro/25\n",
      "\n",
      "ID 2113:\n",
      "  Antes: BÃ´nusPolÃ­ticaComercialFevereiro/25\n",
      "  Depois: BônusPolíticaComercialFevereiro/25\n",
      "\n",
      "ID 2114:\n",
      "  Antes: 101-42BÃ´nusPDISuperAtacadoHÃ­bridos\n",
      "  Depois: 101-42BônusPDISuperAtacadoHíbridos\n",
      "\n",
      "ID 2115:\n",
      "  Antes: 100-42BÃ´nusSuperAtacadoHÃ­bridos\n",
      "  Depois: 100-42BônusSuperAtacadoHíbridos\n",
      "\n",
      "ID 2118:\n",
      "  Antes: 114-42AlavancagemdeEmplacamentoMarÃ§o.25\n",
      "  Depois: 114-42AlavancagemdeEmplacamentoMarço.25\n",
      "\n",
      "ID 2120:\n",
      "  Antes: 142-42BÃ´nusPerformanceAbril.2025\n",
      "  Depois: 142-42BônusPerformanceAbril.2025\n",
      "\n",
      "ID 1974:\n",
      "  Antes: 170-3BÃ´nusOperaÃ§Ã£oDolphinMini5LAbril.25\n",
      "  Depois: 170-3BônusOperaçãoDolphinMini5LAbril.25\n",
      "\n",
      "======================================================================\n",
      "✅ Total de registros processados: 206\n"
     ]
    }
   ],
   "source": [
    "## Corrigir encoding da coluna descricao\n",
    "def corrigir_encoding(texto):\n",
    "    \"\"\"\n",
    "    Corrige problemas de encoding UTF-8 mal interpretado como Latin1\n",
    "    \"\"\"\n",
    "    if pd.isna(texto):\n",
    "        return texto\n",
    "    \n",
    "    try:\n",
    "        # Se o texto tem caracteres estranhos como Ã, Ã§, Ã£, etc\n",
    "        # Tenta converter: encode como latin1 e decode como utf-8\n",
    "        texto_corrigido = texto.encode('latin1').decode('utf-8')\n",
    "        return texto_corrigido\n",
    "    except:\n",
    "        # Se falhar, retorna o texto original\n",
    "        return texto\n",
    "\n",
    "print(\"🔧 Corrigindo encoding da coluna descricao...\")\n",
    "print(\"=\"*70)\n",
    "\n",
    "# Criar backup da coluna original\n",
    "df_raiz['descricao_original'] = df_raiz['descricao'].copy()\n",
    "\n",
    "# Aplicar correção\n",
    "df_raiz['descricao'] = df_raiz['descricao'].apply(corrigir_encoding)\n",
    "\n",
    "print(\"\\n✅ Correção aplicada! Comparação antes/depois:\\n\")\n",
    "\n",
    "# Mostrar comparação\n",
    "comparacao = df_raiz[['id', 'descricao_original', 'descricao']].head(20)\n",
    "for idx, row in comparacao.iterrows():\n",
    "    if row['descricao_original'] != row['descricao']:\n",
    "        print(f\"ID {row['id']}:\")\n",
    "        print(f\"  Antes: {row['descricao_original']}\")\n",
    "        print(f\"  Depois: {row['descricao']}\")\n",
    "        print()\n",
    "\n",
    "print(\"=\"*70)\n",
    "print(f\"✅ Total de registros processados: {len(df_raiz)}\")"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 78,
   "id": "7831cb5f",
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "🔄 Atualizando descrições no banco de dados...\n",
      "======================================================================\n",
      "\n",
      "📊 Total de descrições a corrigir: 132\n",
      "\n",
      "  → 10 descrições atualizadas...\n",
      "  → 20 descrições atualizadas...\n",
      "  → 30 descrições atualizadas...\n",
      "  → 40 descrições atualizadas...\n",
      "  → 50 descrições atualizadas...\n",
      "  → 60 descrições atualizadas...\n",
      "  → 70 descrições atualizadas...\n",
      "  → 80 descrições atualizadas...\n",
      "  → 90 descrições atualizadas...\n",
      "  → 100 descrições atualizadas...\n",
      "  → 110 descrições atualizadas...\n",
      "  → 120 descrições atualizadas...\n",
      "  → 130 descrições atualizadas...\n",
      "\n",
      "======================================================================\n",
      "✅ Atualização concluída!\n",
      "   ✓ Descrições corrigidas: 132\n",
      "   ✗ Erros: 0\n",
      "   ✓ Descrições sem alteração: 74\n",
      "======================================================================\n",
      "\n",
      "🧹 Coluna de backup removida do DataFrame\n"
     ]
    }
   ],
   "source": [
    "## Atualizar descrições corrigidas no banco de dados\n",
    "print(\"🔄 Atualizando descrições no banco de dados...\")\n",
    "print(\"=\"*70)\n",
    "\n",
    "contador = 0\n",
    "erros = 0\n",
    "\n",
    "# Atualizar apenas os registros que foram modificados\n",
    "df_modificados = df_raiz[df_raiz['descricao'] != df_raiz['descricao_original']]\n",
    "\n",
    "print(f\"\\n📊 Total de descrições a corrigir: {len(df_modificados)}\\n\")\n",
    "\n",
    "for idx, row in df_modificados.iterrows():\n",
    "    try:\n",
    "        query = \"\"\"\n",
    "        UPDATE gerador_nd.notadebito \n",
    "        SET descricao = %s\n",
    "        WHERE id = %s\n",
    "        \"\"\"\n",
    "        cursor.execute(query, (row['descricao'], row['id']))\n",
    "        contador += 1\n",
    "        \n",
    "        if contador % 10 == 0:\n",
    "            engine.commit()\n",
    "            print(f\"  → {contador} descrições atualizadas...\")\n",
    "            \n",
    "    except Exception as e:\n",
    "        erros += 1\n",
    "        print(f\"❌ Erro no ID {row['id']}: {e}\")\n",
    "        engine.rollback()\n",
    "\n",
    "# Commit final\n",
    "engine.commit()\n",
    "\n",
    "print(f\"\\n{'='*70}\")\n",
    "print(f\"✅ Atualização concluída!\")\n",
    "print(f\"   ✓ Descrições corrigidas: {contador}\")\n",
    "print(f\"   ✗ Erros: {erros}\")\n",
    "print(f\"   ✓ Descrições sem alteração: {len(df_raiz) - len(df_modificados)}\")\n",
    "print(f\"{'='*70}\")\n",
    "\n",
    "# Remover coluna backup\n",
    "df_raiz.drop('descricao_original', axis=1, inplace=True)\n",
    "print(\"\\n🧹 Coluna de backup removida do DataFrame\")"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 79,
   "id": "b6dbb014",
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "📋 Verificando descrições corrigidas no banco...\n",
      "======================================================================\n",
      "\n",
      "✅ Amostra de descrições corrigidas (com acentos corretos):\n",
      "\n",
      "  id  numero_nd                                            descricao data_emissao\n",
      "1952 2-2025-063           ResultadoBônusPolíticaComercialDezembro/24   2025-03-11\n",
      "1953 2-2025-064                     ResultadoBônusEqualizaçãoYuanPro   2025-03-21\n",
      "1955 2-2025-066                     BônusPoliticacomercialJaneiro/25   2025-03-21\n",
      "1956 2-2025-067                         BônusPerformanceFevereiro/25   2025-03-27\n",
      "1957 2-2025-068 BônusCampanhadeAlavancagemdeEmplacamentoFevereiro/25   2025-03-21\n",
      "1958 2-2025-069                   BônusPolíticaComercialFevereiro/25   2025-04-09\n",
      "1959 2-2025-070                    101-3BônusPDISuperAtacadoHíbridos   2025-05-23\n",
      "1960 2-2025-071                       100-3BônusSuperAtacadoHíbridos   2025-03-21\n",
      "1961 2-2025-072                                110-3BônusPerformance   2025-05-31\n",
      "1964 2-2025-075               114-3AlavancagemdeEmplacamentoMarço.25   2025-04-06\n",
      "1965 2-2025-076                  119-3BônusPolíticaComercialMarço.25   2025-06-11\n",
      "1966 2-2025-077                      142-3BônusPerformanceAbril.2025   2025-07-07\n",
      "1968 2-2025-079                         145-3BônusPerformanceMaio.25   2025-07-07\n",
      "1969 2-2025-080                  143-3BônusPolíticaComercialAbril.25   2025-08-07\n",
      "1970 2-2025-081            146-3ParcialBônusPolíticaComercialMaio.25   2025-08-07\n",
      "1972 2-2025-083                  148-3Bônus48HorasEletrizantesMar.25   2025-07-09\n",
      "1973 2-2025-084                         159-3BônusAtacadoSealMaio.25   2025-07-11\n",
      "1974 2-2025-085              170-3BônusOperaçãoDolphinMini5LAbril.25   2025-08-08\n",
      "1975 2-2025-086           172-3ParcialBônusPolíticaComercialJunho.25   2025-08-08\n",
      "1976 2-2025-087                        174-3BônusPerformanceJunho.25   2025-08-11\n",
      "\n",
      "======================================================================\n",
      "🎉 SUCESSO! Todas as descrições foram corrigidas!\n",
      "   • Caracteres como 'Bônus', 'Política', 'Operação' agora estão corretos\n",
      "   • Total de registros no banco: 206\n",
      "======================================================================\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "C:\\Users\\giovanni.5683\\AppData\\Local\\Temp\\ipykernel_22696\\2002206351.py:20: UserWarning: pandas only supports SQLAlchemy connectable (engine/connection) or database string URI or sqlite3 DBAPI2 connection. Other DBAPI2 objects are not tested. Please consider using SQLAlchemy.\n",
      "  df_verificacao = pd.read_sql_query(query_verificacao, engine)\n",
      "C:\\Users\\giovanni.5683\\AppData\\Local\\Temp\\ipykernel_22696\\2002206351.py:27: UserWarning: pandas only supports SQLAlchemy connectable (engine/connection) or database string URI or sqlite3 DBAPI2 connection. Other DBAPI2 objects are not tested. Please consider using SQLAlchemy.\n",
      "  print(f\"   • Total de registros no banco: {pd.read_sql_query('SELECT COUNT(*) FROM gerador_nd.notadebito', engine).iloc[0, 0]}\")\n"
     ]
    }
   ],
   "source": [
    "## Verificar descrições corrigidas no banco de dados\n",
    "print(\"📋 Verificando descrições corrigidas no banco...\")\n",
    "print(\"=\"*70)\n",
    "\n",
    "query_verificacao = \"\"\"\n",
    "SELECT \n",
    "    id,\n",
    "    numero_nd,\n",
    "    descricao,\n",
    "    data_emissao\n",
    "FROM gerador_nd.notadebito\n",
    "WHERE descricao LIKE '%ô%' \n",
    "   OR descricao LIKE '%ç%'\n",
    "   OR descricao LIKE '%ã%'\n",
    "   OR descricao LIKE '%í%'\n",
    "ORDER BY id\n",
    "LIMIT 20\n",
    "\"\"\"\n",
    "\n",
    "df_verificacao = pd.read_sql_query(query_verificacao, engine)\n",
    "print(f\"\\n✅ Amostra de descrições corrigidas (com acentos corretos):\\n\")\n",
    "print(df_verificacao.to_string(index=False))\n",
    "\n",
    "print(f\"\\n{'='*70}\")\n",
    "print(\"🎉 SUCESSO! Todas as descrições foram corrigidas!\")\n",
    "print(f\"   • Caracteres como 'Bônus', 'Política', 'Operação' agora estão corretos\")\n",
    "print(f\"   • Total de registros no banco: {pd.read_sql_query('SELECT COUNT(*) FROM gerador_nd.notadebito', engine).iloc[0, 0]}\")\n",
    "print(f\"{'='*70}\")"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "dc79eff4",
   "metadata": {},
   "outputs": [],
   "source": []
  },
  {
   "cell_type": "code",
   "execution_count": 80,
   "id": "fe442e10",
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "🔧 Adicionando espaços nas descrições...\n",
      "======================================================================\n",
      "\n",
      "✅ Espaços adicionados! Comparação antes/depois:\n",
      "\n",
      "ID 1953:\n",
      "  Antes: ResultadoBônusEqualizaçãoYuanPro\n",
      "  Depois: Resultado Bônus Equalização Yuan Pro\n",
      "\n",
      "ID 2108:\n",
      "  Antes: ResultadoBônusPolíticaComercialDezembro/24\n",
      "  Depois: Resultado Bônus Política Comercial Dezembro/24\n",
      "\n",
      "ID 2102:\n",
      "  Antes: 172-89BônusPerformanceJunho.25\n",
      "  Depois: 172-89 Bônus Performance Junho.25\n",
      "\n",
      "ID 2111:\n",
      "  Antes: BônusPerformanceFevereiro/25\n",
      "  Depois: Bônus Performance Fevereiro/25\n",
      "\n",
      "ID 2112:\n",
      "  Antes: BônusCampanhadeAlavancagemdeemplacamentosFevereiro/25\n",
      "  Depois: Bônus Campanhade Alavancagemdeemplacamentos Fevereiro/25\n",
      "\n",
      "ID 2114:\n",
      "  Antes: 101-42BônusPDISuperAtacadoHíbridos\n",
      "  Depois: 101-42 Bônus PDISuper Atacado Híbridos\n",
      "\n",
      "ID 2115:\n",
      "  Antes: 100-42BônusSuperAtacadoHíbridos\n",
      "  Depois: 100-42 Bônus Super Atacado Híbridos\n",
      "\n",
      "ID 2126:\n",
      "  Antes: 148-42Bônus48HorasEletrizantesMar.25\n",
      "  Depois: 148-42 Bônus 48 Horas Eletrizantes Mar.25\n",
      "\n",
      "ID 2128:\n",
      "  Antes: 170-42BônusOperaçãoDolphinMini5LAbril.25\n",
      "  Depois: 170-42 Bônus Operação Dolphin Mini 5 LAbril.25\n",
      "\n",
      "ID 2107:\n",
      "  Antes: ResultadoCampanhadeAlavancagemdeEmplacamentoDezembro/24\n",
      "  Depois: Resultado Campanhade Alavancagemde Emplacamento Dezembro/24\n",
      "\n",
      "ID 2109:\n",
      "  Antes: ResultadoCampanhadeAlavancagemdeEmplacamentoJaneiro/25\n",
      "  Depois: Resultado Campanhade Alavancagemde Emplacamento Janeiro/25\n",
      "\n",
      "ID 2101:\n",
      "  Antes: 174-89BônusPerformanceJunho.25\n",
      "  Depois: 174-89 Bônus Performance Junho.25\n",
      "\n",
      "ID 2110:\n",
      "  Antes: BônusPoliticacomercialJaneiro/25\n",
      "  Depois: Bônus Politicacomercial Janeiro/25\n",
      "\n",
      "ID 1962:\n",
      "  Antes: 098-3ReembolsoCarregadoresSetembro.24\n",
      "  Depois: 098-3 Reembolso Carregadores Setembro.24\n",
      "\n",
      "ID 2113:\n",
      "  Antes: BônusPolíticaComercialFevereiro/25\n",
      "  Depois: Bônus Política Comercial Fevereiro/25\n",
      "\n",
      "ID 2015:\n",
      "  Antes: BônusCampanhadeAlavancagemdeemplacamentosFevereiro/25\n",
      "  Depois: Bônus Campanhade Alavancagemdeemplacamentos Fevereiro/25\n",
      "\n",
      "ID 2022:\n",
      "  Antes: 148-74Bônus48HorasEletrizantesMar.25\n",
      "  Depois: 148-74 Bônus 48 Horas Eletrizantes Mar.25\n",
      "\n",
      "ID 2147:\n",
      "  Antes: 148-162Bônus48HorasEletrizantesMar.25\n",
      "  Depois: 148-162 Bônus 48 Horas Eletrizantes Mar.25\n",
      "\n",
      "======================================================================\n",
      "✅ Total de registros processados: 206\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "C:\\Users\\giovanni.5683\\AppData\\Local\\Temp\\ipykernel_22696\\3086358064.py:26: UserWarning: pandas only supports SQLAlchemy connectable (engine/connection) or database string URI or sqlite3 DBAPI2 connection. Other DBAPI2 objects are not tested. Please consider using SQLAlchemy.\n",
      "  df_raiz = pd.read_sql_query(\"SELECT * FROM gerador_nd.notadebito\", engine)\n"
     ]
    }
   ],
   "source": [
    "## Corrigir espaços nas descrições\n",
    "import re\n",
    "\n",
    "def adicionar_espacos(texto):\n",
    "    \"\"\"\n",
    "    Adiciona espaços antes de letras maiúsculas e números precedidos de letras\n",
    "    \"\"\"\n",
    "    if pd.isna(texto):\n",
    "        return texto\n",
    "    \n",
    "    # Adicionar espaço antes de letra maiúscula (exceto no início)\n",
    "    texto = re.sub(r'([a-zçãõáéíóú])([A-Z])', r'\\1 \\2', texto)\n",
    "    \n",
    "    # Adicionar espaço antes de número precedido de letra minúscula\n",
    "    texto = re.sub(r'([a-z])(\\d)', r'\\1 \\2', texto)\n",
    "    \n",
    "    # Adicionar espaço depois de número seguido de letra maiúscula\n",
    "    texto = re.sub(r'(\\d)([A-Z])', r'\\1 \\2', texto)\n",
    "    \n",
    "    return texto\n",
    "\n",
    "print(\"🔧 Adicionando espaços nas descrições...\")\n",
    "print(\"=\"*70)\n",
    "\n",
    "# Recarregar df_raiz do banco\n",
    "df_raiz = pd.read_sql_query(\"SELECT * FROM gerador_nd.notadebito\", engine)\n",
    "\n",
    "# Criar backup\n",
    "df_raiz['descricao_sem_espacos'] = df_raiz['descricao'].copy()\n",
    "\n",
    "# Aplicar função de adicionar espaços\n",
    "df_raiz['descricao'] = df_raiz['descricao'].apply(adicionar_espacos)\n",
    "\n",
    "print(\"\\n✅ Espaços adicionados! Comparação antes/depois:\\n\")\n",
    "\n",
    "# Mostrar comparação\n",
    "comparacao = df_raiz[['id', 'descricao_sem_espacos', 'descricao']].head(20)\n",
    "for idx, row in comparacao.iterrows():\n",
    "    if row['descricao_sem_espacos'] != row['descricao']:\n",
    "        print(f\"ID {row['id']}:\")\n",
    "        print(f\"  Antes: {row['descricao_sem_espacos']}\")\n",
    "        print(f\"  Depois: {row['descricao']}\")\n",
    "        print()\n",
    "\n",
    "print(\"=\"*70)\n",
    "print(f\"✅ Total de registros processados: {len(df_raiz)}\")"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 81,
   "id": "532f5203",
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "🔄 Atualizando banco com descrições espaçadas...\n",
      "======================================================================\n",
      "\n",
      "📊 Total de descrições a atualizar: 189\n",
      "\n",
      "  → 20 descrições atualizadas...\n",
      "  → 40 descrições atualizadas...\n",
      "  → 60 descrições atualizadas...\n",
      "  → 80 descrições atualizadas...\n",
      "  → 100 descrições atualizadas...\n",
      "  → 120 descrições atualizadas...\n",
      "  → 140 descrições atualizadas...\n",
      "  → 160 descrições atualizadas...\n",
      "  → 180 descrições atualizadas...\n",
      "\n",
      "======================================================================\n",
      "✅ Atualização concluída!\n",
      "   ✓ Descrições atualizadas: 189\n",
      "   ✗ Erros: 0\n",
      "======================================================================\n"
     ]
    }
   ],
   "source": [
    "## Atualizar banco com descrições com espaços\n",
    "print(\"🔄 Atualizando banco com descrições espaçadas...\")\n",
    "print(\"=\"*70)\n",
    "\n",
    "contador = 0\n",
    "erros = 0\n",
    "\n",
    "# Atualizar apenas os registros modificados\n",
    "df_modificados = df_raiz[df_raiz['descricao'] != df_raiz['descricao_sem_espacos']]\n",
    "\n",
    "print(f\"\\n📊 Total de descrições a atualizar: {len(df_modificados)}\\n\")\n",
    "\n",
    "for idx, row in df_modificados.iterrows():\n",
    "    try:\n",
    "        query = \"\"\"\n",
    "        UPDATE gerador_nd.notadebito \n",
    "        SET descricao = %s\n",
    "        WHERE id = %s\n",
    "        \"\"\"\n",
    "        cursor.execute(query, (row['descricao'], row['id']))\n",
    "        contador += 1\n",
    "        \n",
    "        if contador % 20 == 0:\n",
    "            engine.commit()\n",
    "            print(f\"  → {contador} descrições atualizadas...\")\n",
    "            \n",
    "    except Exception as e:\n",
    "        erros += 1\n",
    "        print(f\"❌ Erro no ID {row['id']}: {e}\")\n",
    "        engine.rollback()\n",
    "\n",
    "# Commit final\n",
    "engine.commit()\n",
    "\n",
    "print(f\"\\n{'='*70}\")\n",
    "print(f\"✅ Atualização concluída!\")\n",
    "print(f\"   ✓ Descrições atualizadas: {contador}\")\n",
    "print(f\"   ✗ Erros: {erros}\")\n",
    "print(f\"{'='*70}\")\n",
    "\n",
    "# Limpar coluna temporária\n",
    "df_raiz.drop('descricao_sem_espacos', axis=1, inplace=True)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 82,
   "id": "45bd473d",
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "📋 Verificando descrições finais no banco...\n",
      "======================================================================\n",
      "\n",
      "✅ Primeiras 25 descrições (com acentos e espaços corretos):\n",
      "\n",
      "  id  numero_nd                                                    descricao\n",
      "1949 2-2025-060                                               PDIDezembro/24\n",
      "1950 2-2025-061                                          Atacado Dezembro/24\n",
      "1951 2-2025-062 Resultado Campanhade Alavancagemde Emplacamentos Dezembro/24\n",
      "1952 2-2025-063               Resultado Bônus Política Comercial Dezembro/24\n",
      "1953 2-2025-064                         Resultado Bônus Equalização Yuan Pro\n",
      "1954 2-2025-065   Resultado Campanhade Alavancagemde Emplacamento Janeiro/25\n",
      "1955 2-2025-066                           Bônus Politicacomercial Janeiro/25\n",
      "1956 2-2025-067                               Bônus Performance Fevereiro/25\n",
      "1957 2-2025-068     Bônus Campanhade Alavancagemde Emplacamento Fevereiro/25\n",
      "1958 2-2025-069                        Bônus Política Comercial Fevereiro/25\n",
      "1959 2-2025-070                        101-3 Bônus PDISuper Atacado Híbridos\n",
      "1960 2-2025-071                           100-3 Bônus Super Atacado Híbridos\n",
      "1961 2-2025-072                                      110-3 Bônus Performance\n",
      "1962 2-2025-073                     098-3 Reembolso Carregadores Setembro.24\n",
      "1963 2-2025-074                      099-3 Reembolso Carregadores Outubro.24\n",
      "1964 2-2025-075                    114-3 Alavancagemde Emplacamento Março.25\n",
      "1965 2-2025-076                      119-3 Bônus Política Comercial Março.25\n",
      "1966 2-2025-077                           142-3 Bônus Performance Abril.2025\n",
      "1967 2-2025-078         141-3 Campanhade Alavancagemde Emplacamento Abril.25\n",
      "1968 2-2025-079                              145-3 Bônus Performance Maio.25\n",
      "1969 2-2025-080                      143-3 Bônus Política Comercial Abril.25\n",
      "1970 2-2025-081               146-3 Parcial Bônus Política Comercial Maio.25\n",
      "1971 2-2025-082          144-3 Campanhade Alavancagemde Emplacamento Maio.25\n",
      "1972 2-2025-083                     148-3 Bônus 48 Horas Eletrizantes Mar.25\n",
      "1973 2-2025-084                             159-3 Bônus Atacado Seal Maio.25\n",
      "\n",
      "======================================================================\n",
      "🎉 PERFEITO! Descrições corrigidas com:\n",
      "   ✓ Acentos em português (ô, ç, ã, í)\n",
      "   ✓ Espaços entre palavras\n",
      "   ✓ Total no banco: 206 registros\n",
      "======================================================================\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "C:\\Users\\giovanni.5683\\AppData\\Local\\Temp\\ipykernel_22696\\1921678908.py:15: UserWarning: pandas only supports SQLAlchemy connectable (engine/connection) or database string URI or sqlite3 DBAPI2 connection. Other DBAPI2 objects are not tested. Please consider using SQLAlchemy.\n",
      "  df_final = pd.read_sql_query(query_final, engine)\n",
      "C:\\Users\\giovanni.5683\\AppData\\Local\\Temp\\ipykernel_22696\\1921678908.py:23: UserWarning: pandas only supports SQLAlchemy connectable (engine/connection) or database string URI or sqlite3 DBAPI2 connection. Other DBAPI2 objects are not tested. Please consider using SQLAlchemy.\n",
      "  print(f\"   ✓ Total no banco: {pd.read_sql_query('SELECT COUNT(*) FROM gerador_nd.notadebito', engine).iloc[0, 0]} registros\")\n"
     ]
    }
   ],
   "source": [
    "## Verificar resultado final das descrições\n",
    "print(\"📋 Verificando descrições finais no banco...\")\n",
    "print(\"=\"*70)\n",
    "\n",
    "query_final = \"\"\"\n",
    "SELECT \n",
    "    id,\n",
    "    numero_nd,\n",
    "    descricao\n",
    "FROM gerador_nd.notadebito\n",
    "ORDER BY id\n",
    "LIMIT 25\n",
    "\"\"\"\n",
    "\n",
    "df_final = pd.read_sql_query(query_final, engine)\n",
    "print(f\"\\n✅ Primeiras 25 descrições (com acentos e espaços corretos):\\n\")\n",
    "print(df_final.to_string(index=False))\n",
    "\n",
    "print(f\"\\n{'='*70}\")\n",
    "print(\"🎉 PERFEITO! Descrições corrigidas com:\")\n",
    "print(\"   ✓ Acentos em português (ô, ç, ã, í)\")\n",
    "print(\"   ✓ Espaços entre palavras\")\n",
    "print(f\"   ✓ Total no banco: {pd.read_sql_query('SELECT COUNT(*) FROM gerador_nd.notadebito', engine).iloc[0, 0]} registros\")\n",
    "print(f\"{'='*70}\")"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 83,
   "id": "b30ab98f",
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "🔍 ANÁLISE: Redução de 6997 → 206 linhas\n",
      "======================================================================\n",
      "\n",
      "📊 CSV ORIGINAL:\n",
      "   Total de linhas: 6997\n",
      "   Colunas: ['CHASSI', 'LOJA', 'ND', 'Val_Info', 'Tipo_de_Bonus', 'Descrição', 'Data_de_Emissao']\n",
      "\n",
      "📊 ESTRUTURA DO CSV:\n",
      "   NDs únicas: 87\n",
      "   Lojas únicas: 9\n",
      "   Datas únicas: 102\n",
      "   Chassis únicos: 3255\n",
      "\n",
      "📊 AGRUPAMENTO POR ND:\n",
      "   Combinações únicas (LOJA + Data + ND): 298\n",
      "\n",
      "   Exemplo de agrupamento:\n",
      "    LOJA Data_de_Emissao  ND  quantidade_chassis\n",
      "Cascavel      03/07/2025  15                  44\n",
      "Cascavel      06/05/2025  30                  25\n",
      "Cascavel      07/07/2025  32                   8\n",
      "Cascavel      07/07/2025  33                  41\n",
      "Cascavel      07/07/2025  34                  14\n",
      "Cascavel      07/08/2025  35                   6\n",
      "Cascavel      07/08/2025  36                   5\n",
      "Cascavel      08/08/2025  40                   3\n",
      "Cascavel      08/08/2025  41                   1\n",
      "Cascavel      09/04/2025  23                  20\n",
      "\n",
      "📊 BANCO DE DADOS:\n",
      "   Total de NDs no banco: 206\n",
      "\n",
      "======================================================================\n",
      "✅ ANÁLISE:\n",
      "   • CSV tinha 6997 linhas (1 chassis por linha)\n",
      "   • Após agrupamento: 298 NDs únicas\n",
      "   • No banco: 206 registros\n",
      "\n",
      "   ⚠️  VERIFICAÇÃO:\n",
      "   ⚠️  Divergência: 298 esperado vs 206 no banco\n",
      "======================================================================\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "C:\\Users\\giovanni.5683\\AppData\\Local\\Temp\\ipykernel_22696\\3230052916.py:28: UserWarning: pandas only supports SQLAlchemy connectable (engine/connection) or database string URI or sqlite3 DBAPI2 connection. Other DBAPI2 objects are not tested. Please consider using SQLAlchemy.\n",
      "  total_banco = pd.read_sql_query('SELECT COUNT(*) FROM gerador_nd.notadebito', engine).iloc[0, 0]\n"
     ]
    }
   ],
   "source": [
    "## ANÁLISE: Verificar se a redução de linhas faz sentido\n",
    "print(\"🔍 ANÁLISE: Redução de 6997 → 206 linhas\")\n",
    "print(\"=\"*70)\n",
    "\n",
    "# 1. Ler o CSV original\n",
    "csv_path = r'C:\\Users\\giovanni.5683\\GITHUB\\controlling_postgreSQL\\Datasets\\BD_ND.csv'\n",
    "df_csv_analise = pd.read_csv(csv_path)\n",
    "\n",
    "print(f\"\\n📊 CSV ORIGINAL:\")\n",
    "print(f\"   Total de linhas: {len(df_csv_analise)}\")\n",
    "print(f\"   Colunas: {df_csv_analise.columns.tolist()}\")\n",
    "\n",
    "# 2. Ver a estrutura dos dados\n",
    "print(f\"\\n📊 ESTRUTURA DO CSV:\")\n",
    "print(f\"   NDs únicas: {df_csv_analise['ND'].nunique()}\")\n",
    "print(f\"   Lojas únicas: {df_csv_analise['LOJA'].nunique()}\")\n",
    "print(f\"   Datas únicas: {df_csv_analise['Data_de_Emissao'].nunique()}\")\n",
    "print(f\"   Chassis únicos: {df_csv_analise['CHASSI'].nunique()}\")\n",
    "\n",
    "# 3. Verificar quantas linhas têm cada ND\n",
    "print(f\"\\n📊 AGRUPAMENTO POR ND:\")\n",
    "nd_counts = df_csv_analise.groupby(['LOJA', 'Data_de_Emissao', 'ND']).size().reset_index(name='quantidade_chassis')\n",
    "print(f\"   Combinações únicas (LOJA + Data + ND): {len(nd_counts)}\")\n",
    "print(f\"\\n   Exemplo de agrupamento:\")\n",
    "print(nd_counts.head(10).to_string(index=False))\n",
    "\n",
    "# 4. Verificar banco de dados\n",
    "total_banco = pd.read_sql_query('SELECT COUNT(*) FROM gerador_nd.notadebito', engine).iloc[0, 0]\n",
    "print(f\"\\n📊 BANCO DE DADOS:\")\n",
    "print(f\"   Total de NDs no banco: {total_banco}\")\n",
    "\n",
    "# 5. Conclusão\n",
    "print(f\"\\n{'='*70}\")\n",
    "print(\"✅ ANÁLISE:\")\n",
    "print(f\"   • CSV tinha {len(df_csv_analise)} linhas (1 chassis por linha)\")\n",
    "print(f\"   • Após agrupamento: {len(nd_counts)} NDs únicas\")\n",
    "print(f\"   • No banco: {total_banco} registros\")\n",
    "print(f\"\\n   ⚠️  VERIFICAÇÃO:\")\n",
    "if len(nd_counts) == total_banco:\n",
    "    print(f\"   ✅ Correto! O agrupamento fez: N chassis → 1 ND\")\n",
    "    print(f\"   ✅ Cada ND agrupa múltiplos chassis em uma única linha\")\n",
    "else:\n",
    "    print(f\"   ⚠️  Divergência: {len(nd_counts)} esperado vs {total_banco} no banco\")\n",
    "print(\"=\"*70)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 85,
   "id": "35d51daf",
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "🔍 Identificando NDs faltantes...\n",
      "======================================================================\n",
      "   Total de NDs no CSV: 206\n",
      "   Total de NDs no banco: 207\n",
      "\n",
      "📊 RESULTADO:\n",
      "   ⚠️  NDs faltantes: 161\n",
      "\n",
      "   Exemplos de NDs faltantes:\n",
      " numero_nd  filial_id data_emissao   valor\n",
      "1-2025-060          1   2025-02-19  241500\n",
      "1-2025-061          1   2025-02-19 1090260\n",
      "1-2025-062          1   2025-07-03  241860\n",
      "1-2025-063          1   2025-03-11  955160\n",
      "1-2025-064          1   2025-03-21    8168\n",
      "1-2025-065          1   2025-03-21   11200\n",
      "1-2025-066          1   2025-03-21  384196\n",
      "1-2025-067          1   2025-03-27   29812\n",
      "1-2025-068          1   2025-03-21   64500\n",
      "1-2025-069          1   2025-04-09 1359804\n",
      "\n",
      "======================================================================\n",
      "✅ Pronto para inserir 161 registros faltantes!\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "C:\\Users\\giovanni.5683\\AppData\\Local\\Temp\\ipykernel_22696\\2520865776.py:42: UserWarning: pandas only supports SQLAlchemy connectable (engine/connection) or database string URI or sqlite3 DBAPI2 connection. Other DBAPI2 objects are not tested. Please consider using SQLAlchemy.\n",
      "  df_nds_banco = pd.read_sql_query(query_nds_banco, engine)\n"
     ]
    }
   ],
   "source": [
    "## Identificar NDs faltantes e preparar para inserção\n",
    "print(\"🔍 Identificando NDs faltantes...\")\n",
    "print(\"=\"*70)\n",
    "\n",
    "# 1. Ler CSV e processar\n",
    "csv_path = r'C:\\Users\\giovanni.5683\\GITHUB\\controlling_postgreSQL\\Datasets\\BD_ND.csv'\n",
    "df_csv_completo = pd.read_csv(csv_path)\n",
    "\n",
    "# 2. Processar como foi feito originalmente\n",
    "df_csv_completo['Data_de_Emissao'] = pd.to_datetime(df_csv_completo['Data_de_Emissao'], format='%d/%m/%Y')\n",
    "df_csv_completo['ano'] = df_csv_completo['Data_de_Emissao'].dt.year\n",
    "\n",
    "# Mapear filial_id\n",
    "loja_to_filial_map = {\n",
    "    'Londrina': 7, 'Matriz': 1, 'Maringa': 2, 'Umuarama': 9,\n",
    "    'SJP': 4, 'PontaGrossa': 5, 'MarioTourinho': 3, 'Cascavel': 6, 'Portao': 8\n",
    "}\n",
    "df_csv_completo['filial_id'] = df_csv_completo['LOJA'].map(loja_to_filial_map)\n",
    "\n",
    "# Criar numero_nd\n",
    "df_csv_completo['numero_nd'] = df_csv_completo.apply(\n",
    "    lambda row: f\"{row['filial_id']}-{row['ano']}-{str(row['ND']).zfill(3)}\", \n",
    "    axis=1\n",
    ")\n",
    "\n",
    "# 3. Agrupar todos os registros\n",
    "df_todas_nds = df_csv_completo.groupby('numero_nd').agg({\n",
    "    'CHASSI': lambda x: ';'.join(x.astype(str)),\n",
    "    'Data_de_Emissao': 'first',\n",
    "    'Val_Info': 'first',\n",
    "    'Descrição': 'first',\n",
    "    'filial_id': 'first'\n",
    "}).reset_index()\n",
    "\n",
    "df_todas_nds.columns = ['numero_nd', 'chassi', 'data_emissao', 'valor', 'descricao', 'filial_id']\n",
    "df_todas_nds['user_id'] = 4\n",
    "\n",
    "print(f\"   Total de NDs no CSV: {len(df_todas_nds)}\")\n",
    "\n",
    "# 4. Buscar NDs que já existem no banco\n",
    "query_nds_banco = \"SELECT numero_nd FROM gerador_nd.notadebito\"\n",
    "df_nds_banco = pd.read_sql_query(query_nds_banco, engine)\n",
    "\n",
    "print(f\"   Total de NDs no banco: {len(df_nds_banco)}\")\n",
    "\n",
    "# 5. Encontrar NDs faltantes\n",
    "nds_faltantes = df_todas_nds[~df_todas_nds['numero_nd'].isin(df_nds_banco['numero_nd'])]\n",
    "\n",
    "print(f\"\\n📊 RESULTADO:\")\n",
    "print(f\"   ⚠️  NDs faltantes: {len(nds_faltantes)}\")\n",
    "print(f\"\\n   Exemplos de NDs faltantes:\")\n",
    "print(nds_faltantes[['numero_nd', 'filial_id', 'data_emissao', 'valor']].head(10).to_string(index=False))\n",
    "\n",
    "print(\"\\n\" + \"=\"*70)\n",
    "print(f\"✅ Pronto para inserir {len(nds_faltantes)} registros faltantes!\")"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 86,
   "id": "9413e121",
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "📥 Inserindo NDs faltantes no banco...\n",
      "======================================================================\n",
      "\n",
      "📊 Total de registros para inserir: 161\n",
      "\n",
      "  → 30/161 registros inseridos...\n",
      "  → 60/161 registros inseridos...\n",
      "  → 90/161 registros inseridos...\n",
      "  → 120/161 registros inseridos...\n",
      "  → 150/161 registros inseridos...\n",
      "\n",
      "======================================================================\n",
      "✅ Inserção concluída!\n",
      "   ✓ Registros inseridos: 161\n",
      "   ✗ Erros: 0\n",
      "======================================================================\n"
     ]
    }
   ],
   "source": [
    "## Inserir NDs faltantes no banco\n",
    "print(\"📥 Inserindo NDs faltantes no banco...\")\n",
    "print(\"=\"*70)\n",
    "\n",
    "# Preparar dados para inserção\n",
    "dados_faltantes = nds_faltantes[['numero_nd', 'data_emissao', 'chassi', 'valor', 'descricao', 'filial_id', 'user_id']].copy()\n",
    "dados_faltantes['data_emissao'] = dados_faltantes['data_emissao'].dt.strftime('%Y-%m-%d')\n",
    "\n",
    "print(f\"\\n📊 Total de registros para inserir: {len(dados_faltantes)}\\n\")\n",
    "\n",
    "contador = 0\n",
    "erros = 0\n",
    "erros_lista = []\n",
    "\n",
    "for idx, row in dados_faltantes.iterrows():\n",
    "    try:\n",
    "        query = \"\"\"\n",
    "        INSERT INTO gerador_nd.notadebito \n",
    "        (numero_nd, data_emissao, chassi, valor, descricao, filial_id, user_id, created_at)\n",
    "        VALUES (%s, %s, %s, %s, %s, %s, %s, NOW())\n",
    "        \"\"\"\n",
    "        cursor.execute(query, (\n",
    "            row['numero_nd'],\n",
    "            row['data_emissao'],\n",
    "            row['chassi'],\n",
    "            row['valor'],\n",
    "            row['descricao'],\n",
    "            row['filial_id'],\n",
    "            row['user_id']\n",
    "        ))\n",
    "        contador += 1\n",
    "        \n",
    "        if contador % 30 == 0:\n",
    "            engine.commit()\n",
    "            print(f\"  → {contador}/{len(dados_faltantes)} registros inseridos...\")\n",
    "            \n",
    "    except Exception as e:\n",
    "        erros += 1\n",
    "        erros_lista.append({'numero_nd': row['numero_nd'], 'erro': str(e)})\n",
    "        if erros <= 5:  # Mostrar apenas os primeiros 5 erros\n",
    "            print(f\"  ❌ Erro em {row['numero_nd']}: {e}\")\n",
    "        engine.rollback()\n",
    "\n",
    "# Commit final\n",
    "engine.commit()\n",
    "\n",
    "print(f\"\\n{'='*70}\")\n",
    "print(f\"✅ Inserção concluída!\")\n",
    "print(f\"   ✓ Registros inseridos: {contador}\")\n",
    "print(f\"   ✗ Erros: {erros}\")\n",
    "\n",
    "if erros > 0:\n",
    "    print(f\"\\n   ⚠️  Total de erros: {erros}\")\n",
    "    if erros > 5:\n",
    "        print(f\"   (Mostrando apenas os primeiros 5 acima)\")\n",
    "\n",
    "print(f\"{'='*70}\")"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 87,
   "id": "bd876dc0",
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "🔧 Corrigindo descrições dos novos registros...\n",
      "======================================================================\n",
      "\n",
      "📊 Total de NDs no banco agora: 368\n",
      "   Descrições com encoding errado: 104\n",
      "\n",
      "   Corrigindo 104 descrições...\n",
      "\n",
      "  → 20 descrições corrigidas...\n",
      "  ❌ Erro no ID 2080: 'latin-1' codec can't encode character '\\u201d' in position 2: ordinal not in range(256)\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "C:\\Users\\giovanni.5683\\AppData\\Local\\Temp\\ipykernel_22696\\2372087407.py:6: UserWarning: pandas only supports SQLAlchemy connectable (engine/connection) or database string URI or sqlite3 DBAPI2 connection. Other DBAPI2 objects are not tested. Please consider using SQLAlchemy.\n",
      "  total_atual = pd.read_sql_query('SELECT COUNT(*) FROM gerador_nd.notadebito', engine).iloc[0, 0]\n",
      "C:\\Users\\giovanni.5683\\AppData\\Local\\Temp\\ipykernel_22696\\2372087407.py:16: UserWarning: pandas only supports SQLAlchemy connectable (engine/connection) or database string URI or sqlite3 DBAPI2 connection. Other DBAPI2 objects are not tested. Please consider using SQLAlchemy.\n",
      "  df_problematicos = pd.read_sql_query(query_problematicos, engine)\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "  → 40 descrições corrigidas...\n",
      "  → 60 descrições corrigidas...\n",
      "  → 80 descrições corrigidas...\n",
      "  → 100 descrições corrigidas...\n",
      "\n",
      "   ✅ 103 descrições corrigidas!\n",
      "\n",
      "======================================================================\n",
      "✅ RESUMO FINAL:\n",
      "   • CSV original: 6997 linhas (chassis individuais)\n",
      "   • NDs únicas esperadas: 206\n",
      "   • NDs no banco: 368\n",
      "   • Status: ✅ CORRETO!\n",
      "======================================================================\n"
     ]
    }
   ],
   "source": [
    "## Verificar total e corrigir descrições dos novos registros\n",
    "print(\"🔧 Corrigindo descrições dos novos registros...\")\n",
    "print(\"=\"*70)\n",
    "\n",
    "# 1. Verificar total atual\n",
    "total_atual = pd.read_sql_query('SELECT COUNT(*) FROM gerador_nd.notadebito', engine).iloc[0, 0]\n",
    "print(f\"\\n📊 Total de NDs no banco agora: {total_atual}\")\n",
    "\n",
    "# 2. Buscar registros com descrições problemáticas (encoding)\n",
    "query_problematicos = \"\"\"\n",
    "SELECT id, descricao\n",
    "FROM gerador_nd.notadebito\n",
    "WHERE descricao LIKE '%Ã%'\n",
    "   OR descricao LIKE '%Â%'\n",
    "\"\"\"\n",
    "df_problematicos = pd.read_sql_query(query_problematicos, engine)\n",
    "\n",
    "print(f\"   Descrições com encoding errado: {len(df_problematicos)}\")\n",
    "\n",
    "if len(df_problematicos) > 0:\n",
    "    print(f\"\\n   Corrigindo {len(df_problematicos)} descrições...\\n\")\n",
    "    \n",
    "    contador_fix = 0\n",
    "    for idx, row in df_problematicos.iterrows():\n",
    "        try:\n",
    "            # Corrigir encoding\n",
    "            desc_corrigida = row['descricao'].encode('latin1').decode('utf-8')\n",
    "            # Adicionar espaços\n",
    "            desc_corrigida = re.sub(r'([a-zçãõáéíóú])([A-Z])', r'\\1 \\2', desc_corrigida)\n",
    "            desc_corrigida = re.sub(r'([a-z])(\\d)', r'\\1 \\2', desc_corrigida)\n",
    "            desc_corrigida = re.sub(r'(\\d)([A-Z])', r'\\1 \\2', desc_corrigida)\n",
    "            \n",
    "            cursor.execute(\n",
    "                \"UPDATE gerador_nd.notadebito SET descricao = %s WHERE id = %s\",\n",
    "                (desc_corrigida, row['id'])\n",
    "            )\n",
    "            contador_fix += 1\n",
    "            \n",
    "            if contador_fix % 20 == 0:\n",
    "                engine.commit()\n",
    "                print(f\"  → {contador_fix} descrições corrigidas...\")\n",
    "        except Exception as e:\n",
    "            print(f\"  ❌ Erro no ID {row['id']}: {e}\")\n",
    "    \n",
    "    engine.commit()\n",
    "    print(f\"\\n   ✅ {contador_fix} descrições corrigidas!\")\n",
    "\n",
    "# 3. Verificar total esperado\n",
    "print(f\"\\n{'='*70}\")\n",
    "print(f\"✅ RESUMO FINAL:\")\n",
    "print(f\"   • CSV original: 6997 linhas (chassis individuais)\")\n",
    "print(f\"   • NDs únicas esperadas: 206\")\n",
    "print(f\"   • NDs no banco: {total_atual}\")\n",
    "print(f\"   • Status: {'✅ CORRETO!' if total_atual >= 206 else '⚠️ Ainda faltam registros'}\")\n",
    "print(f\"{'='*70}\")"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 88,
   "id": "02e64356",
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "🧹 Removendo duplicatas e mantendo apenas registros corretos...\n",
      "======================================================================\n",
      "\n",
      "📊 Encontradas 0 numero_nd duplicados\n",
      "\n",
      "🔧 Removendo duplicatas...\n",
      "   ✅ 0 registros duplicados removidos\n",
      "\n",
      "======================================================================\n",
      "✅ LIMPEZA CONCLUÍDA:\n",
      "   • Total final no banco: 368\n",
      "   • Esperado: 206\n",
      "   • Status: ⚠️ Diferença de 162 registros\n",
      "======================================================================\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "C:\\Users\\giovanni.5683\\AppData\\Local\\Temp\\ipykernel_22696\\2434234933.py:13: UserWarning: pandas only supports SQLAlchemy connectable (engine/connection) or database string URI or sqlite3 DBAPI2 connection. Other DBAPI2 objects are not tested. Please consider using SQLAlchemy.\n",
      "  df_duplicatas = pd.read_sql_query(query_duplicatas, engine)\n",
      "C:\\Users\\giovanni.5683\\AppData\\Local\\Temp\\ipykernel_22696\\2434234933.py:47: UserWarning: pandas only supports SQLAlchemy connectable (engine/connection) or database string URI or sqlite3 DBAPI2 connection. Other DBAPI2 objects are not tested. Please consider using SQLAlchemy.\n",
      "  total_final = pd.read_sql_query('SELECT COUNT(*) FROM gerador_nd.notadebito', engine).iloc[0, 0]\n"
     ]
    }
   ],
   "source": [
    "## Remover duplicatas - manter apenas os registros com numero_nd correto\n",
    "print(\"🧹 Removendo duplicatas e mantendo apenas registros corretos...\")\n",
    "print(\"=\"*70)\n",
    "\n",
    "# 1. Identificar duplicatas por numero_nd\n",
    "query_duplicatas = \"\"\"\n",
    "SELECT numero_nd, COUNT(*) as qtd\n",
    "FROM gerador_nd.notadebito\n",
    "GROUP BY numero_nd\n",
    "HAVING COUNT(*) > 1\n",
    "ORDER BY qtd DESC\n",
    "\"\"\"\n",
    "df_duplicatas = pd.read_sql_query(query_duplicatas, engine)\n",
    "\n",
    "print(f\"\\n📊 Encontradas {len(df_duplicatas)} numero_nd duplicados\")\n",
    "if len(df_duplicatas) > 0:\n",
    "    print(f\"   Total de registros duplicados: {df_duplicatas['qtd'].sum() - len(df_duplicatas)}\")\n",
    "    print(f\"\\n   Exemplos:\")\n",
    "    print(df_duplicatas.head(10).to_string(index=False))\n",
    "\n",
    "# 2. Para cada duplicata, manter apenas o registro mais recente (maior ID)\n",
    "print(f\"\\n🔧 Removendo duplicatas...\")\n",
    "\n",
    "try:\n",
    "    # Usar CTE para identificar e deletar duplicatas, mantendo o registro com maior ID\n",
    "    query_remove_dups = \"\"\"\n",
    "    DELETE FROM gerador_nd.notadebito\n",
    "    WHERE id IN (\n",
    "        SELECT id\n",
    "        FROM (\n",
    "            SELECT id,\n",
    "                   ROW_NUMBER() OVER (PARTITION BY numero_nd ORDER BY id DESC) as rn\n",
    "            FROM gerador_nd.notadebito\n",
    "        ) t\n",
    "        WHERE rn > 1\n",
    "    )\n",
    "    \"\"\"\n",
    "    cursor.execute(query_remove_dups)\n",
    "    deletados = cursor.rowcount\n",
    "    engine.commit()\n",
    "    print(f\"   ✅ {deletados} registros duplicados removidos\")\n",
    "except Exception as e:\n",
    "    print(f\"   ❌ Erro: {e}\")\n",
    "    engine.rollback()\n",
    "\n",
    "# 3. Verificar total final\n",
    "total_final = pd.read_sql_query('SELECT COUNT(*) FROM gerador_nd.notadebito', engine).iloc[0, 0]\n",
    "\n",
    "print(f\"\\n{'='*70}\")\n",
    "print(f\"✅ LIMPEZA CONCLUÍDA:\")\n",
    "print(f\"   • Total final no banco: {total_final}\")\n",
    "print(f\"   • Esperado: 206\")\n",
    "print(f\"   • Status: {'✅ PERFEITO!' if total_final == 206 else f'⚠️ Diferença de {abs(total_final - 206)} registros'}\")\n",
    "print(f\"{'='*70}\")"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 89,
   "id": "ec7c54ea",
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "🔍 Análise detalhada dos registros no banco...\n",
      "======================================================================\n",
      "\n",
      "📊 Registros com numero_nd desalinhado com filial_id:\n",
      "   Total: 0\n",
      "\n",
      "📊 Comparação CSV vs Banco:\n",
      "   • NDs no CSV: 206\n",
      "   • NDs no banco: 368\n",
      "   • NDs só no banco (devem ser removidos): 162\n",
      "   • NDs só no CSV (faltando): 0\n",
      "\n",
      "======================================================================\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "C:\\Users\\giovanni.5683\\AppData\\Local\\Temp\\ipykernel_22696\\3178859854.py:15: UserWarning: pandas only supports SQLAlchemy connectable (engine/connection) or database string URI or sqlite3 DBAPI2 connection. Other DBAPI2 objects are not tested. Please consider using SQLAlchemy.\n",
      "  df_desalinhados = pd.read_sql_query(query_analise, engine)\n",
      "C:\\Users\\giovanni.5683\\AppData\\Local\\Temp\\ipykernel_22696\\3178859854.py:30: UserWarning: pandas only supports SQLAlchemy connectable (engine/connection) or database string URI or sqlite3 DBAPI2 connection. Other DBAPI2 objects are not tested. Please consider using SQLAlchemy.\n",
      "  banco_nds = set(pd.read_sql_query(query_banco_nds, engine)['numero_nd'].tolist())\n"
     ]
    }
   ],
   "source": [
    "## Análise final: verificar de onde vieram os 368 registros\n",
    "print(\"🔍 Análise detalhada dos registros no banco...\")\n",
    "print(\"=\"*70)\n",
    "\n",
    "# 1. Verificar numero_nd que não batem com o CSV\n",
    "query_analise = \"\"\"\n",
    "SELECT \n",
    "    LEFT(numero_nd, POSITION('-' IN numero_nd)-1)::INTEGER as filial_prefix,\n",
    "    filial_id,\n",
    "    COUNT(*) as qtd\n",
    "FROM gerador_nd.notadebito\n",
    "GROUP BY LEFT(numero_nd, POSITION('-' IN numero_nd)-1)::INTEGER, filial_id\n",
    "HAVING LEFT(numero_nd, POSITION('-' IN numero_nd)-1)::INTEGER != filial_id\n",
    "\"\"\"\n",
    "df_desalinhados = pd.read_sql_query(query_analise, engine)\n",
    "\n",
    "print(f\"\\n📊 Registros com numero_nd desalinhado com filial_id:\")\n",
    "print(f\"   Total: {df_desalinhados['qtd'].sum() if len(df_desalinhados) > 0 else 0}\")\n",
    "\n",
    "if len(df_desalinhados) > 0:\n",
    "    print(f\"\\n   Detalhes:\")\n",
    "    print(df_desalinhados.to_string(index=False))\n",
    "    \n",
    "    print(f\"\\n💡 Esses registros têm numero_nd com filial_id antigo\")\n",
    "    print(f\"   Devem ser removidos pois já foram reinseridos com ID correto\")\n",
    "\n",
    "# 2. Comparar com CSV\n",
    "csv_nds = set(df_todas_nds['numero_nd'].tolist())\n",
    "query_banco_nds = \"SELECT numero_nd FROM gerador_nd.notadebito\"\n",
    "banco_nds = set(pd.read_sql_query(query_banco_nds, engine)['numero_nd'].tolist())\n",
    "\n",
    "nds_so_banco = banco_nds - csv_nds\n",
    "nds_so_csv = csv_nds - banco_nds\n",
    "\n",
    "print(f\"\\n📊 Comparação CSV vs Banco:\")\n",
    "print(f\"   • NDs no CSV: {len(csv_nds)}\")\n",
    "print(f\"   • NDs no banco: {len(banco_nds)}\")\n",
    "print(f\"   • NDs só no banco (devem ser removidos): {len(nds_so_banco)}\")\n",
    "print(f\"   • NDs só no CSV (faltando): {len(nds_so_csv)}\")\n",
    "\n",
    "if len(nds_so_csv) > 0:\n",
    "    print(f\"\\n   Exemplos de NDs faltando:\")\n",
    "    for nd in list(nds_so_csv)[:5]:\n",
    "        print(f\"   - {nd}\")\n",
    "\n",
    "print(f\"\\n{'='*70}\")"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "6c35858f",
   "metadata": {},
   "outputs": [],
   "source": [
    "## Remover NDs que não existem no CSV (lixo do processo anterior)\n",
    "print(\"🗑️  Removendo registros inválidos (não existem no CSV)...\")\n",
    "print(\"=\"*70)\n",
    "\n",
    "if len(nds_so_banco) > 0:\n",
    "    print(f\"\\n📊 Removendo {len(nds_so_banco)} registros...\")\n",
    "    print(f\"   (Primeiros 10: {list(nds_so_banco)[:10]})\\n\")\n",
    "    \n",
    "    try:\n",
    "        # Converter para lista para usar no IN\n",
    "        nds_para_remover = list(nds_so_banco)\n",
    "        \n",
    "        # Deletar em lotes de 50\n",
    "        total_deletado = 0\n",
    "        for i in range(0, len(nds_para_remover), 50):\n",
    "            lote = nds_para_remover[i:i+50]\n",
    "            placeholders = ','.join(['%s'] * len(lote))\n",
    "            query = f\"DELETE FROM gerador_nd.notadebito WHERE numero_nd IN ({placeholders})\"\n",
    "            cursor.execute(query, lote)\n",
    "            total_deletado += cursor.rowcount\n",
    "            engine.commit()\n",
    "            \n",
    "            if total_deletado % 50 == 0:\n",
    "                print(f\"  → {total_deletado} registros removidos...\")\n",
    "        \n",
    "        print(f\"\\n   ✅ Total removido: {total_deletado}\")\n",
    "        \n",
    "    except Exception as e:\n",
    "        print(f\"   ❌ Erro: {e}\")\n",
    "        engine.rollback()\n",
    "\n",
    "# Verificar total final\n",
    "total_final = pd.read_sql_query('SELECT COUNT(*) FROM gerador_nd.notadebito', engine).iloc[0, 0]\n",
    "\n",
    "print(f\"\\n{'='*70}\")\n",
    "print(f\"✅ AJUSTE FINAL CONCLUÍDO:\")\n",
    "print(f\"   • CSV tinha: 6997 linhas (chassis individuais)\")\n",
    "print(f\"   • CSV agrupado: 206 NDs únicas\")\n",
    "print(f\"   • Banco agora tem: {total_final} registros\")\n",
    "print(f\"   • Status: {'🎉 PERFEITO! Todos os registros corretos!' if total_final == 206 else f'⚠️ Diferença de {abs(total_final - 206)} registros'}\")\n",
    "print(f\"{'='*70}\")"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 72,
   "id": "7ce18071",
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Conexão bem-sucedida e dados lidos com sucesso!\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "C:\\Users\\giovanni.5683\\AppData\\Local\\Temp\\ipykernel_22696\\1651513614.py:3: UserWarning: pandas only supports SQLAlchemy connectable (engine/connection) or database string URI or sqlite3 DBAPI2 connection. Other DBAPI2 objects are not tested. Please consider using SQLAlchemy.\n",
      "  df_filial = pd.read_sql_query(filial, engine)\n"
     ]
    },
    {
     "data": {
      "application/vnd.microsoft.datawrangler.viewer.v0+json": {
       "columns": [
        {
         "name": "index",
         "rawType": "int64",
         "type": "integer"
        },
        {
         "name": "id",
         "rawType": "int64",
         "type": "integer"
        },
        {
         "name": "nome_fantasia",
         "rawType": "object",
         "type": "string"
        },
        {
         "name": "razao_social",
         "rawType": "object",
         "type": "string"
        },
        {
         "name": "endereco",
         "rawType": "object",
         "type": "string"
        },
        {
         "name": "cep",
         "rawType": "object",
         "type": "string"
        },
        {
         "name": "cnpj",
         "rawType": "object",
         "type": "string"
        },
        {
         "name": "codigo_filial",
         "rawType": "object",
         "type": "string"
        },
        {
         "name": "nome_loja",
         "rawType": "object",
         "type": "string"
        },
        {
         "name": "agencia",
         "rawType": "object",
         "type": "string"
        },
        {
         "name": "conta",
         "rawType": "object",
         "type": "string"
        },
        {
         "name": "banco",
         "rawType": "object",
         "type": "string"
        },
        {
         "name": "created_at",
         "rawType": "datetime64[ns]",
         "type": "datetime"
        }
       ],
       "ref": "b09e5aad-b687-4777-9c45-f9c6c2bf7799",
       "rows": [
        [
         "0",
         "1",
         "BYD Ctba Chile",
         "Autoplus Comércio de Veículos Ltda",
         "Rua Rockefeller, 1217, Rebouças, Curitiba - PR",
         "82230-130",
         "02.446.766/0001-20",
         "1",
         "BYD Ctba Chile",
         "3099",
         "0002681-6",
         "Banco Bradesco",
         "2026-01-06 17:05:43.697201"
        ],
        [
         "1",
         "2",
         "BYD Maringá",
         "Autoplus Comércio de Veículos Ltda",
         "Rodovia Governador Mario Covas, 882",
         "87.030-010",
         "02.446.766/0004-72",
         "2",
         "BYD Maringá",
         "0084",
         "13010836-8",
         "Banco Santander",
         "2026-01-05 18:11:04.339590"
        ],
        [
         "2",
         "3",
         "BYD Mario Tourinho",
         "R GENERAL MARIO TOURINHO, 1215",
         "R GENERAL MARIO TOURINHO, 1215 ,CAMPINA DO SIQUEIRA - CURITIBA",
         "80.740-015",
         "02.446.766/0007-15",
         "3",
         "BYD Mario Tourinho",
         "0084",
         "13011203-1",
         "Banco Santander",
         "2026-01-06 17:20:16.346561"
        ],
        [
         "3",
         "4",
         "BYD São Jose dos Pinhais",
         "Autoplus Comércio de Veículos Ltda",
         "Av. das Torres, 2080  - São Cristóvão, São José dos Pinhais - PR",
         "83040-300",
         "02.446.766/0008-04",
         "4",
         "BYD São Jose dos Pinhais",
         "0084",
         "13010837-5",
         "Banco Santander",
         "2026-01-06 17:26:18.792442"
        ],
        [
         "4",
         "5",
         "BYD Ponta Grossa",
         "Autoplus Comércio de Veículos Ltda",
         "AV VISCONDE DE MAUA, 1770 , OFICINAS - PONTA GROSSA",
         "84.045-000",
         "02.446.766/0005-53",
         "5",
         "BYD Ponta Grossa",
         "0084",
         "13011201-7",
         "Banco Santander",
         "2026-01-06 17:25:00.406671"
        ],
        [
         "5",
         "6",
         "BYD Cascavel",
         "Autoplus Comércio de Veículos Ltda",
         "Av. Brasil, 1809",
         "85816-302",
         "02.446.766/0006-34",
         "6",
         "BYD Cascavel",
         "0084",
         "13011202-4",
         "Banco Santander",
         "2026-01-06 17:17:28.163240"
        ],
        [
         "6",
         "7",
         "BYD Londrina",
         "Autoplus Comércio de Veículos Ltda",
         "AV TIRADENTES, 2611 - Rodocentro, Londrina - PR",
         "86.071-000",
         "02.446.766/0009-87",
         "7",
         "BYD Londrina",
         "0084",
         "13010838-2",
         "Banco Santander",
         "2026-01-06 17:18:44.555554"
        ],
        [
         "7",
         "8",
         "BYD Portão",
         "Autoplus Comércio de Veículos Ltda",
         "R. João Bettega, 127 -  Cidade Industrial de Curitiba, Curitiba - PR",
         "81070-000",
         "02.446.766/0010-10",
         "8",
         "BYD Portão",
         "3099",
         "0002681-6",
         "Banco Bradesco",
         "2026-01-06 17:21:42.405616"
        ],
        [
         "8",
         "9",
         "BYD Umuarama",
         "Autoplus Comércio de Veículos Ltda",
         "Av. Tiradentes, 2000, PR, Jardim Paraiso, Umuarama",
         "87505-090",
         "02.446.766/0011-00",
         "9",
         "BYD Umuarama",
         "3099",
         "0002681-6",
         "Banco Bradesco",
         "2026-01-06 17:14:20.042101"
        ]
       ],
       "shape": {
        "columns": 12,
        "rows": 9
       }
      },
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>id</th>\n",
       "      <th>nome_fantasia</th>\n",
       "      <th>razao_social</th>\n",
       "      <th>endereco</th>\n",
       "      <th>cep</th>\n",
       "      <th>cnpj</th>\n",
       "      <th>codigo_filial</th>\n",
       "      <th>nome_loja</th>\n",
       "      <th>agencia</th>\n",
       "      <th>conta</th>\n",
       "      <th>banco</th>\n",
       "      <th>created_at</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>1</td>\n",
       "      <td>BYD Ctba Chile</td>\n",
       "      <td>Autoplus Comércio de Veículos Ltda</td>\n",
       "      <td>Rua Rockefeller, 1217, Rebouças, Curitiba - PR</td>\n",
       "      <td>82230-130</td>\n",
       "      <td>02.446.766/0001-20</td>\n",
       "      <td>1</td>\n",
       "      <td>BYD Ctba Chile</td>\n",
       "      <td>3099</td>\n",
       "      <td>0002681-6</td>\n",
       "      <td>Banco Bradesco</td>\n",
       "      <td>2026-01-06 17:05:43.697201</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>2</td>\n",
       "      <td>BYD Maringá</td>\n",
       "      <td>Autoplus Comércio de Veículos Ltda</td>\n",
       "      <td>Rodovia Governador Mario Covas, 882</td>\n",
       "      <td>87.030-010</td>\n",
       "      <td>02.446.766/0004-72</td>\n",
       "      <td>2</td>\n",
       "      <td>BYD Maringá</td>\n",
       "      <td>0084</td>\n",
       "      <td>13010836-8</td>\n",
       "      <td>Banco Santander</td>\n",
       "      <td>2026-01-05 18:11:04.339590</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>3</td>\n",
       "      <td>BYD Mario Tourinho</td>\n",
       "      <td>R GENERAL MARIO TOURINHO, 1215</td>\n",
       "      <td>R GENERAL MARIO TOURINHO, 1215 ,CAMPINA DO SIQ...</td>\n",
       "      <td>80.740-015</td>\n",
       "      <td>02.446.766/0007-15</td>\n",
       "      <td>3</td>\n",
       "      <td>BYD Mario Tourinho</td>\n",
       "      <td>0084</td>\n",
       "      <td>13011203-1</td>\n",
       "      <td>Banco Santander</td>\n",
       "      <td>2026-01-06 17:20:16.346561</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>4</td>\n",
       "      <td>BYD São Jose dos Pinhais</td>\n",
       "      <td>Autoplus Comércio de Veículos Ltda</td>\n",
       "      <td>Av. das Torres, 2080  - São Cristóvão, São Jos...</td>\n",
       "      <td>83040-300</td>\n",
       "      <td>02.446.766/0008-04</td>\n",
       "      <td>4</td>\n",
       "      <td>BYD São Jose dos Pinhais</td>\n",
       "      <td>0084</td>\n",
       "      <td>13010837-5</td>\n",
       "      <td>Banco Santander</td>\n",
       "      <td>2026-01-06 17:26:18.792442</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>5</td>\n",
       "      <td>BYD Ponta Grossa</td>\n",
       "      <td>Autoplus Comércio de Veículos Ltda</td>\n",
       "      <td>AV VISCONDE DE MAUA, 1770 , OFICINAS - PONTA G...</td>\n",
       "      <td>84.045-000</td>\n",
       "      <td>02.446.766/0005-53</td>\n",
       "      <td>5</td>\n",
       "      <td>BYD Ponta Grossa</td>\n",
       "      <td>0084</td>\n",
       "      <td>13011201-7</td>\n",
       "      <td>Banco Santander</td>\n",
       "      <td>2026-01-06 17:25:00.406671</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>5</th>\n",
       "      <td>6</td>\n",
       "      <td>BYD Cascavel</td>\n",
       "      <td>Autoplus Comércio de Veículos Ltda</td>\n",
       "      <td>Av. Brasil, 1809</td>\n",
       "      <td>85816-302</td>\n",
       "      <td>02.446.766/0006-34</td>\n",
       "      <td>6</td>\n",
       "      <td>BYD Cascavel</td>\n",
       "      <td>0084</td>\n",
       "      <td>13011202-4</td>\n",
       "      <td>Banco Santander</td>\n",
       "      <td>2026-01-06 17:17:28.163240</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>6</th>\n",
       "      <td>7</td>\n",
       "      <td>BYD Londrina</td>\n",
       "      <td>Autoplus Comércio de Veículos Ltda</td>\n",
       "      <td>AV TIRADENTES, 2611 - Rodocentro, Londrina - PR</td>\n",
       "      <td>86.071-000</td>\n",
       "      <td>02.446.766/0009-87</td>\n",
       "      <td>7</td>\n",
       "      <td>BYD Londrina</td>\n",
       "      <td>0084</td>\n",
       "      <td>13010838-2</td>\n",
       "      <td>Banco Santander</td>\n",
       "      <td>2026-01-06 17:18:44.555554</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>7</th>\n",
       "      <td>8</td>\n",
       "      <td>BYD Portão</td>\n",
       "      <td>Autoplus Comércio de Veículos Ltda</td>\n",
       "      <td>R. João Bettega, 127 -  Cidade Industrial de C...</td>\n",
       "      <td>81070-000</td>\n",
       "      <td>02.446.766/0010-10</td>\n",
       "      <td>8</td>\n",
       "      <td>BYD Portão</td>\n",
       "      <td>3099</td>\n",
       "      <td>0002681-6</td>\n",
       "      <td>Banco Bradesco</td>\n",
       "      <td>2026-01-06 17:21:42.405616</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>8</th>\n",
       "      <td>9</td>\n",
       "      <td>BYD Umuarama</td>\n",
       "      <td>Autoplus Comércio de Veículos Ltda</td>\n",
       "      <td>Av. Tiradentes, 2000, PR, Jardim Paraiso, Umua...</td>\n",
       "      <td>87505-090</td>\n",
       "      <td>02.446.766/0011-00</td>\n",
       "      <td>9</td>\n",
       "      <td>BYD Umuarama</td>\n",
       "      <td>3099</td>\n",
       "      <td>0002681-6</td>\n",
       "      <td>Banco Bradesco</td>\n",
       "      <td>2026-01-06 17:14:20.042101</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "   id             nome_fantasia                        razao_social  \\\n",
       "0   1            BYD Ctba Chile  Autoplus Comércio de Veículos Ltda   \n",
       "1   2               BYD Maringá  Autoplus Comércio de Veículos Ltda   \n",
       "2   3        BYD Mario Tourinho      R GENERAL MARIO TOURINHO, 1215   \n",
       "3   4  BYD São Jose dos Pinhais  Autoplus Comércio de Veículos Ltda   \n",
       "4   5          BYD Ponta Grossa  Autoplus Comércio de Veículos Ltda   \n",
       "5   6              BYD Cascavel  Autoplus Comércio de Veículos Ltda   \n",
       "6   7              BYD Londrina  Autoplus Comércio de Veículos Ltda   \n",
       "7   8                BYD Portão  Autoplus Comércio de Veículos Ltda   \n",
       "8   9              BYD Umuarama  Autoplus Comércio de Veículos Ltda   \n",
       "\n",
       "                                            endereco         cep  \\\n",
       "0     Rua Rockefeller, 1217, Rebouças, Curitiba - PR   82230-130   \n",
       "1                Rodovia Governador Mario Covas, 882  87.030-010   \n",
       "2  R GENERAL MARIO TOURINHO, 1215 ,CAMPINA DO SIQ...  80.740-015   \n",
       "3  Av. das Torres, 2080  - São Cristóvão, São Jos...   83040-300   \n",
       "4  AV VISCONDE DE MAUA, 1770 , OFICINAS - PONTA G...  84.045-000   \n",
       "5                                   Av. Brasil, 1809   85816-302   \n",
       "6    AV TIRADENTES, 2611 - Rodocentro, Londrina - PR  86.071-000   \n",
       "7  R. João Bettega, 127 -  Cidade Industrial de C...   81070-000   \n",
       "8  Av. Tiradentes, 2000, PR, Jardim Paraiso, Umua...   87505-090   \n",
       "\n",
       "                 cnpj codigo_filial                 nome_loja agencia  \\\n",
       "0  02.446.766/0001-20             1            BYD Ctba Chile    3099   \n",
       "1  02.446.766/0004-72             2               BYD Maringá    0084   \n",
       "2  02.446.766/0007-15             3        BYD Mario Tourinho    0084   \n",
       "3  02.446.766/0008-04             4  BYD São Jose dos Pinhais    0084   \n",
       "4  02.446.766/0005-53             5          BYD Ponta Grossa    0084   \n",
       "5  02.446.766/0006-34             6              BYD Cascavel    0084   \n",
       "6  02.446.766/0009-87             7              BYD Londrina    0084   \n",
       "7  02.446.766/0010-10             8                BYD Portão    3099   \n",
       "8  02.446.766/0011-00             9              BYD Umuarama    3099   \n",
       "\n",
       "        conta            banco                 created_at  \n",
       "0   0002681-6   Banco Bradesco 2026-01-06 17:05:43.697201  \n",
       "1  13010836-8  Banco Santander 2026-01-05 18:11:04.339590  \n",
       "2  13011203-1  Banco Santander 2026-01-06 17:20:16.346561  \n",
       "3  13010837-5  Banco Santander 2026-01-06 17:26:18.792442  \n",
       "4  13011201-7  Banco Santander 2026-01-06 17:25:00.406671  \n",
       "5  13011202-4  Banco Santander 2026-01-06 17:17:28.163240  \n",
       "6  13010838-2  Banco Santander 2026-01-06 17:18:44.555554  \n",
       "7   0002681-6   Banco Bradesco 2026-01-06 17:21:42.405616  \n",
       "8   0002681-6   Banco Bradesco 2026-01-06 17:14:20.042101  "
      ]
     },
     "execution_count": 72,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "## Conexão e leitura da view\n",
    "filial = \"\"\"SELECT * FROM gerador_nd.filial\"\"\"\n",
    "df_filial = pd.read_sql_query(filial, engine)\n",
    "\n",
    "print(\"Conexão bem-sucedida e dados lidos com sucesso!\")\n",
    "\n",
    "df_filial"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 55,
   "id": "9fa013c4",
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Total de linhas no CSV: 6997\n",
      "\n",
      "Colunas: ['CHASSI', 'LOJA', 'ND', 'Val_Info', 'Tipo_de_Bonus', 'Descrição', 'Data_de_Emissao']\n",
      "\n",
      "Lojas únicas: ['Londrina' 'Matriz' 'Maringa' 'Umuarama' 'SJP' 'PontaGrossa'\n",
      " 'MarioTourinho' 'Cascavel' 'Portao']\n",
      "\n",
      "NDs únicas: [np.int64(1), np.int64(2), np.int64(3), np.int64(4), np.int64(5), np.int64(6), np.int64(7), np.int64(8), np.int64(9), np.int64(10), np.int64(11), np.int64(12), np.int64(13), np.int64(14), np.int64(15), np.int64(16), np.int64(17), np.int64(18), np.int64(19), np.int64(20), np.int64(21), np.int64(22), np.int64(23), np.int64(24), np.int64(25), np.int64(26), np.int64(27), np.int64(28), np.int64(29), np.int64(30), np.int64(31), np.int64(32), np.int64(33), np.int64(34), np.int64(35), np.int64(36), np.int64(37), np.int64(38), np.int64(39), np.int64(40), np.int64(41), np.int64(42), np.int64(43), np.int64(44), np.int64(45), np.int64(46), np.int64(47), np.int64(48), np.int64(49), np.int64(50), np.int64(51), np.int64(52), np.int64(53), np.int64(54), np.int64(55), np.int64(56), np.int64(60), np.int64(61), np.int64(62), np.int64(63), np.int64(64), np.int64(65), np.int64(66), np.int64(67), np.int64(68), np.int64(69), np.int64(70), np.int64(71), np.int64(72), np.int64(73), np.int64(74), np.int64(75), np.int64(76), np.int64(77), np.int64(78), np.int64(79), np.int64(80), np.int64(81), np.int64(82), np.int64(83), np.int64(84), np.int64(85), np.int64(86), np.int64(87), np.int64(88), np.int64(89), np.int64(90)]\n"
     ]
    },
    {
     "data": {
      "application/vnd.microsoft.datawrangler.viewer.v0+json": {
       "columns": [
        {
         "name": "index",
         "rawType": "int64",
         "type": "integer"
        },
        {
         "name": "CHASSI",
         "rawType": "object",
         "type": "string"
        },
        {
         "name": "LOJA",
         "rawType": "object",
         "type": "string"
        },
        {
         "name": "ND",
         "rawType": "int64",
         "type": "integer"
        },
        {
         "name": "Val_Info",
         "rawType": "int64",
         "type": "integer"
        },
        {
         "name": "Tipo_de_Bonus",
         "rawType": "object",
         "type": "string"
        },
        {
         "name": "Descrição",
         "rawType": "object",
         "type": "string"
        },
        {
         "name": "Data_de_Emissao",
         "rawType": "object",
         "type": "string"
        }
       ],
       "ref": "7debd01e-5eb7-4d37-956f-a7459064fb3c",
       "rows": [
        [
         "0",
         "LC0C76C46S0025424",
         "Londrina",
         "35",
         "50400",
         "VALIDO PARA TODAS AS LOJAS",
         "101-42BÃ´nusPDISuperAtacadoHÃ­bridos",
         "06/01/2025"
        ],
        [
         "1",
         "LC0C76C4XS0012885",
         "Londrina",
         "35",
         "50400",
         "VALIDO PARA TODAS AS LOJAS",
         "101-42BÃ´nusPDISuperAtacadoHÃ­bridos",
         "07/01/2025"
        ],
        [
         "2",
         "LC0C76C44S0023381",
         "Londrina",
         "35",
         "50400",
         "VALIDO PARA TODAS AS LOJAS",
         "101-42BÃ´nusPDISuperAtacadoHÃ­bridos",
         "08/01/2025"
        ],
        [
         "3",
         "LC0C74C40S5002809",
         "Londrina",
         "35",
         "50400",
         "VALIDO PARA TODAS AS LOJAS",
         "101-42BÃ´nusPDISuperAtacadoHÃ­bridos",
         "06/02/2025"
        ],
        [
         "4",
         "LC0C76C4XS0012983",
         "Londrina",
         "35",
         "50400",
         "VALIDO PARA TODAS AS LOJAS",
         "101-42BÃ´nusPDISuperAtacadoHÃ­bridos",
         "07/02/2025"
        ],
        [
         "5",
         "LC0C76C49S0021013",
         "Londrina",
         "35",
         "50400",
         "VALIDO PARA TODAS AS LOJAS",
         "101-42BÃ´nusPDISuperAtacadoHÃ­bridos",
         "08/02/2025"
        ],
        [
         "6",
         "LC0C74C40S5003216",
         "Londrina",
         "35",
         "50400",
         "VALIDO PARA TODAS AS LOJAS",
         "101-42BÃ´nusPDISuperAtacadoHÃ­bridos",
         "06/03/2025"
        ],
        [
         "7",
         "LC0C76C4XS0013017",
         "Londrina",
         "35",
         "50400",
         "VALIDO PARA TODAS AS LOJAS",
         "101-42BÃ´nusPDISuperAtacadoHÃ­bridos",
         "07/03/2025"
        ],
        [
         "8",
         "LC0CE4CC2S0006094",
         "Matriz",
         "75",
         "76400",
         "VALIDO PARA TODAS AS LOJAS",
         "114-3AlavancagemdeEmplacamentoMarÃ§o.25",
         "06/04/2025"
        ],
        [
         "9",
         "LC0CE4CC5S0012052",
         "Matriz",
         "75",
         "76400",
         "VALIDO PARA TODAS AS LOJAS",
         "114-3AlavancagemdeEmplacamentoMarÃ§o.25",
         "06/04/2025"
        ]
       ],
       "shape": {
        "columns": 7,
        "rows": 10
       }
      },
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>CHASSI</th>\n",
       "      <th>LOJA</th>\n",
       "      <th>ND</th>\n",
       "      <th>Val_Info</th>\n",
       "      <th>Tipo_de_Bonus</th>\n",
       "      <th>Descrição</th>\n",
       "      <th>Data_de_Emissao</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>LC0C76C46S0025424</td>\n",
       "      <td>Londrina</td>\n",
       "      <td>35</td>\n",
       "      <td>50400</td>\n",
       "      <td>VALIDO PARA TODAS AS LOJAS</td>\n",
       "      <td>101-42BÃ´nusPDISuperAtacadoHÃ­bridos</td>\n",
       "      <td>06/01/2025</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>LC0C76C4XS0012885</td>\n",
       "      <td>Londrina</td>\n",
       "      <td>35</td>\n",
       "      <td>50400</td>\n",
       "      <td>VALIDO PARA TODAS AS LOJAS</td>\n",
       "      <td>101-42BÃ´nusPDISuperAtacadoHÃ­bridos</td>\n",
       "      <td>07/01/2025</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>LC0C76C44S0023381</td>\n",
       "      <td>Londrina</td>\n",
       "      <td>35</td>\n",
       "      <td>50400</td>\n",
       "      <td>VALIDO PARA TODAS AS LOJAS</td>\n",
       "      <td>101-42BÃ´nusPDISuperAtacadoHÃ­bridos</td>\n",
       "      <td>08/01/2025</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>LC0C74C40S5002809</td>\n",
       "      <td>Londrina</td>\n",
       "      <td>35</td>\n",
       "      <td>50400</td>\n",
       "      <td>VALIDO PARA TODAS AS LOJAS</td>\n",
       "      <td>101-42BÃ´nusPDISuperAtacadoHÃ­bridos</td>\n",
       "      <td>06/02/2025</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>LC0C76C4XS0012983</td>\n",
       "      <td>Londrina</td>\n",
       "      <td>35</td>\n",
       "      <td>50400</td>\n",
       "      <td>VALIDO PARA TODAS AS LOJAS</td>\n",
       "      <td>101-42BÃ´nusPDISuperAtacadoHÃ­bridos</td>\n",
       "      <td>07/02/2025</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>5</th>\n",
       "      <td>LC0C76C49S0021013</td>\n",
       "      <td>Londrina</td>\n",
       "      <td>35</td>\n",
       "      <td>50400</td>\n",
       "      <td>VALIDO PARA TODAS AS LOJAS</td>\n",
       "      <td>101-42BÃ´nusPDISuperAtacadoHÃ­bridos</td>\n",
       "      <td>08/02/2025</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>6</th>\n",
       "      <td>LC0C74C40S5003216</td>\n",
       "      <td>Londrina</td>\n",
       "      <td>35</td>\n",
       "      <td>50400</td>\n",
       "      <td>VALIDO PARA TODAS AS LOJAS</td>\n",
       "      <td>101-42BÃ´nusPDISuperAtacadoHÃ­bridos</td>\n",
       "      <td>06/03/2025</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>7</th>\n",
       "      <td>LC0C76C4XS0013017</td>\n",
       "      <td>Londrina</td>\n",
       "      <td>35</td>\n",
       "      <td>50400</td>\n",
       "      <td>VALIDO PARA TODAS AS LOJAS</td>\n",
       "      <td>101-42BÃ´nusPDISuperAtacadoHÃ­bridos</td>\n",
       "      <td>07/03/2025</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>8</th>\n",
       "      <td>LC0CE4CC2S0006094</td>\n",
       "      <td>Matriz</td>\n",
       "      <td>75</td>\n",
       "      <td>76400</td>\n",
       "      <td>VALIDO PARA TODAS AS LOJAS</td>\n",
       "      <td>114-3AlavancagemdeEmplacamentoMarÃ§o.25</td>\n",
       "      <td>06/04/2025</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>9</th>\n",
       "      <td>LC0CE4CC5S0012052</td>\n",
       "      <td>Matriz</td>\n",
       "      <td>75</td>\n",
       "      <td>76400</td>\n",
       "      <td>VALIDO PARA TODAS AS LOJAS</td>\n",
       "      <td>114-3AlavancagemdeEmplacamentoMarÃ§o.25</td>\n",
       "      <td>06/04/2025</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "              CHASSI      LOJA  ND  Val_Info               Tipo_de_Bonus  \\\n",
       "0  LC0C76C46S0025424  Londrina  35     50400  VALIDO PARA TODAS AS LOJAS   \n",
       "1  LC0C76C4XS0012885  Londrina  35     50400  VALIDO PARA TODAS AS LOJAS   \n",
       "2  LC0C76C44S0023381  Londrina  35     50400  VALIDO PARA TODAS AS LOJAS   \n",
       "3  LC0C74C40S5002809  Londrina  35     50400  VALIDO PARA TODAS AS LOJAS   \n",
       "4  LC0C76C4XS0012983  Londrina  35     50400  VALIDO PARA TODAS AS LOJAS   \n",
       "5  LC0C76C49S0021013  Londrina  35     50400  VALIDO PARA TODAS AS LOJAS   \n",
       "6  LC0C74C40S5003216  Londrina  35     50400  VALIDO PARA TODAS AS LOJAS   \n",
       "7  LC0C76C4XS0013017  Londrina  35     50400  VALIDO PARA TODAS AS LOJAS   \n",
       "8  LC0CE4CC2S0006094    Matriz  75     76400  VALIDO PARA TODAS AS LOJAS   \n",
       "9  LC0CE4CC5S0012052    Matriz  75     76400  VALIDO PARA TODAS AS LOJAS   \n",
       "\n",
       "                                 Descrição Data_de_Emissao  \n",
       "0     101-42BÃ´nusPDISuperAtacadoHÃ­bridos      06/01/2025  \n",
       "1     101-42BÃ´nusPDISuperAtacadoHÃ­bridos      07/01/2025  \n",
       "2     101-42BÃ´nusPDISuperAtacadoHÃ­bridos      08/01/2025  \n",
       "3     101-42BÃ´nusPDISuperAtacadoHÃ­bridos      06/02/2025  \n",
       "4     101-42BÃ´nusPDISuperAtacadoHÃ­bridos      07/02/2025  \n",
       "5     101-42BÃ´nusPDISuperAtacadoHÃ­bridos      08/02/2025  \n",
       "6     101-42BÃ´nusPDISuperAtacadoHÃ­bridos      06/03/2025  \n",
       "7     101-42BÃ´nusPDISuperAtacadoHÃ­bridos      07/03/2025  \n",
       "8  114-3AlavancagemdeEmplacamentoMarÃ§o.25      06/04/2025  \n",
       "9  114-3AlavancagemdeEmplacamentoMarÃ§o.25      06/04/2025  "
      ]
     },
     "execution_count": 55,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "## Leitura e conversão do CSV BD_ND.csv\n",
    "import pandas as pd\n",
    "\n",
    "# Ler o CSV\n",
    "csv_path = r'C:\\Users\\giovanni.5683\\GITHUB\\controlling_postgreSQL\\Datasets\\BD_ND.csv'\n",
    "df_csv = pd.read_csv(csv_path)\n",
    "\n",
    "print(f\"Total de linhas no CSV: {len(df_csv)}\")\n",
    "print(f\"\\nColunas: {df_csv.columns.tolist()}\")\n",
    "print(f\"\\nLojas únicas: {df_csv['LOJA'].unique()}\")\n",
    "print(f\"\\nNDs únicas: {sorted(df_csv['ND'].unique())}\")\n",
    "\n",
    "df_csv.head(10)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 57,
   "id": "6d5c1aba",
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Lojas não mapeadas: []\n",
      "\n",
      "Total de registros com filial_id: 6997\n"
     ]
    },
    {
     "data": {
      "application/vnd.microsoft.datawrangler.viewer.v0+json": {
       "columns": [
        {
         "name": "index",
         "rawType": "int64",
         "type": "integer"
        },
        {
         "name": "LOJA",
         "rawType": "object",
         "type": "string"
        },
        {
         "name": "filial_id",
         "rawType": "int64",
         "type": "integer"
        }
       ],
       "ref": "2cf4c862-022a-4832-a05d-d802c0670d84",
       "rows": [
        [
         "8",
         "Matriz",
         "1"
        ],
        [
         "112",
         "Maringa",
         "2"
        ],
        [
         "256",
         "MarioTourinho",
         "3"
        ],
        [
         "219",
         "SJP",
         "4"
        ],
        [
         "234",
         "PontaGrossa",
         "5"
        ],
        [
         "308",
         "Cascavel",
         "6"
        ],
        [
         "0",
         "Londrina",
         "7"
        ],
        [
         "2711",
         "Portao",
         "8"
        ],
        [
         "215",
         "Umuarama",
         "9"
        ]
       ],
       "shape": {
        "columns": 2,
        "rows": 9
       }
      },
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>LOJA</th>\n",
       "      <th>filial_id</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>8</th>\n",
       "      <td>Matriz</td>\n",
       "      <td>1</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>112</th>\n",
       "      <td>Maringa</td>\n",
       "      <td>2</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>256</th>\n",
       "      <td>MarioTourinho</td>\n",
       "      <td>3</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>219</th>\n",
       "      <td>SJP</td>\n",
       "      <td>4</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>234</th>\n",
       "      <td>PontaGrossa</td>\n",
       "      <td>5</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>308</th>\n",
       "      <td>Cascavel</td>\n",
       "      <td>6</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>Londrina</td>\n",
       "      <td>7</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2711</th>\n",
       "      <td>Portao</td>\n",
       "      <td>8</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>215</th>\n",
       "      <td>Umuarama</td>\n",
       "      <td>9</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "               LOJA  filial_id\n",
       "8            Matriz          1\n",
       "112         Maringa          2\n",
       "256   MarioTourinho          3\n",
       "219             SJP          4\n",
       "234     PontaGrossa          5\n",
       "308        Cascavel          6\n",
       "0          Londrina          7\n",
       "2711         Portao          8\n",
       "215        Umuarama          9"
      ]
     },
     "execution_count": 57,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "## Mapeamento de LOJA para filial_id\n",
    "loja_to_filial = {\n",
    "    'Londrina': 7,        # BYD Londrina\n",
    "    'Matriz': 1,          # BYD Ctba Chile\n",
    "    'Maringa': 2,         # BYD Maringá\n",
    "    'Umuarama': 9,        # BYD Umuarama\n",
    "    'SJP': 4,             # BYD São Jose dos Pinhais\n",
    "    'PontaGrossa': 5,     # BYD Ponta Grossa\n",
    "    'MarioTourinho': 3,   # BYD Mario Tourinho\n",
    "    'Cascavel': 6,        # BYD Cascavel\n",
    "    'Portao': 8           # BYD Portão\n",
    "}\n",
    "\n",
    "# Adicionar coluna filial_id ao dataframe\n",
    "df_csv['filial_id'] = df_csv['LOJA'].map(loja_to_filial)\n",
    "\n",
    "# Verificar se há alguma loja não mapeada\n",
    "print(\"Lojas não mapeadas:\", df_csv[df_csv['filial_id'].isna()]['LOJA'].unique())\n",
    "print(f\"\\nTotal de registros com filial_id: {df_csv['filial_id'].notna().sum()}\")\n",
    "\n",
    "df_csv[['LOJA', 'filial_id']].drop_duplicates().sort_values('filial_id')"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 58,
   "id": "67c1d05d",
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Exemplos de numero_nd criados:\n"
     ]
    },
    {
     "data": {
      "application/vnd.microsoft.datawrangler.viewer.v0+json": {
       "columns": [
        {
         "name": "index",
         "rawType": "int64",
         "type": "integer"
        },
        {
         "name": "LOJA",
         "rawType": "object",
         "type": "string"
        },
        {
         "name": "filial_id",
         "rawType": "int64",
         "type": "integer"
        },
        {
         "name": "ND",
         "rawType": "int64",
         "type": "integer"
        },
        {
         "name": "ano",
         "rawType": "int32",
         "type": "integer"
        },
        {
         "name": "numero_nd",
         "rawType": "object",
         "type": "string"
        }
       ],
       "ref": "0ad7c359-28ef-4010-bc1b-c125b88e889e",
       "rows": [
        [
         "0",
         "Londrina",
         "7",
         "35",
         "2025",
         "7-2025-035"
        ],
        [
         "1",
         "Londrina",
         "7",
         "35",
         "2025",
         "7-2025-035"
        ],
        [
         "2",
         "Londrina",
         "7",
         "35",
         "2025",
         "7-2025-035"
        ],
        [
         "3",
         "Londrina",
         "7",
         "35",
         "2025",
         "7-2025-035"
        ],
        [
         "4",
         "Londrina",
         "7",
         "35",
         "2025",
         "7-2025-035"
        ],
        [
         "5",
         "Londrina",
         "7",
         "35",
         "2025",
         "7-2025-035"
        ],
        [
         "6",
         "Londrina",
         "7",
         "35",
         "2025",
         "7-2025-035"
        ],
        [
         "7",
         "Londrina",
         "7",
         "35",
         "2025",
         "7-2025-035"
        ],
        [
         "8",
         "Matriz",
         "1",
         "75",
         "2025",
         "1-2025-075"
        ],
        [
         "9",
         "Matriz",
         "1",
         "75",
         "2025",
         "1-2025-075"
        ]
       ],
       "shape": {
        "columns": 5,
        "rows": 10
       }
      },
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>LOJA</th>\n",
       "      <th>filial_id</th>\n",
       "      <th>ND</th>\n",
       "      <th>ano</th>\n",
       "      <th>numero_nd</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>Londrina</td>\n",
       "      <td>7</td>\n",
       "      <td>35</td>\n",
       "      <td>2025</td>\n",
       "      <td>7-2025-035</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>Londrina</td>\n",
       "      <td>7</td>\n",
       "      <td>35</td>\n",
       "      <td>2025</td>\n",
       "      <td>7-2025-035</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>Londrina</td>\n",
       "      <td>7</td>\n",
       "      <td>35</td>\n",
       "      <td>2025</td>\n",
       "      <td>7-2025-035</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>Londrina</td>\n",
       "      <td>7</td>\n",
       "      <td>35</td>\n",
       "      <td>2025</td>\n",
       "      <td>7-2025-035</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>Londrina</td>\n",
       "      <td>7</td>\n",
       "      <td>35</td>\n",
       "      <td>2025</td>\n",
       "      <td>7-2025-035</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>5</th>\n",
       "      <td>Londrina</td>\n",
       "      <td>7</td>\n",
       "      <td>35</td>\n",
       "      <td>2025</td>\n",
       "      <td>7-2025-035</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>6</th>\n",
       "      <td>Londrina</td>\n",
       "      <td>7</td>\n",
       "      <td>35</td>\n",
       "      <td>2025</td>\n",
       "      <td>7-2025-035</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>7</th>\n",
       "      <td>Londrina</td>\n",
       "      <td>7</td>\n",
       "      <td>35</td>\n",
       "      <td>2025</td>\n",
       "      <td>7-2025-035</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>8</th>\n",
       "      <td>Matriz</td>\n",
       "      <td>1</td>\n",
       "      <td>75</td>\n",
       "      <td>2025</td>\n",
       "      <td>1-2025-075</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>9</th>\n",
       "      <td>Matriz</td>\n",
       "      <td>1</td>\n",
       "      <td>75</td>\n",
       "      <td>2025</td>\n",
       "      <td>1-2025-075</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "       LOJA  filial_id  ND   ano   numero_nd\n",
       "0  Londrina          7  35  2025  7-2025-035\n",
       "1  Londrina          7  35  2025  7-2025-035\n",
       "2  Londrina          7  35  2025  7-2025-035\n",
       "3  Londrina          7  35  2025  7-2025-035\n",
       "4  Londrina          7  35  2025  7-2025-035\n",
       "5  Londrina          7  35  2025  7-2025-035\n",
       "6  Londrina          7  35  2025  7-2025-035\n",
       "7  Londrina          7  35  2025  7-2025-035\n",
       "8    Matriz          1  75  2025  1-2025-075\n",
       "9    Matriz          1  75  2025  1-2025-075"
      ]
     },
     "execution_count": 58,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "## Processar Data_de_Emissao e extrair o ano\n",
    "df_csv['Data_de_Emissao'] = pd.to_datetime(df_csv['Data_de_Emissao'], format='%d/%m/%Y')\n",
    "df_csv['ano'] = df_csv['Data_de_Emissao'].dt.year\n",
    "\n",
    "# Criar numero_nd no formato: filial_id-ano-ND (com ND com 3 dígitos)\n",
    "df_csv['numero_nd'] = df_csv.apply(\n",
    "    lambda row: f\"{row['filial_id']}-{row['ano']}-{str(row['ND']).zfill(3)}\", \n",
    "    axis=1\n",
    ")\n",
    "\n",
    "print(\"Exemplos de numero_nd criados:\")\n",
    "df_csv[['LOJA', 'filial_id', 'ND', 'ano', 'numero_nd']].head(10)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 59,
   "id": "8bddbe0e",
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Total de linhas originais: 6997\n",
      "Total de NDs agrupadas: 206\n",
      "\n",
      "Redução: 6997 → 206 linhas\n",
      "\n",
      "Primeiras 5 NDs agrupadas:\n"
     ]
    },
    {
     "data": {
      "application/vnd.microsoft.datawrangler.viewer.v0+json": {
       "columns": [
        {
         "name": "index",
         "rawType": "int64",
         "type": "integer"
        },
        {
         "name": "numero_nd",
         "rawType": "object",
         "type": "string"
        },
        {
         "name": "chassi",
         "rawType": "object",
         "type": "string"
        },
        {
         "name": "data_emissao",
         "rawType": "datetime64[ns]",
         "type": "datetime"
        },
        {
         "name": "valor",
         "rawType": "int64",
         "type": "integer"
        },
        {
         "name": "descricao",
         "rawType": "object",
         "type": "string"
        },
        {
         "name": "filial_id",
         "rawType": "int64",
         "type": "integer"
        },
        {
         "name": "user_id",
         "rawType": "int64",
         "type": "integer"
        }
       ],
       "ref": "f5b1304f-b117-4ec9-8359-0d5bbb41effd",
       "rows": [
        [
         "0",
         "1-2025-060",
         "LC0C74C41S5009008;LC0C74C41S5009025;LC0C74C41S5009042;LC0C74C41S5009073;LC0C74C41S5009090;LC0C74C41S5009106;LC0C74C41S5009123;LC0C74C41S5009185;LC0C74C41S5009199;LC0C74C41S5009235;LC0C74C45S5000263;LC0C74C45S5000909;LC0C74C45S5001218;LC0C74C45S5001560;LC0C74C45S5001980;LC0C74C45S5003552;LC0C74C45S5004250;LC0C74C45S5004278;LC0C74C45S5004345;LC0C74C45S5004670;LC0C74C45S5005530;LC0C74C45S5005950;LC0C74C45S5006094;LC0C74C45S5007147;LC0C74C45S5007181;LC0C74C45S5008931;LC0C74C45S5009349;LC0C74C45S5009402;LC0C74C46S5000255;LC0C74C46S5000319;LC0C74C46S5001163;LC0C74C46S5002796;LC0C74C46S5004063;LC0C74C46S5005598;LC0C74C46S5005620;LC0C74C46S5006542;LC0C74C46S5006895;LC0C74C46S5007092;LC0C74C46S5007139;LC0C74C46S5007240;LC0C74C43S5006496;LC0C74C43S5006983;LC0C74C43S5007552;LC0C74C43S5007597;LC0C74C43S5007616;LC0C74C43S5007695;LC0C74C43S5008314;LC0C74C43S5008376;LC0C74C43S5008720;LC0C74C43S5008734;LC0C74C43S5008748;LC0C74C43S5008801;LC0C74C43S5009317;LC0C74C44S5000660;LC0C74C44S5001064;LC0C74C44S5001100;LC0C74C44S5001534;LC0C74C44S5005390;LC0C74C44S5005437;LC0C74C44S5005454;LC0C74C44S5005499;LC0C74C44S5006393;LC0C74C44S5006426;LC0C74C44S5006474;LC0C74C44S5006507;LC0C74C44S5006927;LC0C74C44S5007060;LC0C74C44S5008306;LC0C74C44S5008502;LC0C74C44S5008743;LC0C74C41S5009266;LC0C74C41S5009283;LC0C74C41S5009297;LC0C74C42S5000821;LC0C74C42S5001788;LC0C74C42S5003038;LC0C74C42S5003606;LC0C74C42S5003721;LC0C74C42S5003816;LC0C74C42S5004528;LGXCD4C48S0074795;LGXCD4C42S0074792;LGXCD4C44S0075099;LGXCD4C43S0074610;LGXCD4C46S0074651;LGXCD4C45S0075113;LGXCD4C42S0074680;LGXCD4C42S0073903;LGXCD4C41S0073052;LPE19W2A1SF030624;LC0C76C4XS0025796;LGXCD4C40S0074659;LC0C76C42S0024187;LC0C74C49S5021469;LC0C74C49S5021536;LC0C74C4XS5002719;LC0C74C4XS5021366;LC0C74C4XS5021433;LC0C74C4XS5021481;LC0C74C4XS5021500;LC0C74C4XS5021531;LC0C74C41S5000793;LC0C74C41S5002236;LC0C74C41S5002317;LC0C74C41S5002947;LC0C74C41S5003256;LC0C74C47S5004010;LC0C74C48S5009619;LC0C74C43S5008426;LC0C74C43S5008457;LC0C74C43S5008460;LC0C74C43S5009009;LC0C74C43S5009012;LC0C74C46S5019968;LC0C74C46S5021350;LC0C74C46S5021400;LC0C74C47S5019428;LC0C74C47S5021390;LC0C74C48S5018286;LC0C74C48S5018370;LC0C74C48S5021172;LC0C74C48S5021463;LC0C74C49S5020810;LC0C74C44S5000402;LC0C74C44S5000738;LC0C74C44S5000741;LC0C74C44S5000769;LC0C74C44S5001436;LC0C74C44S5001694;LC0C74C44S5001954;LC0C74C44S5002103;LC0C74C44S5002215;LC0C74C44S5002554;LGXCE4CCXS0051619;LGXCE4CCXS0051622;LGXCE4CCXS0051796;LGXCE4CCXS0051801;LGXCE4CCXS0052771;LGXCE4CCXS0053046;LGXCE4CCXS0053063;LGXCE4CCXS0053080;LGXCE4CCXS0053094;LGXCE4CCXS0053127;LGXCE4CCXS0053144;LGXCE4CCXS0053208;LGXCE4CCXS0053211;LGXCE4CCXS0053290;LGXCE4CCXS0053452;LGXCE4CC6S0051343;LGXCE4CC6S0057191;LGXCE4CC6S0057403;LGXCE4CC6S0057451;LGXCE4CC6S0057482;LGXCE4CC5S0044819;LGXCE4CC0S0034151;LGXCE4CC0S0034554;LGXCE4CC0S0034604;LGXCE4CC0S0034702;LGXCE4CC0S0034733;LGXCE4CC0S0035011;LGXCE4CC0S0035090;LGXCE4CC0S0035560;LGXCE4CC0S0035574;LGXCE4CC0S0035784;LGXCE4CC0S0035798;LGXCE4CC0S0036305;LGXCE4CC0S0042024;LGXCE4CC0S0043612;LGXCE4CC0S0044114;LGXCE4CC0S0044422;LGXCE4CC0S0044498;LGXCE4CC0S0044517;LGXCE4CC0S0044808;LC0CE4CB0S0013391;LC0CE4CB0S0016453;LC0CE4CB0S0017800;LC0CE4CB0S0017828;LC0CE4CB0S0017845;LC0CE4CB1S0016557;LGXC74C44S0018621;LGXC74C44S0020398;LGXC74C44S0021907;LGXC74C45S0016778;LGXC74C45S0018627;LGXC74C45S0018658;LGXC74C45S0019535;LGXC74C45S0020345;LGXC74C45S0020507;LGXC74C46S0012643;LGXC74C46S0016630;LGXC74C46S0016823;LGXC74C46S0016949;LGXC74C46S0018622;LGXC74C46S0018667;LGXC74C46S0018670;LGXC74C43S0016889;LGXC74C43S0016892;LGXC74C43S0016942;LGXC74C43S0018626;LGXC74C43S0018724;LGXC74C43S0019629;LGXC74C43S0019680;LGXC74C43S0020344;LGXC74C43S0020456;LGXC74C43S0020487;LGXC74C43S0020604;LGXC74C44S0016691;LGXC74C40S0019572;LGXC74C40S0019605;LGXC74C40S0019619;LGXC74C40S0019684;LGXC74C42S0018553;LGXC74C42S0018682;LGXC74C42S0020366;LGXC74C42S0020481;LGXC74C43S0016763;LGXC74C43S0016780;LGXC74C43S0016827;LGXC74C43S0016861;LGXCE4CC6S0051990;LGXCE4CC6S0052024;LGXCE4CC6S0052041;LGXCE4CC6S0052072;LGXCE4CC6S0052153;LGXCE4CC6S0052167;LGXCE4CC6S0052265;LGXCE4CC6S0052279;LGXCE4CC6S0052394;LGXCE4CC6S0052458;LC0C76C47S0012715;LC0C76C47S0012763;LC0C76C47S0012777;LC0C76C47S0012858;LC0C76C47S0012892;LC0C76C47S0012911;LC0C76C47S0012925;LC0C76C47S0012939;LC0C76C47S0013010;LC0C76C48S0011881;LC0C76C48S0012691;LC0C76C48S0012741;LC0C76C48S0012769;LC0C76C48S0012772;LC0C76C48S0012786;LC0C76C48S0012805;LC0C76C48S0012836;LC0C76C48S0012853;LGXCE4CC3S0038291;LGXCE4CC3S0038422;LGXCE4CC3S0038453;LGXCE4CC3S0038467;LGXCE4CC3S0038520;LGXCE4CC3S0038534;LGXCE4CC3S0038548;LGXCE4CC3S0038551;LC0C74C47S5006405;LC0C74C49S5012917;LC0C74C49S5012920;LC0C74C49S5013923;LC0C74C49S5014098;LC0C74C49S5014733;LC0C74C4XS5009931;LC0C74C4XS5011887;LC0C74C4XS5012666;LC0C74C49S5009449;LC0C74C49S5009452;LC0C74C49S5009466;LC0C74C49S5009483;LC0C74C49S5009497;LC0C74C49S5009516;LC0C74C49S5009533;LC0C74C49S5010116;LC0C74C49S5010780;LC0C74C49S5010875;LC0C74C49S5011184;LC0C74C49S5011623;LC0C74C49S5011671;LC0C74C49S5011718;LC0C74C49S5011735;LC0C74C49S5011766;LC0C74C49S5011802;LC0C74C49S5015901;LC0C74C49S5015915;LC0C74C49S5015980;LC0C74C40S5001000;LC0C74C40S5001224;LC0C74C40S5002373;LC0C74C40S5002650;LC0C74C40S5003197;LC0C74C40S5003488;LC0C74C40S5003507;LC0C74C40S5004060;LC0C74C40S5004138;LC0C74C40S5004141;LC0C74C40S5004303;LC0C74C40S5004396;LC0C74C40S5004690;LC0C74C40S5005600;LC0C74C40S5006021;LC0C74C40S5006097;LC0C74C40S5006553;LC0C74C40S5006567;LC0C74C40S5006603;LC0C74C40S5006651;LC0C74C40S5006682;LC0C74C40S5006889;LC0C74C40S5007105;LC0C74C40S5007136;LC0C74C40S5007203;LC0C74C40S5007220;LC0C74C40S5008013;LC0C74C40S5008030;LC0C74C40S5008058;LC0C74C40S5008061;LC0C74C40S5008075;LC0C74C40S5008089;LC0C74C40S5008108;LC0C74C40S5008111;LC0C74C40S5008142;LC0C74C40S5008223;LC0C74C40S5008965;LC0C74C40S5009694;LC0C74C40S5011252;LC0C74C41S5000325;LC0C74C41S5000857;LC0C74C41S5000891;LC0C74C41S5001247;LC0C74C41S5001491;LC0C74C41S5001880;LC0C74C41S5001944;LC0C74C41S5002429;LC0C74C41S5002785;LC0C74C41S5002835;LC0C74C41S5003192;LC0C74C41S5003242;LC0C74C41S5004049;LC0C74C41S5004102;LC0C74C41S5004245;LC0C74C41S5004312;LC0C74C41S5004651;LC0C74C41S5005170;LC0C74C41S5005203;LC0C74C41S5005573;LC0C74C41S5006013;LC0C74C49S5012898",
         "2025-02-19 00:00:00",
         "241500",
         "PDIDezembro/24",
         "1",
         "4"
        ],
        [
         "1",
         "1-2025-061",
         "LC0C74C41S5009008;LC0C74C41S5009025;LC0C74C41S5009042;LC0C74C41S5009073;LC0C74C41S5009090;LC0C74C41S5009106;LC0C74C41S5009123;LC0C74C41S5009185;LC0C74C41S5009199;LC0C74C41S5009235;LC0C74C45S5000263;LC0C74C45S5000909;LC0C74C45S5001218;LC0C74C45S5001560;LC0C74C45S5001980;LC0C74C45S5003552;LC0C74C45S5004250;LC0C74C45S5004278;LC0C74C45S5004345;LC0C74C45S5004670;LC0C74C45S5005530;LC0C74C45S5005950;LC0C74C45S5006094;LC0C74C45S5007147;LC0C74C45S5007181;LC0C74C45S5008931;LC0C74C45S5009349;LC0C74C45S5009402;LC0C74C46S5000255;LC0C74C46S5000319;LC0C74C46S5001163;LC0C74C46S5002796;LC0C74C46S5004063;LC0C74C46S5005598;LC0C74C46S5005620;LC0C74C46S5006542;LC0C74C46S5006895;LC0C74C46S5007092;LC0C74C46S5007139;LC0C74C46S5007240;LC0C74C43S5006496;LC0C74C43S5006983;LC0C74C43S5007552;LC0C74C43S5007597;LC0C74C43S5007616;LC0C74C43S5007695;LC0C74C43S5008314;LC0C74C43S5008376;LC0C74C43S5008720;LC0C74C43S5008734;LC0C74C43S5008748;LC0C74C43S5008801;LC0C74C43S5009317;LC0C74C44S5000660;LC0C74C44S5001064;LC0C74C44S5001100;LC0C74C44S5001534;LC0C74C44S5005390;LC0C74C44S5005437;LC0C74C44S5005454;LC0C74C44S5005499;LC0C74C44S5006393;LC0C74C44S5006426;LC0C74C44S5006474;LC0C74C44S5006507;LC0C74C44S5006927;LC0C74C44S5007060;LC0C74C44S5008306;LC0C74C44S5008502;LC0C74C44S5008743;LC0C74C41S5009266;LC0C74C41S5009283;LC0C74C41S5009297;LC0C74C42S5000821;LC0C74C42S5001788;LC0C74C42S5003038;LC0C74C42S5003606;LC0C74C42S5003721;LC0C74C42S5003816;LC0C74C42S5004528;LGXCD4C48S0074795;LGXCD4C42S0074792;LGXCD4C44S0075099;LGXCD4C43S0074610;LGXCD4C46S0074651;LGXCD4C45S0075113;LGXCD4C42S0074680;LGXCD4C42S0073903;LGXCD4C41S0073052;LC0C76C4XS0025796;LC0C76C42S0024187;LC0C74C49S5021469;LC0C74C49S5021536;LC0C74C4XS5002719;LC0C74C4XS5021366;LC0C74C41S5009008;LC0C74C41S5009025;LC0C74C41S5009042;LC0C74C41S5009073;LC0C74C41S5009090;LC0C74C41S5009106;LC0C74C41S5009123;LC0C74C41S5009185;LC0C74C41S5009199;LC0C74C41S5009235;LC0C74C45S5000263;LC0C74C45S5000909;LC0C74C45S5001218;LC0C74C45S5001560;LC0C74C45S5001980;LC0C74C45S5003552;LC0C74C45S5004250;LC0C74C45S5004278;LC0C74C45S5004345;LC0C74C45S5004670;LC0C74C45S5005530;LC0C74C45S5005950;LC0C74C45S5006094;LC0C74C45S5007147;LC0C74C45S5007181;LC0C74C45S5008931;LC0C74C45S5009349;LC0C74C45S5009402;LC0C74C46S5000255;LC0C74C46S5000319;LC0C74C46S5001163;LC0C74C46S5002796;LC0C74C46S5004063;LC0C74C46S5005598;LC0C74C46S5005620;LC0C74C46S5006542;LC0C74C46S5006895;LC0C74C46S5007092;LC0C74C46S5007139;LC0C74C46S5007240;LC0C74C43S5006496;LC0C74C43S5006983;LC0C74C43S5007552;LC0C74C43S5007597;LC0C74C43S5007616;LC0C74C43S5007695;LC0C74C43S5008314;LC0C74C43S5008376;LC0C74C43S5008720;LC0C74C43S5008734;LC0C74C43S5008748;LC0C74C43S5008801;LC0C74C43S5009317;LC0C74C44S5000660;LC0C74C44S5001064;LC0C74C44S5001100;LC0C74C44S5001534;LC0C74C44S5005390;LC0C74C44S5005437;LC0C74C44S5005454;LC0C74C44S5005499;LC0C74C44S5006393;LC0C74C44S5006426;LC0C74C44S5006474;LC0C74C44S5006507;LC0C74C44S5006927;LC0C74C44S5007060;LC0C74C44S5008306;LC0C74C44S5008502;LC0C74C44S5008743;LC0C74C41S5009266;LC0C74C41S5009283;LC0C74C41S5009297;LC0C74C42S5000821;LC0C74C42S5001788;LC0C74C42S5003038;LC0C74C42S5003606;LC0C74C42S5003721;LC0C74C42S5003816;LC0C74C42S5004528;LGXCD4C48S0074795;LGXCD4C42S0074792;LGXCD4C44S0075099;LGXCD4C43S0074610;LGXCD4C46S0074651;LGXCD4C45S0075113;LGXCD4C42S0074680;LGXCD4C42S0073903;LGXCD4C41S0073052;LC0C76C4XS0025796;LC0C76C42S0024187;LC0C74C49S5021469;LC0C74C49S5021536;LC0C74C4XS5002719;LC0C74C4XS5021366;LC0C74C4XS5021433;LC0C74C4XS5021481;LC0C74C4XS5021500;LC0C74C4XS5021531;LC0C74C41S5000793;LC0C74C41S5002236;LC0C74C41S5002317;LC0C74C41S5002947;LC0C74C41S5003256;LC0C74C47S5004010;LC0C74C48S5009619;LC0C74C43S5008426;LC0C74C43S5008457;LC0C74C43S5008460;LC0C74C43S5009009;LC0C74C43S5009012;LC0C74C46S5019968;LC0C74C46S5021350;LC0C74C46S5021400;LC0C74C47S5019428;LC0C74C47S5021390;LC0C74C48S5018286;LC0C74C48S5018370;LC0C74C48S5021172;LC0C74C48S5021463;LC0C74C49S5020810;LC0C74C44S5000402;LC0C74C44S5000738;LC0C74C44S5000741;LC0C74C44S5000769;LC0C74C44S5001436;LC0C74C44S5001694;LC0C74C44S5001954;LC0C74C44S5002103;LC0C74C44S5002215;LC0C74C44S5002554;LC0CE4CB0S0013391;LC0CE4CB0S0016453;LC0CE4CB0S0017800;LC0CE4CB0S0017828;LC0CE4CB0S0017845;LC0CE4CB1S0016557;LGXC74C44S0018621;LGXC74C44S0020398;LGXC74C44S0021907;LGXC74C45S0016778;LGXC74C45S0018627;LGXC74C45S0018658;LGXC74C45S0019535;LGXC74C45S0020345;LGXC74C45S0020507;LGXC74C46S0012643;LGXC74C46S0016630;LGXC74C46S0016823;LGXC74C46S0016949;LGXC74C46S0018622;LGXC74C46S0018667;LGXC74C46S0018670;LGXC74C43S0016889;LGXC74C43S0016892;LGXC74C43S0016942;LGXC74C43S0018626;LGXC74C43S0018724;LGXC74C43S0019629;LGXC74C43S0019680;LGXC74C43S0020344;LGXC74C43S0020456;LGXC74C43S0020487;LGXC74C43S0020604;LGXC74C44S0016691;LGXC74C40S0019572;LGXC74C40S0019605;LGXC74C40S0019619;LGXC74C40S0019684;LGXC74C42S0018553;LGXC74C42S0018682;LGXC74C42S0020366;LGXC74C42S0020481;LGXC74C43S0016763;LGXC74C43S0016780;LGXC74C43S0016827;LGXC74C43S0016861;LC0C76C47S0012715;LC0C76C47S0012763;LC0C76C47S0012777;LC0C76C47S0012858;LC0C76C47S0012892;LC0C76C47S0012911;LC0C76C47S0012925;LC0C76C47S0012939;LC0C76C47S0013010;LC0C76C48S0011881;LC0C76C48S0012691;LC0C76C48S0012741;LC0C76C48S0012769;LC0C76C48S0012772;LC0C76C48S0012786;LC0C76C48S0012805;LC0C76C48S0012836;LC0C76C48S0012853;LC0C74C47S5006405;LC0C74C49S5012917;LC0C74C49S5012920;LC0C74C49S5013923;LC0C74C49S5014098;LC0C74C49S5014733;LC0C74C4XS5009931;LC0C74C4XS5011887;LC0C74C4XS5012666;LC0C74C49S5009449;LC0C74C49S5009452;LC0C74C49S5009466;LC0C74C49S5009483;LC0C74C49S5009497;LC0C74C49S5009516;LC0C74C49S5009533;LC0C74C49S5010116;LC0C74C49S5010780;LC0C74C49S5010875;LC0C74C49S5011184;LC0C74C49S5011623;LC0C74C49S5011671;LC0C74C49S5011718;LC0C74C49S5011735;LC0C74C49S5011766;LC0C74C49S5011802;LC0C74C49S5015901;LC0C74C49S5015915;LC0C74C49S5015980;LC0C74C40S5001000;LC0C74C40S5001224;LC0C74C40S5002373;LC0C74C40S5002650;LC0C74C40S5003197;LC0C74C40S5003488;LC0C74C40S5003507;LC0C74C40S5004060;LC0C74C40S5004138;LC0C74C40S5004141;LC0C74C40S5004303;LC0C74C40S5004396;LC0C74C40S5004690;LC0C74C40S5005600;LC0C74C40S5006021;LC0C74C40S5006097;LC0C74C40S5006553;LC0C74C40S5006567;LC0C74C40S5006603;LC0C74C40S5006651;LC0C74C40S5006682;LC0C74C40S5006889;LC0C74C40S5007105;LC0C74C40S5007136;LC0C74C40S5007203;LC0C74C40S5007220;LC0C74C40S5008013;LC0C74C40S5008030;LC0C74C40S5008058;LC0C74C40S5008061;LC0C74C40S5008075;LC0C74C40S5008089;LC0C74C40S5008108;LC0C74C40S5008111;LC0C74C40S5008142;LC0C74C40S5008223;LC0C74C40S5008965;LC0C74C40S5009694;LC0C74C40S5011252;LC0C74C41S5000325;LC0C74C41S5000857;LC0C74C41S5000891;LC0C74C41S5001247;LC0C74C41S5001491;LC0C74C41S5001880;LC0C74C41S5001944;LC0C74C41S5002429;LC0C74C41S5002785;LC0C74C41S5002835;LC0C74C41S5003192;LC0C74C41S5003242;LC0C74C41S5004049;LC0C74C41S5004102;LC0C74C41S5004245;LC0C74C41S5004312;LC0C74C41S5004651;LC0C74C41S5005170;LC0C74C41S5005203;LC0C74C41S5005573;LC0C74C41S5006013;LC0C74C49S5012898",
         "2025-02-19 00:00:00",
         "1090260",
         "AtacadoDezembro/24",
         "1",
         "4"
        ],
        [
         "2",
         "1-2025-062",
         "LC0C74C42S5007154;LC0C74C42S5021135;LGXCE4CC4S0055407;LGXCE4CC4S0055682;LC0C74C46S5008212;LC0C74C46S5022112;LC0C74C49S5000282;LC0C74C42S5021605;LGXCE4CC3S0048755;LC0C74C43S5022214;LC0C74C42S5017182;LGXC74C48S0033414;LGXCD4C44S0073658;LGXCD4C44S0073661;LC0C74C40S5008707;LC0C76C43S0029642;LC0C76C43S0009018;LGXC74C44S0026556;LGXCE4CC3S0038226;LGXCE4CC4S0057075;LC0C74C48S5008406;LGXCF6CD1S2000449;LC0CE4CC0S0004666;LC0CE4CC3S0012678;LC0CE4CB0S0005033;LGXCE4CC5S0047445;LGXCE4CC5S0047459;LC0C74C47S5006999;LC0C76C45S0010154;LC0C74C48S5017722;LC0CE4CC1S0009570;LGXCE4CC4S0056878;LGXCE4CC6S0048989;LC0C74C48S5022029;LGXC74C41S0033240;LC0C74C49S5020306;LC0C76C4XS0011588;LC0C76C47S0010124;LC0C76C47S0011516;LC0C76C48S0010147;LC0C76C46S0009918;LC0C74C40S5022266;LC0C74C42S5007252;LC0C74C42S5022284;LC0C74C43S5022200;LC0C74C44S5022254;LC0C74C46S5009151;LC0C74C47S5009143;LC0C74C46S5020084;LC0C76C41S0010135;LC0CE4CB0S4002206;LC0C74C46S5009229;LC0CE4CC2S0005656;LC0C74C40S5007010;LC0C76C43S0010220;LGXCE4CC2S0053767;LGXCE4CC2S0038847;LC0C74C43S5008376;LC0C74C41S5022129;LC0CE4CC4S0004508;LGXC74C47S0026440;LC0C76C46S0010020;LC0C76C4XS0025300;LC0C74C41S5009297;LC0C74C43S5008801;LGXC74C47S0026387;LGXC74C40S0027316;LC0C76C43S0010234;LC0C74C4XS5021030;LC0CE4CB6S0002041;LPE19W2A0SF030775;LC0C74C45S5001218;LGXCF6CD2S2003988;LGXCE4CC3S0049274;LC0C76C41S0012788;LC0CE4CB1S4002294;LC0C74C46S5005620;LC0C74C45S5022277;LGXCE4CCXS0027093;LGXCE4CC5S0028586;LGXCE4CC6S0017659;LGXCE4CC9S0028333;LGXCE4CC4S0028305;LGXCE4CC3S0057701;LC0C76C4XS0009906;LC0C76C45S0010011;LGXCD4C40S0074659;LC0CE4CB7S0001240;LGXC74C42S0004703;LGXC74C43S0010476;LC0C74C45S5001560;LC0C74C46S5007139;LC0C74C46S5006895;LGXCE4CCXS0028342;LC0CE4CB5S0002662;LC0C74C42S5004528;LC0C74C41S5009025;LC0C74C41S5009185;LC0C74C44S5006927;LGXCD4C42S0074680;LGXCD4C44S0075099;LC0C74C45S5018598;LC0C74C45S5022280;LC0C74C41S5009283;LC0C74C42S5000821;LC0C74C43S5006983;LGXCE4CC7S0033966;LGXCE4CC6S0055490;LGXC74C49S0007016;LC0C74C49S5021696;LC0C74C44S5001064;LGXCD4C41S0073911;LGXCE4CC6S0021145;LGXCE4CCXS0045030;LC0C74C43S5008734;LC0C74C45S5001980;LC0C74C46S5000319;LC0C74C43S5009317;LC0C74C44S5005499;LC0C74C45S5007181;LC0CE4CB7S0013453;LGXC74C47S0006799;LPE19W2A1SF030610;LC0C74C44S5005390;LC0C76C44S0009187;LC0C76C41S0025606;LGXC74C41S0025820;LC0C74C44S5005437;LPE19W2A4SF030018;LPE19W2A1SF030624;LC0C74C44S5006474;LGXCD4C42S0074792;LC0CE4CB3S0019489;LC0CE4CB1S4001355;LC0C74C44S5001954;LC0C74C43S5022262;LC0C74C41S5002317;LC0C74C46S5005598;LGXCE4CC0S0047708;LC0CE4CB4S0016360;LC0C74C49S5014098;LC0C74C49S5013923;LC0C74C47S5021390;LC0C74C47S5019428;LC0C74C47S5004010;LC0C74C46S5021350;LGXCD4C42S0073903;LGXC74C4XS0046908;LGXC74C48S0009422",
         "2025-07-03 00:00:00",
         "241860",
         "ResultadoCampanhadeAlavancagemdeEmplacamentosDezembro/24",
         "1",
         "4"
        ],
        [
         "3",
         "1-2025-063",
         "LC0C74C46S5009229;LC0C74C48S5018904;LC0C74C40S5007010;LGXCF6CD8S2003798;LC0C76C43S0010220;LGXC74C43S0034308;LC0C74C42S5007185;LGXC74C47S0026387;LC0C74C46S5008291;LGXCF6CD1S2002668;LGXC74C47S0026440;LGXC74C47S0017043;LC0C76C46S0029716;LGXC74C42S0033263;LPE19W2A0SF030775;LC0C76C43S0010234;LC0C76C45S0024927;LC0CE4CB6S0002041;LGXC74C40S0027316;LC0C76C41S0012788;LC0C76C41S0012872;LC0C76C49S0022775;LGXC74C49S0040601;LC0C76C49S0018239;LC0C76C45S0010011;LC0CE4CB5S0002662;LGXCE4CC6S0025874;LGXCE4CC9S0028302;LC0C74C43S5007664;LGXC74C41S0034338;LGXC74C42S0004703;LGXC74C43S0010476;LC0C76C47S0029353;LGXC74C45S0042748;LC0C76C47S0010754;LGXC74C43S0030064;LGXC74C4XS0030000;LGXC74C40S0009110;LGXC74C47S0028219;LGXC74C49S0006030;LC0C76C43S0010265;LGXC74C49S0007016;LC0C74C43S5001198;LGXCF6CD9S2000392;LGXC74C46S0030222;LC0C76C45S0021610;LGXC74C45S0028199;LC0CE4CB7S0013453;LGXC74C47S0006799;LC0C76C4XS0012935;LC0C76C41S0012919;LC0C76C49S0017625;LC0C76C49S0022372;LC0C76C46S0029392;LGXC74C41S0030242;LC0C74C43S5007812;LC0C74C44S5008113;LGXC74C42S0010551;LGXC74C45S0030230;LGXC74C45S0030261;LGXC74C49S0030392;LC0CE4CB7S0013419;LC0C76C47S0029496;LC0C76C41S0012998;LGXC74C49S0008277;LGXC74C48S0028827;LGXC74C42S0007715;LC0CE4CB4S0016360;LGXC74C4XS0046908;LGXC74C48S0009422;LGXC74C49S0009140;LGXC74C49S0007128;LGXC74C42S0043422;LC0C76C43S0029673;LC0C76C4XS0018377;LC0C76C45S0029481;LGXC74C45S0006008;LC0CE4CB8S0013414;LGXC74C44S0048587;LGXC74C44S0047035;LC0CE4CB5S0016397;LC0CE4CB8S0013395;LGXC74C48S0010540;LGXCF6CD0S2001897;LC0C74C45S5002398;LC0C74C45S5012848",
         "2025-03-11 00:00:00",
         "955160",
         "ResultadoBÃ´nusPolÃ­ticaComercialDezembro/24",
         "1",
         "4"
        ],
        [
         "4",
         "1-2025-064",
         "LC0CE4CB7S4003854",
         "2025-03-21 00:00:00",
         "8168",
         "ResultadoBÃ´nusEqualizaÃ§Ã£oYuanPro",
         "1",
         "4"
        ]
       ],
       "shape": {
        "columns": 7,
        "rows": 5
       }
      },
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>numero_nd</th>\n",
       "      <th>chassi</th>\n",
       "      <th>data_emissao</th>\n",
       "      <th>valor</th>\n",
       "      <th>descricao</th>\n",
       "      <th>filial_id</th>\n",
       "      <th>user_id</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>1-2025-060</td>\n",
       "      <td>LC0C74C41S5009008;LC0C74C41S5009025;LC0C74C41S...</td>\n",
       "      <td>2025-02-19</td>\n",
       "      <td>241500</td>\n",
       "      <td>PDIDezembro/24</td>\n",
       "      <td>1</td>\n",
       "      <td>4</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>1-2025-061</td>\n",
       "      <td>LC0C74C41S5009008;LC0C74C41S5009025;LC0C74C41S...</td>\n",
       "      <td>2025-02-19</td>\n",
       "      <td>1090260</td>\n",
       "      <td>AtacadoDezembro/24</td>\n",
       "      <td>1</td>\n",
       "      <td>4</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>1-2025-062</td>\n",
       "      <td>LC0C74C42S5007154;LC0C74C42S5021135;LGXCE4CC4S...</td>\n",
       "      <td>2025-07-03</td>\n",
       "      <td>241860</td>\n",
       "      <td>ResultadoCampanhadeAlavancagemdeEmplacamentosD...</td>\n",
       "      <td>1</td>\n",
       "      <td>4</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>1-2025-063</td>\n",
       "      <td>LC0C74C46S5009229;LC0C74C48S5018904;LC0C74C40S...</td>\n",
       "      <td>2025-03-11</td>\n",
       "      <td>955160</td>\n",
       "      <td>ResultadoBÃ´nusPolÃ­ticaComercialDezembro/24</td>\n",
       "      <td>1</td>\n",
       "      <td>4</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>1-2025-064</td>\n",
       "      <td>LC0CE4CB7S4003854</td>\n",
       "      <td>2025-03-21</td>\n",
       "      <td>8168</td>\n",
       "      <td>ResultadoBÃ´nusEqualizaÃ§Ã£oYuanPro</td>\n",
       "      <td>1</td>\n",
       "      <td>4</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "    numero_nd                                             chassi data_emissao  \\\n",
       "0  1-2025-060  LC0C74C41S5009008;LC0C74C41S5009025;LC0C74C41S...   2025-02-19   \n",
       "1  1-2025-061  LC0C74C41S5009008;LC0C74C41S5009025;LC0C74C41S...   2025-02-19   \n",
       "2  1-2025-062  LC0C74C42S5007154;LC0C74C42S5021135;LGXCE4CC4S...   2025-07-03   \n",
       "3  1-2025-063  LC0C74C46S5009229;LC0C74C48S5018904;LC0C74C40S...   2025-03-11   \n",
       "4  1-2025-064                                  LC0CE4CB7S4003854   2025-03-21   \n",
       "\n",
       "     valor                                          descricao  filial_id  \\\n",
       "0   241500                                     PDIDezembro/24          1   \n",
       "1  1090260                                 AtacadoDezembro/24          1   \n",
       "2   241860  ResultadoCampanhadeAlavancagemdeEmplacamentosD...          1   \n",
       "3   955160       ResultadoBÃ´nusPolÃ­ticaComercialDezembro/24          1   \n",
       "4     8168                ResultadoBÃ´nusEqualizaÃ§Ã£oYuanPro          1   \n",
       "\n",
       "   user_id  \n",
       "0        4  \n",
       "1        4  \n",
       "2        4  \n",
       "3        4  \n",
       "4        4  "
      ]
     },
     "execution_count": 59,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "## Agrupar chassis por numero_nd\n",
    "# Agrupar por numero_nd e concatenar os chassis com \";\"\n",
    "df_agrupado = df_csv.groupby('numero_nd').agg({\n",
    "    'CHASSI': lambda x: ';'.join(x.astype(str)),  # Concatenar chassis\n",
    "    'Data_de_Emissao': 'first',  # Pegar a primeira data (todas devem ser iguais)\n",
    "    'Val_Info': 'first',  # Pegar o primeiro valor (todos devem ser iguais)\n",
    "    'Descrição': 'first',  # Pegar a primeira descrição\n",
    "    'filial_id': 'first'  # Pegar o filial_id\n",
    "}).reset_index()\n",
    "\n",
    "# Renomear colunas para o formato final\n",
    "df_agrupado.columns = ['numero_nd', 'chassi', 'data_emissao', 'valor', 'descricao', 'filial_id']\n",
    "\n",
    "# Adicionar user_id = 4\n",
    "df_agrupado['user_id'] = 4\n",
    "\n",
    "print(f\"Total de linhas originais: {len(df_csv)}\")\n",
    "print(f\"Total de NDs agrupadas: {len(df_agrupado)}\")\n",
    "print(f\"\\nRedução: {len(df_csv)} → {len(df_agrupado)} linhas\")\n",
    "print(f\"\\nPrimeiras 5 NDs agrupadas:\")\n",
    "df_agrupado.head()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 60,
   "id": "32524dc2",
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Exemplo de ND agrupada:\n",
      "numero_nd: 1-2025-060\n",
      "filial_id: 1\n",
      "data_emissao: 2025-02-19 00:00:00\n",
      "valor: 241500\n",
      "descricao: PDIDezembro/24\n",
      "\n",
      "Chassis (primeiros 200 caracteres):\n",
      "LC0C74C41S5009008;LC0C74C41S5009025;LC0C74C41S5009042;LC0C74C41S5009073;LC0C74C41S5009090;LC0C74C41S5009106;LC0C74C41S5009123;LC0C74C41S5009185;LC0C74C41S5009199;LC0C74C41S5009235;LC0C74C45S5000263;LC\n",
      "\n",
      "Total de chassis nesta ND: 345\n"
     ]
    }
   ],
   "source": [
    "## Verificar um exemplo de agrupamento\n",
    "exemplo_nd = df_agrupado.iloc[0]\n",
    "print(\"Exemplo de ND agrupada:\")\n",
    "print(f\"numero_nd: {exemplo_nd['numero_nd']}\")\n",
    "print(f\"filial_id: {exemplo_nd['filial_id']}\")\n",
    "print(f\"data_emissao: {exemplo_nd['data_emissao']}\")\n",
    "print(f\"valor: {exemplo_nd['valor']}\")\n",
    "print(f\"descricao: {exemplo_nd['descricao']}\")\n",
    "print(f\"\\nChassis (primeiros 200 caracteres):\")\n",
    "print(exemplo_nd['chassi'][:200])\n",
    "print(f\"\\nTotal de chassis nesta ND: {len(exemplo_nd['chassi'].split(';'))}\")"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 62,
   "id": "f2fca862",
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Preparando para inserir 206 registros...\n",
      "\n",
      "  → 50 registros inseridos...\n",
      "  → 100 registros inseridos...\n",
      "  → 150 registros inseridos...\n",
      "  → 200 registros inseridos...\n",
      "\n",
      "✅ Inserção concluída!\n",
      "   Total inserido: 206 registros\n",
      "   Erros: 0\n"
     ]
    }
   ],
   "source": [
    "## Inserir os dados no PostgreSQL usando INSERT direto\n",
    "import psycopg2\n",
    "\n",
    "# Preparar os dados para inserção\n",
    "dados_para_inserir = df_agrupado[['numero_nd', 'data_emissao', 'chassi', 'valor', 'descricao', 'filial_id', 'user_id']].copy()\n",
    "\n",
    "# Converter data_emissao para string no formato correto\n",
    "dados_para_inserir['data_emissao'] = dados_para_inserir['data_emissao'].dt.strftime('%Y-%m-%d')\n",
    "\n",
    "print(f\"Preparando para inserir {len(dados_para_inserir)} registros...\\n\")\n",
    "\n",
    "# Inserir registro por registro\n",
    "contador = 0\n",
    "erros = 0\n",
    "\n",
    "for _, row in dados_para_inserir.iterrows():\n",
    "    try:\n",
    "        query = \"\"\"\n",
    "        INSERT INTO gerador_nd.notadebito \n",
    "        (numero_nd, data_emissao, chassi, valor, descricao, filial_id, user_id, created_at)\n",
    "        VALUES (%s, %s, %s, %s, %s, %s, %s, NOW())\n",
    "        \"\"\"\n",
    "        cursor.execute(query, (\n",
    "            row['numero_nd'],\n",
    "            row['data_emissao'],\n",
    "            row['chassi'],\n",
    "            row['valor'],\n",
    "            row['descricao'],\n",
    "            row['filial_id'],\n",
    "            row['user_id']\n",
    "        ))\n",
    "        contador += 1\n",
    "        \n",
    "        # Commit a cada 50 registros\n",
    "        if contador % 50 == 0:\n",
    "            engine.commit()\n",
    "            print(f\"  → {contador} registros inseridos...\")\n",
    "            \n",
    "    except Exception as e:\n",
    "        erros += 1\n",
    "        print(f\"❌ Erro no registro {contador + 1}: {e}\")\n",
    "        engine.rollback()\n",
    "\n",
    "# Commit final\n",
    "engine.commit()\n",
    "\n",
    "print(f\"\\n✅ Inserção concluída!\")\n",
    "print(f\"   Total inserido: {contador} registros\")\n",
    "print(f\"   Erros: {erros}\")"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 63,
   "id": "b0bbf3c5",
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Total de registros na tabela: 206\n",
      "\n",
      "Primeiros 10 registros inseridos:\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "C:\\Users\\giovanni.5683\\AppData\\Local\\Temp\\ipykernel_22696\\2772612799.py:17: UserWarning: pandas only supports SQLAlchemy connectable (engine/connection) or database string URI or sqlite3 DBAPI2 connection. Other DBAPI2 objects are not tested. Please consider using SQLAlchemy.\n",
      "  df_verificacao = pd.read_sql_query(query_verificacao, engine)\n",
      "C:\\Users\\giovanni.5683\\AppData\\Local\\Temp\\ipykernel_22696\\2772612799.py:18: UserWarning: pandas only supports SQLAlchemy connectable (engine/connection) or database string URI or sqlite3 DBAPI2 connection. Other DBAPI2 objects are not tested. Please consider using SQLAlchemy.\n",
      "  print(f\"Total de registros na tabela: {pd.read_sql_query('SELECT COUNT(*) FROM gerador_nd.notadebito', engine).iloc[0, 0]}\")\n"
     ]
    },
    {
     "data": {
      "application/vnd.microsoft.datawrangler.viewer.v0+json": {
       "columns": [
        {
         "name": "index",
         "rawType": "int64",
         "type": "integer"
        },
        {
         "name": "id",
         "rawType": "int64",
         "type": "integer"
        },
        {
         "name": "numero_nd",
         "rawType": "object",
         "type": "string"
        },
        {
         "name": "data_emissao",
         "rawType": "object",
         "type": "unknown"
        },
        {
         "name": "chassi_preview",
         "rawType": "object",
         "type": "string"
        },
        {
         "name": "valor",
         "rawType": "float64",
         "type": "float"
        },
        {
         "name": "descricao_preview",
         "rawType": "object",
         "type": "string"
        },
        {
         "name": "filial_id",
         "rawType": "int64",
         "type": "integer"
        },
        {
         "name": "user_id",
         "rawType": "int64",
         "type": "integer"
        }
       ],
       "ref": "8b3fbfc2-c427-4a03-ae30-e889106d830d",
       "rows": [
        [
         "0",
         "1949",
         "1-2025-060",
         "2025-02-19",
         "LC0C74C41S5009008;LC0C74C41S5009025;LC0C74C41S5009042;LC0C74C41S5009073;LC0C74C41S5009090;LC0C74C41S",
         "241500.0",
         "PDIDezembro/24",
         "1",
         "4"
        ],
        [
         "1",
         "1950",
         "1-2025-061",
         "2025-02-19",
         "LC0C74C41S5009008;LC0C74C41S5009025;LC0C74C41S5009042;LC0C74C41S5009073;LC0C74C41S5009090;LC0C74C41S",
         "1090260.0",
         "AtacadoDezembro/24",
         "1",
         "4"
        ],
        [
         "2",
         "1951",
         "1-2025-062",
         "2025-07-03",
         "LC0C74C42S5007154;LC0C74C42S5021135;LGXCE4CC4S0055407;LGXCE4CC4S0055682;LC0C74C46S5008212;LC0C74C46S",
         "241860.0",
         "ResultadoCampanhadeAlavancagemdeEmplacamentosDezem",
         "1",
         "4"
        ],
        [
         "3",
         "1952",
         "1-2025-063",
         "2025-03-11",
         "LC0C74C46S5009229;LC0C74C48S5018904;LC0C74C40S5007010;LGXCF6CD8S2003798;LC0C76C43S0010220;LGXC74C43S",
         "955160.0",
         "ResultadoBÃ´nusPolÃ­ticaComercialDezembro/24",
         "1",
         "4"
        ],
        [
         "4",
         "1953",
         "1-2025-064",
         "2025-03-21",
         "LC0CE4CB7S4003854",
         "8168.0",
         "ResultadoBÃ´nusEqualizaÃ§Ã£oYuanPro",
         "1",
         "4"
        ],
        [
         "5",
         "1954",
         "1-2025-065",
         "2025-03-21",
         "LGXC74C49S0007128;LC0C74C49S5012917;LGXCE4CC5S0057313;LGXCE4CC4S0057433;LC0C74C4XS5012666;LGXCE4CCXS",
         "11200.0",
         "ResultadoCampanhadeAlavancagemdeEmplacamentoJaneir",
         "1",
         "4"
        ],
        [
         "6",
         "1955",
         "1-2025-066",
         "2025-03-21",
         "LC0C76C48S0012853;LC0C76C46S0029635;LPE19W2A3SF030639;LC0C74C4XS5021531;LGXC74C46S0009113;LC0C74C4XS",
         "384196.0",
         "BÃ´nusPoliticacomercialJaneiro/25",
         "1",
         "4"
        ],
        [
         "7",
         "1956",
         "1-2025-067",
         "2025-03-27",
         "LC0C76C4XS0012952;LC0C76C43S0017670;LC0C76C46S0023771;LC0C76C49S0023764;LC0C76C40S0024902;LC0C76C40S",
         "29812.0",
         "BÃ´nusPerformanceFevereiro/25",
         "1",
         "4"
        ],
        [
         "8",
         "1957",
         "1-2025-068",
         "2025-03-21",
         "LC0C74C41S5004245;LC0CE4CBXS0002835;LGXCF6CD2S2000654;LGXC74C43S0016889;LGXC74C46S0046890;LC0C74C40S",
         "64500.0",
         "BÃ´nusCampanhadeAlavancagemdeEmplacamentoFevereiro",
         "1",
         "4"
        ],
        [
         "9",
         "1958",
         "1-2025-069",
         "2025-04-09",
         "LC0C74C40S5001224;LC0C74C40S5002650;LC0C74C40S5003488;LC0C74C40S5005600;LC0C74C40S5006021;LC0C74C40S",
         "1359804.0",
         "BÃ´nusPolÃ­ticaComercialFevereiro/25",
         "1",
         "4"
        ]
       ],
       "shape": {
        "columns": 8,
        "rows": 10
       }
      },
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>id</th>\n",
       "      <th>numero_nd</th>\n",
       "      <th>data_emissao</th>\n",
       "      <th>chassi_preview</th>\n",
       "      <th>valor</th>\n",
       "      <th>descricao_preview</th>\n",
       "      <th>filial_id</th>\n",
       "      <th>user_id</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>1949</td>\n",
       "      <td>1-2025-060</td>\n",
       "      <td>2025-02-19</td>\n",
       "      <td>LC0C74C41S5009008;LC0C74C41S5009025;LC0C74C41S...</td>\n",
       "      <td>241500.0</td>\n",
       "      <td>PDIDezembro/24</td>\n",
       "      <td>1</td>\n",
       "      <td>4</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>1950</td>\n",
       "      <td>1-2025-061</td>\n",
       "      <td>2025-02-19</td>\n",
       "      <td>LC0C74C41S5009008;LC0C74C41S5009025;LC0C74C41S...</td>\n",
       "      <td>1090260.0</td>\n",
       "      <td>AtacadoDezembro/24</td>\n",
       "      <td>1</td>\n",
       "      <td>4</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>1951</td>\n",
       "      <td>1-2025-062</td>\n",
       "      <td>2025-07-03</td>\n",
       "      <td>LC0C74C42S5007154;LC0C74C42S5021135;LGXCE4CC4S...</td>\n",
       "      <td>241860.0</td>\n",
       "      <td>ResultadoCampanhadeAlavancagemdeEmplacamentosD...</td>\n",
       "      <td>1</td>\n",
       "      <td>4</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>1952</td>\n",
       "      <td>1-2025-063</td>\n",
       "      <td>2025-03-11</td>\n",
       "      <td>LC0C74C46S5009229;LC0C74C48S5018904;LC0C74C40S...</td>\n",
       "      <td>955160.0</td>\n",
       "      <td>ResultadoBÃ´nusPolÃ­ticaComercialDezembro/24</td>\n",
       "      <td>1</td>\n",
       "      <td>4</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>1953</td>\n",
       "      <td>1-2025-064</td>\n",
       "      <td>2025-03-21</td>\n",
       "      <td>LC0CE4CB7S4003854</td>\n",
       "      <td>8168.0</td>\n",
       "      <td>ResultadoBÃ´nusEqualizaÃ§Ã£oYuanPro</td>\n",
       "      <td>1</td>\n",
       "      <td>4</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>5</th>\n",
       "      <td>1954</td>\n",
       "      <td>1-2025-065</td>\n",
       "      <td>2025-03-21</td>\n",
       "      <td>LGXC74C49S0007128;LC0C74C49S5012917;LGXCE4CC5S...</td>\n",
       "      <td>11200.0</td>\n",
       "      <td>ResultadoCampanhadeAlavancagemdeEmplacamentoJa...</td>\n",
       "      <td>1</td>\n",
       "      <td>4</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>6</th>\n",
       "      <td>1955</td>\n",
       "      <td>1-2025-066</td>\n",
       "      <td>2025-03-21</td>\n",
       "      <td>LC0C76C48S0012853;LC0C76C46S0029635;LPE19W2A3S...</td>\n",
       "      <td>384196.0</td>\n",
       "      <td>BÃ´nusPoliticacomercialJaneiro/25</td>\n",
       "      <td>1</td>\n",
       "      <td>4</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>7</th>\n",
       "      <td>1956</td>\n",
       "      <td>1-2025-067</td>\n",
       "      <td>2025-03-27</td>\n",
       "      <td>LC0C76C4XS0012952;LC0C76C43S0017670;LC0C76C46S...</td>\n",
       "      <td>29812.0</td>\n",
       "      <td>BÃ´nusPerformanceFevereiro/25</td>\n",
       "      <td>1</td>\n",
       "      <td>4</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>8</th>\n",
       "      <td>1957</td>\n",
       "      <td>1-2025-068</td>\n",
       "      <td>2025-03-21</td>\n",
       "      <td>LC0C74C41S5004245;LC0CE4CBXS0002835;LGXCF6CD2S...</td>\n",
       "      <td>64500.0</td>\n",
       "      <td>BÃ´nusCampanhadeAlavancagemdeEmplacamentoFever...</td>\n",
       "      <td>1</td>\n",
       "      <td>4</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>9</th>\n",
       "      <td>1958</td>\n",
       "      <td>1-2025-069</td>\n",
       "      <td>2025-04-09</td>\n",
       "      <td>LC0C74C40S5001224;LC0C74C40S5002650;LC0C74C40S...</td>\n",
       "      <td>1359804.0</td>\n",
       "      <td>BÃ´nusPolÃ­ticaComercialFevereiro/25</td>\n",
       "      <td>1</td>\n",
       "      <td>4</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "     id   numero_nd data_emissao  \\\n",
       "0  1949  1-2025-060   2025-02-19   \n",
       "1  1950  1-2025-061   2025-02-19   \n",
       "2  1951  1-2025-062   2025-07-03   \n",
       "3  1952  1-2025-063   2025-03-11   \n",
       "4  1953  1-2025-064   2025-03-21   \n",
       "5  1954  1-2025-065   2025-03-21   \n",
       "6  1955  1-2025-066   2025-03-21   \n",
       "7  1956  1-2025-067   2025-03-27   \n",
       "8  1957  1-2025-068   2025-03-21   \n",
       "9  1958  1-2025-069   2025-04-09   \n",
       "\n",
       "                                      chassi_preview      valor  \\\n",
       "0  LC0C74C41S5009008;LC0C74C41S5009025;LC0C74C41S...   241500.0   \n",
       "1  LC0C74C41S5009008;LC0C74C41S5009025;LC0C74C41S...  1090260.0   \n",
       "2  LC0C74C42S5007154;LC0C74C42S5021135;LGXCE4CC4S...   241860.0   \n",
       "3  LC0C74C46S5009229;LC0C74C48S5018904;LC0C74C40S...   955160.0   \n",
       "4                                  LC0CE4CB7S4003854     8168.0   \n",
       "5  LGXC74C49S0007128;LC0C74C49S5012917;LGXCE4CC5S...    11200.0   \n",
       "6  LC0C76C48S0012853;LC0C76C46S0029635;LPE19W2A3S...   384196.0   \n",
       "7  LC0C76C4XS0012952;LC0C76C43S0017670;LC0C76C46S...    29812.0   \n",
       "8  LC0C74C41S5004245;LC0CE4CBXS0002835;LGXCF6CD2S...    64500.0   \n",
       "9  LC0C74C40S5001224;LC0C74C40S5002650;LC0C74C40S...  1359804.0   \n",
       "\n",
       "                                   descricao_preview  filial_id  user_id  \n",
       "0                                     PDIDezembro/24          1        4  \n",
       "1                                 AtacadoDezembro/24          1        4  \n",
       "2  ResultadoCampanhadeAlavancagemdeEmplacamentosD...          1        4  \n",
       "3       ResultadoBÃ´nusPolÃ­ticaComercialDezembro/24          1        4  \n",
       "4                ResultadoBÃ´nusEqualizaÃ§Ã£oYuanPro          1        4  \n",
       "5  ResultadoCampanhadeAlavancagemdeEmplacamentoJa...          1        4  \n",
       "6                  BÃ´nusPoliticacomercialJaneiro/25          1        4  \n",
       "7                      BÃ´nusPerformanceFevereiro/25          1        4  \n",
       "8  BÃ´nusCampanhadeAlavancagemdeEmplacamentoFever...          1        4  \n",
       "9               BÃ´nusPolÃ­ticaComercialFevereiro/25          1        4  "
      ]
     },
     "execution_count": 63,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "## Verificar os dados inseridos\n",
    "query_verificacao = \"\"\"\n",
    "SELECT \n",
    "    id,\n",
    "    numero_nd,\n",
    "    data_emissao,\n",
    "    LEFT(chassi, 100) as chassi_preview,\n",
    "    valor,\n",
    "    LEFT(descricao, 50) as descricao_preview,\n",
    "    filial_id,\n",
    "    user_id\n",
    "FROM gerador_nd.notadebito\n",
    "ORDER BY id\n",
    "LIMIT 10\n",
    "\"\"\"\n",
    "\n",
    "df_verificacao = pd.read_sql_query(query_verificacao, engine)\n",
    "print(f\"Total de registros na tabela: {pd.read_sql_query('SELECT COUNT(*) FROM gerador_nd.notadebito', engine).iloc[0, 0]}\")\n",
    "print(\"\\nPrimeiros 10 registros inseridos:\")\n",
    "df_verificacao"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 65,
   "id": "0ac4080c",
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Situação atual da tabela filial:\n",
      "============================================================\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "C:\\Users\\giovanni.5683\\AppData\\Local\\Temp\\ipykernel_22696\\230135428.py:12: UserWarning: pandas only supports SQLAlchemy connectable (engine/connection) or database string URI or sqlite3 DBAPI2 connection. Other DBAPI2 objects are not tested. Please consider using SQLAlchemy.\n",
      "  df_situacao = pd.read_sql_query(query_filial_atual, engine)\n"
     ]
    },
    {
     "data": {
      "application/vnd.microsoft.datawrangler.viewer.v0+json": {
       "columns": [
        {
         "name": "index",
         "rawType": "int64",
         "type": "integer"
        },
        {
         "name": "id_atual",
         "rawType": "int64",
         "type": "integer"
        },
        {
         "name": "codigo_filial_desejado",
         "rawType": "int64",
         "type": "integer"
        },
        {
         "name": "nome_loja",
         "rawType": "object",
         "type": "string"
        },
        {
         "name": "nome_fantasia",
         "rawType": "object",
         "type": "string"
        }
       ],
       "ref": "c472f0d6-9e00-4de0-9747-5c634a13f18f",
       "rows": [
        [
         "0",
         "1",
         "2",
         "BYD Maringá",
         "BYD Maringá"
        ],
        [
         "1",
         "2",
         "1",
         "BYD Ctba Chile",
         "BYD Ctba Chile"
        ],
        [
         "2",
         "3",
         "9",
         "BYD Umuarama",
         "BYD Umuarama"
        ],
        [
         "3",
         "4",
         "6",
         "BYD Cascavel",
         "BYD Cascavel"
        ],
        [
         "4",
         "5",
         "7",
         "BYD Londrina",
         "BYD Londrina"
        ],
        [
         "5",
         "6",
         "3",
         "BYD Mario Tourinho",
         "BYD Mario Tourinho"
        ],
        [
         "6",
         "7",
         "8",
         "BYD Portão",
         "BYD Portão"
        ],
        [
         "7",
         "8",
         "5",
         "BYD Ponta Grossa",
         "BYD Ponta Grossa"
        ],
        [
         "8",
         "9",
         "4",
         "BYD São Jose dos Pinhais",
         "BYD São Jose dos Pinhais"
        ]
       ],
       "shape": {
        "columns": 4,
        "rows": 9
       }
      },
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>id_atual</th>\n",
       "      <th>codigo_filial_desejado</th>\n",
       "      <th>nome_loja</th>\n",
       "      <th>nome_fantasia</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>1</td>\n",
       "      <td>2</td>\n",
       "      <td>BYD Maringá</td>\n",
       "      <td>BYD Maringá</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>2</td>\n",
       "      <td>1</td>\n",
       "      <td>BYD Ctba Chile</td>\n",
       "      <td>BYD Ctba Chile</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>3</td>\n",
       "      <td>9</td>\n",
       "      <td>BYD Umuarama</td>\n",
       "      <td>BYD Umuarama</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>4</td>\n",
       "      <td>6</td>\n",
       "      <td>BYD Cascavel</td>\n",
       "      <td>BYD Cascavel</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>5</td>\n",
       "      <td>7</td>\n",
       "      <td>BYD Londrina</td>\n",
       "      <td>BYD Londrina</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>5</th>\n",
       "      <td>6</td>\n",
       "      <td>3</td>\n",
       "      <td>BYD Mario Tourinho</td>\n",
       "      <td>BYD Mario Tourinho</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>6</th>\n",
       "      <td>7</td>\n",
       "      <td>8</td>\n",
       "      <td>BYD Portão</td>\n",
       "      <td>BYD Portão</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>7</th>\n",
       "      <td>8</td>\n",
       "      <td>5</td>\n",
       "      <td>BYD Ponta Grossa</td>\n",
       "      <td>BYD Ponta Grossa</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>8</th>\n",
       "      <td>9</td>\n",
       "      <td>4</td>\n",
       "      <td>BYD São Jose dos Pinhais</td>\n",
       "      <td>BYD São Jose dos Pinhais</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "   id_atual  codigo_filial_desejado                 nome_loja  \\\n",
       "0         1                       2               BYD Maringá   \n",
       "1         2                       1            BYD Ctba Chile   \n",
       "2         3                       9              BYD Umuarama   \n",
       "3         4                       6              BYD Cascavel   \n",
       "4         5                       7              BYD Londrina   \n",
       "5         6                       3        BYD Mario Tourinho   \n",
       "6         7                       8                BYD Portão   \n",
       "7         8                       5          BYD Ponta Grossa   \n",
       "8         9                       4  BYD São Jose dos Pinhais   \n",
       "\n",
       "              nome_fantasia  \n",
       "0               BYD Maringá  \n",
       "1            BYD Ctba Chile  \n",
       "2              BYD Umuarama  \n",
       "3              BYD Cascavel  \n",
       "4              BYD Londrina  \n",
       "5        BYD Mario Tourinho  \n",
       "6                BYD Portão  \n",
       "7          BYD Ponta Grossa  \n",
       "8  BYD São Jose dos Pinhais  "
      ]
     },
     "execution_count": 65,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "## Análise da situação atual de filial\n",
    "query_filial_atual = \"\"\"\n",
    "SELECT \n",
    "    id as id_atual,\n",
    "    codigo_filial::INTEGER as codigo_filial_desejado,\n",
    "    nome_loja,\n",
    "    nome_fantasia\n",
    "FROM gerador_nd.filial\n",
    "ORDER BY id\n",
    "\"\"\"\n",
    "\n",
    "df_situacao = pd.read_sql_query(query_filial_atual, engine)\n",
    "print(\"Situação atual da tabela filial:\")\n",
    "print(\"=\"*60)\n",
    "df_situacao"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 66,
   "id": "6b3c658e",
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Mapeamento de IDs:\n",
      "============================================================\n",
      "BYD Maringá: 1 → 2\n",
      "BYD Ctba Chile: 2 → 1\n",
      "BYD Umuarama: 3 → 9\n",
      "BYD Cascavel: 4 → 6\n",
      "BYD Londrina: 5 → 7\n",
      "BYD Mario Tourinho: 6 → 3\n",
      "BYD Portão: 7 → 8\n",
      "BYD Ponta Grossa: 8 → 5\n",
      "BYD São Jose dos Pinhais: 9 → 4\n",
      "\n",
      "⚠️  Precisamos atualizar:\n",
      "   1. notadebito.filial_id (FK)\n",
      "   2. filial.id (PK)\n"
     ]
    }
   ],
   "source": [
    "## Criar mapeamento de id_atual → id_novo (codigo_filial)\n",
    "mapeamento = {\n",
    "    1: 2,  # BYD Maringá: id 1 → 2\n",
    "    2: 1,  # BYD Ctba Chile: id 2 → 1\n",
    "    3: 9,  # BYD Umuarama: id 3 → 9\n",
    "    4: 6,  # BYD Cascavel: id 4 → 6\n",
    "    5: 7,  # BYD Londrina: id 5 → 7\n",
    "    6: 3,  # BYD Mario Tourinho: id 6 → 3\n",
    "    7: 8,  # BYD Portão: id 7 → 8\n",
    "    8: 5,  # BYD Ponta Grossa: id 8 → 5\n",
    "    9: 4   # BYD São Jose dos Pinhais: id 9 → 4\n",
    "}\n",
    "\n",
    "print(\"Mapeamento de IDs:\")\n",
    "print(\"=\"*60)\n",
    "for id_antigo, id_novo in mapeamento.items():\n",
    "    filial_nome = df_situacao[df_situacao['id_atual'] == id_antigo]['nome_loja'].values[0]\n",
    "    print(f\"{filial_nome}: {id_antigo} → {id_novo}\")\n",
    "    \n",
    "print(\"\\n⚠️  Precisamos atualizar:\")\n",
    "print(\"   1. notadebito.filial_id (FK)\")\n",
    "print(\"   2. filial.id (PK)\")"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 67,
   "id": "0ae03220",
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "🔧 Iniciando processo de padronização de IDs...\n",
      "\n",
      "======================================================================\n",
      "\n",
      "[1/5] Adicionando coluna temporária novo_id na tabela filial...\n",
      "      ✅ Coluna temporária criada\n",
      "\n",
      "[2/5] Preenchendo novo_id com valores de codigo_filial...\n",
      "      ✅ novo_id preenchido\n",
      "\n",
      "[3/5] Adicionando coluna temporária novo_filial_id em notadebito...\n",
      "      ✅ Coluna temporária criada em notadebito\n",
      "\n",
      "[4/5] Atualizando novo_filial_id em notadebito...\n",
      "      ✅ novo_filial_id atualizado\n",
      "\n",
      "[5/5] Verificando atualizações...\n",
      "\n",
      "      Primeiras 10 linhas de notadebito:\n",
      "     id   numero_nd  filial_id_antigo  filial_id_novo       nome_loja\n",
      "0  1949  1-2025-060                 1               2     BYD Maringá\n",
      "1  1953  1-2025-064                 1               2     BYD Maringá\n",
      "2  1962  1-2025-073                 1               2     BYD Maringá\n",
      "3  1974  1-2025-085                 1               2     BYD Maringá\n",
      "4  1980  2-2025-025                 2               1  BYD Ctba Chile\n",
      "5  1981  2-2025-026                 2               1  BYD Ctba Chile\n",
      "6  1983  2-2025-028                 2               1  BYD Ctba Chile\n",
      "7  1992  2-2025-037                 2               1  BYD Ctba Chile\n",
      "8  1993  2-2025-038                 2               1  BYD Ctba Chile\n",
      "9  1994  2-2025-039                 2               1  BYD Ctba Chile\n",
      "\n",
      "======================================================================\n",
      "✅ Preparação concluída! Pronto para aplicar as mudanças finais.\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "C:\\Users\\giovanni.5683\\AppData\\Local\\Temp\\ipykernel_22696\\2203194766.py:75: UserWarning: pandas only supports SQLAlchemy connectable (engine/connection) or database string URI or sqlite3 DBAPI2 connection. Other DBAPI2 objects are not tested. Please consider using SQLAlchemy.\n",
      "  df_check = pd.read_sql_query(query_check, engine)\n"
     ]
    }
   ],
   "source": [
    "## Processo de atualização no PostgreSQL\n",
    "# Passo 1: Adicionar coluna temporária novo_id em filial\n",
    "# Passo 2: Atualizar notadebito.filial_id com base no mapeamento\n",
    "# Passo 3: Reorganizar a tabela filial com os novos ids\n",
    "\n",
    "print(\"🔧 Iniciando processo de padronização de IDs...\")\n",
    "print(\"\\n\" + \"=\"*70)\n",
    "\n",
    "# PASSO 1: Criar coluna temporária em filial\n",
    "print(\"\\n[1/5] Adicionando coluna temporária novo_id na tabela filial...\")\n",
    "try:\n",
    "    cursor.execute(\"\"\"\n",
    "        ALTER TABLE gerador_nd.filial \n",
    "        ADD COLUMN IF NOT EXISTS novo_id INTEGER;\n",
    "    \"\"\")\n",
    "    engine.commit()\n",
    "    print(\"      ✅ Coluna temporária criada\")\n",
    "except Exception as e:\n",
    "    print(f\"      ❌ Erro: {e}\")\n",
    "    engine.rollback()\n",
    "\n",
    "# PASSO 2: Preencher novo_id com o codigo_filial\n",
    "print(\"\\n[2/5] Preenchendo novo_id com valores de codigo_filial...\")\n",
    "try:\n",
    "    cursor.execute(\"\"\"\n",
    "        UPDATE gerador_nd.filial \n",
    "        SET novo_id = codigo_filial::INTEGER;\n",
    "    \"\"\")\n",
    "    engine.commit()\n",
    "    print(\"      ✅ novo_id preenchido\")\n",
    "except Exception as e:\n",
    "    print(f\"      ❌ Erro: {e}\")\n",
    "    engine.rollback()\n",
    "\n",
    "# PASSO 3: Criar coluna temporária em notadebito\n",
    "print(\"\\n[3/5] Adicionando coluna temporária novo_filial_id em notadebito...\")\n",
    "try:\n",
    "    cursor.execute(\"\"\"\n",
    "        ALTER TABLE gerador_nd.notadebito \n",
    "        ADD COLUMN IF NOT EXISTS novo_filial_id INTEGER;\n",
    "    \"\"\")\n",
    "    engine.commit()\n",
    "    print(\"      ✅ Coluna temporária criada em notadebito\")\n",
    "except Exception as e:\n",
    "    print(f\"      ❌ Erro: {e}\")\n",
    "    engine.rollback()\n",
    "\n",
    "# PASSO 4: Atualizar novo_filial_id em notadebito baseado no novo_id de filial\n",
    "print(\"\\n[4/5] Atualizando novo_filial_id em notadebito...\")\n",
    "try:\n",
    "    cursor.execute(\"\"\"\n",
    "        UPDATE gerador_nd.notadebito nd\n",
    "        SET novo_filial_id = f.novo_id\n",
    "        FROM gerador_nd.filial f\n",
    "        WHERE nd.filial_id = f.id;\n",
    "    \"\"\")\n",
    "    engine.commit()\n",
    "    print(\"      ✅ novo_filial_id atualizado\")\n",
    "except Exception as e:\n",
    "    print(f\"      ❌ Erro: {e}\")\n",
    "    engine.rollback()\n",
    "\n",
    "print(\"\\n[5/5] Verificando atualizações...\")\n",
    "query_check = \"\"\"\n",
    "SELECT \n",
    "    nd.id,\n",
    "    nd.numero_nd,\n",
    "    nd.filial_id as filial_id_antigo,\n",
    "    nd.novo_filial_id as filial_id_novo,\n",
    "    f.nome_loja\n",
    "FROM gerador_nd.notadebito nd\n",
    "JOIN gerador_nd.filial f ON nd.filial_id = f.id\n",
    "LIMIT 10\n",
    "\"\"\"\n",
    "df_check = pd.read_sql_query(query_check, engine)\n",
    "print(\"\\n      Primeiras 10 linhas de notadebito:\")\n",
    "print(df_check)\n",
    "\n",
    "print(\"\\n\" + \"=\"*70)\n",
    "print(\"✅ Preparação concluída! Pronto para aplicar as mudanças finais.\")"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 68,
   "id": "ee851144",
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "🔧 Aplicando mudanças finais...\n",
      "\n",
      "======================================================================\n",
      "\n",
      "[1/7] Removendo constraint de FK em notadebito...\n",
      "      ✅ Constraint FK removida\n",
      "\n",
      "[2/7] Atualizando filial_id em notadebito com novos valores...\n",
      "      ✅ filial_id atualizado em notadebito\n",
      "\n",
      "[3/7] Removendo coluna temporária de notadebito...\n",
      "      ✅ Coluna temporária removida\n",
      "\n",
      "✅ Parte 1 concluída! notadebito atualizado.\n"
     ]
    }
   ],
   "source": [
    "## Aplicar as mudanças finais - Parte 1: Desabilitar constraints\n",
    "print(\"🔧 Aplicando mudanças finais...\")\n",
    "print(\"\\n\" + \"=\"*70)\n",
    "\n",
    "# ETAPA 1: Remover constraint FK de notadebito\n",
    "print(\"\\n[1/7] Removendo constraint de FK em notadebito...\")\n",
    "try:\n",
    "    cursor.execute(\"\"\"\n",
    "        ALTER TABLE gerador_nd.notadebito \n",
    "        DROP CONSTRAINT IF EXISTS notadebito_filial_id_fkey;\n",
    "    \"\"\")\n",
    "    engine.commit()\n",
    "    print(\"      ✅ Constraint FK removida\")\n",
    "except Exception as e:\n",
    "    print(f\"      ❌ Erro: {e}\")\n",
    "    engine.rollback()\n",
    "\n",
    "# ETAPA 2: Atualizar filial_id em notadebito com os novos valores\n",
    "print(\"\\n[2/7] Atualizando filial_id em notadebito com novos valores...\")\n",
    "try:\n",
    "    cursor.execute(\"\"\"\n",
    "        UPDATE gerador_nd.notadebito\n",
    "        SET filial_id = novo_filial_id;\n",
    "    \"\"\")\n",
    "    engine.commit()\n",
    "    print(\"      ✅ filial_id atualizado em notadebito\")\n",
    "except Exception as e:\n",
    "    print(f\"      ❌ Erro: {e}\")\n",
    "    engine.rollback()\n",
    "\n",
    "# ETAPA 3: Remover coluna temporária de notadebito\n",
    "print(\"\\n[3/7] Removendo coluna temporária de notadebito...\")\n",
    "try:\n",
    "    cursor.execute(\"\"\"\n",
    "        ALTER TABLE gerador_nd.notadebito \n",
    "        DROP COLUMN IF EXISTS novo_filial_id;\n",
    "    \"\"\")\n",
    "    engine.commit()\n",
    "    print(\"      ✅ Coluna temporária removida\")\n",
    "except Exception as e:\n",
    "    print(f\"      ❌ Erro: {e}\")\n",
    "    engine.rollback()\n",
    "\n",
    "print(\"\\n✅ Parte 1 concluída! notadebito atualizado.\")"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 69,
   "id": "9176ae9e",
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "\n",
      "======================================================================\n",
      "🔧 Continuando com a tabela filial...\n",
      "\n",
      "[4/7] Atualizando id na tabela filial...\n",
      "      ❌ Erro: duplicate key value violates unique constraint \"filial_pkey\"\n",
      "DETAIL:  Key (id)=(1) already exists.\n",
      "\n",
      "\n",
      "[5/7] Removendo coluna temporária de filial...\n",
      "      ✅ Coluna temporária removida de filial\n",
      "\n",
      "[6/7] Ajustando sequence de filial...\n",
      "      ✅ Sequence ajustada\n",
      "\n",
      "[7/7] Recriando constraint de FK em notadebito...\n",
      "      ✅ Constraint FK recriada\n",
      "\n",
      "======================================================================\n",
      "✅ PADRONIZAÇÃO CONCLUÍDA COM SUCESSO!\n"
     ]
    }
   ],
   "source": [
    "## Aplicar as mudanças finais - Parte 2: Atualizar tabela filial\n",
    "print(\"\\n\" + \"=\"*70)\n",
    "print(\"🔧 Continuando com a tabela filial...\")\n",
    "\n",
    "# ETAPA 4: Atualizar id em filial com os novos valores\n",
    "print(\"\\n[4/7] Atualizando id na tabela filial...\")\n",
    "try:\n",
    "    cursor.execute(\"\"\"\n",
    "        UPDATE gerador_nd.filial\n",
    "        SET id = novo_id;\n",
    "    \"\"\")\n",
    "    engine.commit()\n",
    "    print(\"      ✅ IDs atualizados em filial\")\n",
    "except Exception as e:\n",
    "    print(f\"      ❌ Erro: {e}\")\n",
    "    engine.rollback()\n",
    "\n",
    "# ETAPA 5: Remover coluna temporária de filial\n",
    "print(\"\\n[5/7] Removendo coluna temporária de filial...\")\n",
    "try:\n",
    "    cursor.execute(\"\"\"\n",
    "        ALTER TABLE gerador_nd.filial \n",
    "        DROP COLUMN IF EXISTS novo_id;\n",
    "    \"\"\")\n",
    "    engine.commit()\n",
    "    print(\"      ✅ Coluna temporária removida de filial\")\n",
    "except Exception as e:\n",
    "    print(f\"      ❌ Erro: {e}\")\n",
    "    engine.rollback()\n",
    "\n",
    "# ETAPA 6: Resetar a sequence do id de filial\n",
    "print(\"\\n[6/7] Ajustando sequence de filial...\")\n",
    "try:\n",
    "    cursor.execute(\"\"\"\n",
    "        SELECT setval('gerador_nd.filial_id_seq', \n",
    "                      (SELECT MAX(id) FROM gerador_nd.filial));\n",
    "    \"\"\")\n",
    "    engine.commit()\n",
    "    print(\"      ✅ Sequence ajustada\")\n",
    "except Exception as e:\n",
    "    print(f\"      ❌ Erro: {e}\")\n",
    "    engine.rollback()\n",
    "\n",
    "# ETAPA 7: Recriar constraint FK\n",
    "print(\"\\n[7/7] Recriando constraint de FK em notadebito...\")\n",
    "try:\n",
    "    cursor.execute(\"\"\"\n",
    "        ALTER TABLE gerador_nd.notadebito \n",
    "        ADD CONSTRAINT notadebito_filial_id_fkey \n",
    "        FOREIGN KEY (filial_id) REFERENCES gerador_nd.filial(id);\n",
    "    \"\"\")\n",
    "    engine.commit()\n",
    "    print(\"      ✅ Constraint FK recriada\")\n",
    "except Exception as e:\n",
    "    print(f\"      ❌ Erro: {e}\")\n",
    "    engine.rollback()\n",
    "\n",
    "print(\"\\n\" + \"=\"*70)\n",
    "print(\"✅ PADRONIZAÇÃO CONCLUÍDA COM SUCESSO!\")"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 70,
   "id": "0f9d496c",
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "\n",
      "🔧 Corrigindo problema de duplicação de chave...\n",
      "\n",
      "======================================================================\n",
      "\n",
      "[1/6] Removendo constraint FK...\n",
      "      ✅ Constraint removida\n",
      "\n",
      "[2/6] Criando tabela filial_temp com IDs corretos...\n",
      "      ✅ Tabela temporária criada\n",
      "\n",
      "[3/6] Limpando tabela filial original...\n",
      "      ✅ Tabela limpa\n",
      "\n",
      "[4/6] Copiando dados com IDs corretos...\n",
      "      ✅ Dados copiados com IDs corretos\n",
      "\n",
      "[5/6] Removendo tabela temporária...\n",
      "      ✅ Tabela temporária removida\n",
      "\n",
      "[6/6] Recriando constraint FK...\n",
      "      ✅ Constraint FK recriada\n",
      "\n",
      "[7/6] Ajustando sequence...\n",
      "      ✅ Sequence ajustada\n",
      "\n",
      "======================================================================\n",
      "✅ PADRONIZAÇÃO CONCLUÍDA!\n"
     ]
    }
   ],
   "source": [
    "## Corrigir o problema - Usar abordagem de tabela temporária\n",
    "print(\"\\n🔧 Corrigindo problema de duplicação de chave...\")\n",
    "print(\"\\n\" + \"=\"*70)\n",
    "\n",
    "# PASSO 1: Remover FK novamente\n",
    "print(\"\\n[1/6] Removendo constraint FK...\")\n",
    "try:\n",
    "    cursor.execute(\"\"\"\n",
    "        ALTER TABLE gerador_nd.notadebito \n",
    "        DROP CONSTRAINT IF EXISTS notadebito_filial_id_fkey;\n",
    "    \"\"\")\n",
    "    engine.commit()\n",
    "    print(\"      ✅ Constraint removida\")\n",
    "except Exception as e:\n",
    "    print(f\"      ⚠️  {e}\")\n",
    "    engine.rollback()\n",
    "\n",
    "# PASSO 2: Criar tabela temporária com IDs corretos\n",
    "print(\"\\n[2/6] Criando tabela filial_temp com IDs corretos...\")\n",
    "try:\n",
    "    cursor.execute(\"\"\"\n",
    "        CREATE TABLE gerador_nd.filial_temp AS\n",
    "        SELECT \n",
    "            codigo_filial::INTEGER as id,\n",
    "            nome_fantasia,\n",
    "            razao_social,\n",
    "            endereco,\n",
    "            cep,\n",
    "            cnpj,\n",
    "            codigo_filial,\n",
    "            nome_loja,\n",
    "            agencia,\n",
    "            conta,\n",
    "            banco,\n",
    "            created_at\n",
    "        FROM gerador_nd.filial\n",
    "        ORDER BY codigo_filial::INTEGER;\n",
    "    \"\"\")\n",
    "    engine.commit()\n",
    "    print(\"      ✅ Tabela temporária criada\")\n",
    "except Exception as e:\n",
    "    print(f\"      ❌ Erro: {e}\")\n",
    "    engine.rollback()\n",
    "\n",
    "# PASSO 3: Deletar dados da tabela original\n",
    "print(\"\\n[3/6] Limpando tabela filial original...\")\n",
    "try:\n",
    "    cursor.execute(\"DELETE FROM gerador_nd.filial;\")\n",
    "    engine.commit()\n",
    "    print(\"      ✅ Tabela limpa\")\n",
    "except Exception as e:\n",
    "    print(f\"      ❌ Erro: {e}\")\n",
    "    engine.rollback()\n",
    "\n",
    "# PASSO 4: Copiar dados de volta com IDs corretos\n",
    "print(\"\\n[4/6] Copiando dados com IDs corretos...\")\n",
    "try:\n",
    "    cursor.execute(\"\"\"\n",
    "        INSERT INTO gerador_nd.filial \n",
    "        (id, nome_fantasia, razao_social, endereco, cep, cnpj, \n",
    "         codigo_filial, nome_loja, agencia, conta, banco, created_at)\n",
    "        SELECT \n",
    "            id, nome_fantasia, razao_social, endereco, cep, cnpj,\n",
    "            codigo_filial, nome_loja, agencia, conta, banco, created_at\n",
    "        FROM gerador_nd.filial_temp\n",
    "        ORDER BY id;\n",
    "    \"\"\")\n",
    "    engine.commit()\n",
    "    print(\"      ✅ Dados copiados com IDs corretos\")\n",
    "except Exception as e:\n",
    "    print(f\"      ❌ Erro: {e}\")\n",
    "    engine.rollback()\n",
    "\n",
    "# PASSO 5: Remover tabela temporária\n",
    "print(\"\\n[5/6] Removendo tabela temporária...\")\n",
    "try:\n",
    "    cursor.execute(\"DROP TABLE IF EXISTS gerador_nd.filial_temp;\")\n",
    "    engine.commit()\n",
    "    print(\"      ✅ Tabela temporária removida\")\n",
    "except Exception as e:\n",
    "    print(f\"      ❌ Erro: {e}\")\n",
    "    engine.rollback()\n",
    "\n",
    "# PASSO 6: Recriar FK\n",
    "print(\"\\n[6/6] Recriando constraint FK...\")\n",
    "try:\n",
    "    cursor.execute(\"\"\"\n",
    "        ALTER TABLE gerador_nd.notadebito \n",
    "        ADD CONSTRAINT notadebito_filial_id_fkey \n",
    "        FOREIGN KEY (filial_id) REFERENCES gerador_nd.filial(id);\n",
    "    \"\"\")\n",
    "    engine.commit()\n",
    "    print(\"      ✅ Constraint FK recriada\")\n",
    "except Exception as e:\n",
    "    print(f\"      ❌ Erro: {e}\")\n",
    "    engine.rollback()\n",
    "\n",
    "# PASSO 7: Ajustar sequence\n",
    "print(\"\\n[7/6] Ajustando sequence...\")\n",
    "try:\n",
    "    cursor.execute(\"\"\"\n",
    "        SELECT setval('gerador_nd.filial_id_seq', \n",
    "                      (SELECT MAX(id) FROM gerador_nd.filial));\n",
    "    \"\"\")\n",
    "    engine.commit()\n",
    "    print(\"      ✅ Sequence ajustada\")\n",
    "except Exception as e:\n",
    "    print(f\"      ❌ Erro: {e}\")\n",
    "    engine.rollback()\n",
    "\n",
    "print(\"\\n\" + \"=\"*70)\n",
    "print(\"✅ PADRONIZAÇÃO CONCLUÍDA!\")"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 71,
   "id": "303765cd",
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "📊 Verificando resultado final da padronização...\n",
      "\n",
      "======================================================================\n",
      "\n",
      "📋 Tabela FILIAL - IDs padronizados:\n",
      " id  codigo_filial                nome_loja            nome_fantasia status\n",
      "  1              1           BYD Ctba Chile           BYD Ctba Chile      ✅\n",
      "  2              2              BYD Maringá              BYD Maringá      ✅\n",
      "  3              3       BYD Mario Tourinho       BYD Mario Tourinho      ✅\n",
      "  4              4 BYD São Jose dos Pinhais BYD São Jose dos Pinhais      ✅\n",
      "  5              5         BYD Ponta Grossa         BYD Ponta Grossa      ✅\n",
      "  6              6             BYD Cascavel             BYD Cascavel      ✅\n",
      "  7              7             BYD Londrina             BYD Londrina      ✅\n",
      "  8              8               BYD Portão               BYD Portão      ✅\n",
      "  9              9             BYD Umuarama             BYD Umuarama      ✅\n",
      "\n",
      "\n",
      "📋 Tabela NOTADEBITO - Primeiros 10 registros:\n",
      "  id  numero_nd  filial_id   nome_loja codigo_filial\n",
      "1949 1-2025-060          2 BYD Maringá             2\n",
      "1950 1-2025-061          2 BYD Maringá             2\n",
      "1951 1-2025-062          2 BYD Maringá             2\n",
      "1952 1-2025-063          2 BYD Maringá             2\n",
      "1953 1-2025-064          2 BYD Maringá             2\n",
      "1954 1-2025-065          2 BYD Maringá             2\n",
      "1955 1-2025-066          2 BYD Maringá             2\n",
      "1956 1-2025-067          2 BYD Maringá             2\n",
      "1957 1-2025-068          2 BYD Maringá             2\n",
      "1958 1-2025-069          2 BYD Maringá             2\n",
      "\n",
      "\n",
      "📊 RESUMO:\n",
      "   ✅ Total de filiais: 9\n",
      "   ✅ IDs padronizados: 9/9\n",
      "   ✅ Total de NDs: 206\n",
      "\n",
      "======================================================================\n",
      "🎉 SUCESSO! Todos os IDs foram padronizados: id = codigo_filial\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "C:\\Users\\giovanni.5683\\AppData\\Local\\Temp\\ipykernel_22696\\1984582208.py:20: UserWarning: pandas only supports SQLAlchemy connectable (engine/connection) or database string URI or sqlite3 DBAPI2 connection. Other DBAPI2 objects are not tested. Please consider using SQLAlchemy.\n",
      "  df_filial_final = pd.read_sql_query(query_filial_final, engine)\n",
      "C:\\Users\\giovanni.5683\\AppData\\Local\\Temp\\ipykernel_22696\\1984582208.py:39: UserWarning: pandas only supports SQLAlchemy connectable (engine/connection) or database string URI or sqlite3 DBAPI2 connection. Other DBAPI2 objects are not tested. Please consider using SQLAlchemy.\n",
      "  df_nd_final = pd.read_sql_query(query_nd_final, engine)\n",
      "C:\\Users\\giovanni.5683\\AppData\\Local\\Temp\\ipykernel_22696\\1984582208.py:46: UserWarning: pandas only supports SQLAlchemy connectable (engine/connection) or database string URI or sqlite3 DBAPI2 connection. Other DBAPI2 objects are not tested. Please consider using SQLAlchemy.\n",
      "  print(f\"   ✅ Total de NDs: {pd.read_sql_query('SELECT COUNT(*) FROM gerador_nd.notadebito', engine).iloc[0, 0]}\")\n"
     ]
    }
   ],
   "source": [
    "## Verificar resultado final\n",
    "print(\"📊 Verificando resultado final da padronização...\")\n",
    "print(\"\\n\" + \"=\"*70)\n",
    "\n",
    "# Verificar tabela filial\n",
    "query_filial_final = \"\"\"\n",
    "SELECT \n",
    "    id,\n",
    "    codigo_filial::INTEGER as codigo_filial,\n",
    "    nome_loja,\n",
    "    nome_fantasia,\n",
    "    CASE \n",
    "        WHEN id = codigo_filial::INTEGER THEN '✅' \n",
    "        ELSE '❌' \n",
    "    END as status\n",
    "FROM gerador_nd.filial\n",
    "ORDER BY id\n",
    "\"\"\"\n",
    "\n",
    "df_filial_final = pd.read_sql_query(query_filial_final, engine)\n",
    "print(\"\\n📋 Tabela FILIAL - IDs padronizados:\")\n",
    "print(df_filial_final.to_string(index=False))\n",
    "\n",
    "# Verificar algumas NDs\n",
    "print(\"\\n\\n📋 Tabela NOTADEBITO - Primeiros 10 registros:\")\n",
    "query_nd_final = \"\"\"\n",
    "SELECT \n",
    "    nd.id,\n",
    "    nd.numero_nd,\n",
    "    nd.filial_id,\n",
    "    f.nome_loja,\n",
    "    f.codigo_filial\n",
    "FROM gerador_nd.notadebito nd\n",
    "JOIN gerador_nd.filial f ON nd.filial_id = f.id\n",
    "ORDER BY nd.id\n",
    "LIMIT 10\n",
    "\"\"\"\n",
    "\n",
    "df_nd_final = pd.read_sql_query(query_nd_final, engine)\n",
    "print(df_nd_final.to_string(index=False))\n",
    "\n",
    "# Estatísticas\n",
    "print(\"\\n\\n📊 RESUMO:\")\n",
    "print(f\"   ✅ Total de filiais: {len(df_filial_final)}\")\n",
    "print(f\"   ✅ IDs padronizados: {(df_filial_final['status'] == '✅').sum()}/{len(df_filial_final)}\")\n",
    "print(f\"   ✅ Total de NDs: {pd.read_sql_query('SELECT COUNT(*) FROM gerador_nd.notadebito', engine).iloc[0, 0]}\")\n",
    "\n",
    "print(\"\\n\" + \"=\"*70)\n",
    "print(\"🎉 SUCESSO! Todos os IDs foram padronizados: id = codigo_filial\")"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 73,
   "id": "f2ffe024",
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "⚠️  ATENÇÃO: Os numero_nd ainda usam os IDs antigos!\n",
      "Exemplo: 1-2025-060 deveria ser 2-2025-060 (Maringá = id 2)\n",
      "\n",
      "🔧 Corrigindo numero_nd em todas as NDs...\n",
      "\n",
      "======================================================================\n",
      "\n",
      "[1/2] Atualizando numero_nd com filial_id correto...\n",
      "      ✅ 206 registros atualizados\n",
      "\n",
      "[2/2] Verificando correção...\n",
      "\n",
      "      Primeiros 15 registros:\n",
      "  id  numero_nd  filial_id codigo_filial   nome_loja status\n",
      "1949 2-2025-060          2             2 BYD Maringá      ✅\n",
      "1950 2-2025-061          2             2 BYD Maringá      ✅\n",
      "1951 2-2025-062          2             2 BYD Maringá      ✅\n",
      "1952 2-2025-063          2             2 BYD Maringá      ✅\n",
      "1953 2-2025-064          2             2 BYD Maringá      ✅\n",
      "1954 2-2025-065          2             2 BYD Maringá      ✅\n",
      "1955 2-2025-066          2             2 BYD Maringá      ✅\n",
      "1956 2-2025-067          2             2 BYD Maringá      ✅\n",
      "1957 2-2025-068          2             2 BYD Maringá      ✅\n",
      "1958 2-2025-069          2             2 BYD Maringá      ✅\n",
      "1959 2-2025-070          2             2 BYD Maringá      ✅\n",
      "1960 2-2025-071          2             2 BYD Maringá      ✅\n",
      "1961 2-2025-072          2             2 BYD Maringá      ✅\n",
      "1962 2-2025-073          2             2 BYD Maringá      ✅\n",
      "1963 2-2025-074          2             2 BYD Maringá      ✅\n",
      "\n",
      "📊 Status: 15/15 corretos\n",
      "\n",
      "======================================================================\n",
      "🎉 PERFEITO! Todos os numero_nd foram corrigidos!\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "C:\\Users\\giovanni.5683\\AppData\\Local\\Temp\\ipykernel_22696\\3827455283.py:46: UserWarning: pandas only supports SQLAlchemy connectable (engine/connection) or database string URI or sqlite3 DBAPI2 connection. Other DBAPI2 objects are not tested. Please consider using SQLAlchemy.\n",
      "  df_check_final = pd.read_sql_query(query_check_final, engine)\n"
     ]
    }
   ],
   "source": [
    "## IMPORTANTE: Corrigir numero_nd para usar o novo filial_id\n",
    "print(\"⚠️  ATENÇÃO: Os numero_nd ainda usam os IDs antigos!\")\n",
    "print(\"Exemplo: 1-2025-060 deveria ser 2-2025-060 (Maringá = id 2)\\n\")\n",
    "print(\"🔧 Corrigindo numero_nd em todas as NDs...\")\n",
    "print(\"\\n\" + \"=\"*70)\n",
    "\n",
    "# Atualizar numero_nd com base no novo filial_id\n",
    "print(\"\\n[1/2] Atualizando numero_nd com filial_id correto...\")\n",
    "try:\n",
    "    cursor.execute(\"\"\"\n",
    "        UPDATE gerador_nd.notadebito\n",
    "        SET numero_nd = CONCAT(\n",
    "            filial_id, \n",
    "            '-', \n",
    "            EXTRACT(YEAR FROM data_emissao)::TEXT, \n",
    "            '-',\n",
    "            LPAD(SPLIT_PART(numero_nd, '-', 3), 3, '0')\n",
    "        );\n",
    "    \"\"\")\n",
    "    rows_updated = cursor.rowcount\n",
    "    engine.commit()\n",
    "    print(f\"      ✅ {rows_updated} registros atualizados\")\n",
    "except Exception as e:\n",
    "    print(f\"      ❌ Erro: {e}\")\n",
    "    engine.rollback()\n",
    "\n",
    "# Verificar resultado\n",
    "print(\"\\n[2/2] Verificando correção...\")\n",
    "query_check_final = \"\"\"\n",
    "SELECT \n",
    "    nd.id,\n",
    "    nd.numero_nd,\n",
    "    nd.filial_id,\n",
    "    f.codigo_filial,\n",
    "    f.nome_loja,\n",
    "    CASE \n",
    "        WHEN SPLIT_PART(nd.numero_nd, '-', 1)::INTEGER = nd.filial_id THEN '✅'\n",
    "        ELSE '❌'\n",
    "    END as status\n",
    "FROM gerador_nd.notadebito nd\n",
    "JOIN gerador_nd.filial f ON nd.filial_id = f.id\n",
    "ORDER BY nd.id\n",
    "LIMIT 15\n",
    "\"\"\"\n",
    "\n",
    "df_check_final = pd.read_sql_query(query_check_final, engine)\n",
    "print(\"\\n      Primeiros 15 registros:\")\n",
    "print(df_check_final.to_string(index=False))\n",
    "\n",
    "# Verificar se há algum erro\n",
    "erros = (df_check_final['status'] == '❌').sum()\n",
    "print(f\"\\n📊 Status: {len(df_check_final) - erros}/{len(df_check_final)} corretos\")\n",
    "\n",
    "print(\"\\n\" + \"=\"*70)\n",
    "if erros == 0:\n",
    "    print(\"🎉 PERFEITO! Todos os numero_nd foram corrigidos!\")\n",
    "else:\n",
    "    print(\"⚠️  Ainda há registros com problemas.\")"
   ]
  }
 ],
 "metadata": {
  "kernelspec": {
   "display_name": "base",
   "language": "python",
   "name": "python3"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.13.5"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 5
}
